<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã –°–∞–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #581c87 50%, #000000 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #e5e7eb;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 8px;
        }

        .header p {
            color: #d1d5db;
            font-size: 1rem;
        }

        .init-button {
            display: block;
            margin: 40px auto;
            padding: 16px 32px;
            background: #fbbf24;
            color: #000;
            border: none;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .init-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px -5px rgba(251, 191, 36, 0.5);
        }

        .init-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .zones-container {
            display: none;
        }

        .zones-container.active {
            display: block;
        }

        .zones-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .zone-card {
            border: 2px solid #4b5563;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(17, 24, 39, 0.3);
            position: relative;
            overflow: hidden;
        }

        .zone-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .zone-card:hover {
            border-color: #9ca3af;
            transform: translateY(-2px);
        }

        .zone-card:hover::before {
            transform: translateX(100%);
        }

        .zone-card.active {
            border-color: #fbbf24;
            background: linear-gradient(90deg, rgba(126, 34, 206, 0.2) 0%, rgba(79, 70, 229, 0.2) 100%);
            box-shadow: 0 10px 25px -5px rgba(251, 191, 36, 0.3);
        }

        .zone-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .zone-info {
            flex: 1;
        }

        .zone-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .zone-icon {
            font-size: 2rem;
        }

        .zone-name {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .zone-description {
            color: #9ca3af;
            font-size: 0.875rem;
            margin-left: 48px;
        }

        .zone-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 8px;
            margin-left: 48px;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .play-button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            background: #374151;
            color: #d1d5db;
        }

        .play-button:hover {
            background: #4b5563;
            transform: scale(1.1);
        }

        .play-button.active {
            background: #fbbf24;
            color: #000000;
        }

        .play-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .play-button .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .volume-control {
            background: rgba(17, 24, 39, 0.5);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #374151;
        }

        .volume-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .volume-label {
            color: #d1d5db;
            font-size: 0.875rem;
        }

        .volume-value {
            color: #fbbf24;
            font-size: 0.875rem;
        }

        .volume-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #374151;
            outline: none;
            cursor: pointer;
            position: relative;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fbbf24;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fbbf24;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .volume-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .note-box {
            margin-top: 24px;
            padding: 20px;
            background: rgba(254, 240, 138, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(252, 211, 77, 0.3);
        }

        .note-box p {
            color: #fbbf24;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .note-box strong {
            font-weight: 600;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #ef4444;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        @media (max-width: 640px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .zone-description {
                margin-left: 0;
                margin-top: 8px;
            }
            
            .zone-meta {
                margin-left: 0;
                flex-wrap: wrap;
            }
        }

        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä */
        .visualizer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <canvas class="visualizer" id="visualizer"></canvas>
    
    <div class="container">
        <div class="header">
            <h1>üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –ª–∞–Ω–¥—à–∞—Ñ—Ç—ã –°–∞–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π</h1>
            <p>–ö–∞–∂–¥–∞—è –∑–æ–Ω–∞ —Å–∞–¥–∞ –∏–º–µ–µ—Ç —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∑–≤—É–∫–æ–≤—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É</p>
        </div>

        <button class="init-button" id="initButton" onclick="startAudioSystem()">
            üéµ –ù–∞—á–∞—Ç—å –º—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ
        </button>

        <div id="errorMessage" style="display: none;" class="error-message"></div>

        <div class="zones-container" id="zonesContainer">
            <div class="zones-grid" id="zonesGrid">
                <!-- –ó–æ–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>

            <div class="volume-control">
                <div class="volume-header">
                    <label class="volume-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å</label>
                    <span class="volume-value" id="volumeValue">70%</span>
                </div>
                <input 
                    type="range" 
                    class="volume-slider" 
                    id="volumeSlider"
                    min="-40" 
                    max="0" 
                    value="-12"
                >
            </div>

            <div class="note-box">
                <p>
                    <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ö–∞–∂–¥–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã, 
                    –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —á–∞—Å—Ç–æ—Ç–∞—Ö –∏ —á–∏—Å–ª–æ–≤—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã. 
                    –ú—É–∑—ã–∫–∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–∏, –æ—Ç—Ä–∞–∂–∞—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Å–∞–¥–∞.
                </p>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let isPlaying = false;
        let currentZone = null;
        let loading = false;
        let synths = {};
        let sequences = {};
        let effects = {};
        let isInitialized = false;

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –∑–æ–Ω
        const zones = {
            centralAxis: {
                name: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ—Å—å',
                icon: 'üîÆ',
                description: '–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å - –æ—Ç –∫–≤–∞–Ω—Ç–æ–≤–æ–≥–æ —Ö–∞–æ—Å–∞ –∫ —Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ü–∏–∏',
                baseFreq: 111,
                color: '#ffd700',
                tempo: 60
            },
            genesisCircle: {
                name: '–ö—Ä—É–≥ –ë—ã—Ç–∏—è',
                icon: 'üåÄ',
                description: '–°–µ–º—å –¥–Ω–µ–π —Ç–≤–æ—Ä–µ–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∫—Ä—É–≥–∞—Ö',
                baseFreq: 528,
                color: '#4ecdc4',
                tempo: 72
            },
            covenantTerraces: {
                name: '–¢–µ—Ä—Ä–∞—Å—ã –ó–∞–≤–µ—Ç–∞',
                icon: '‚õ∞Ô∏è',
                description: '–î–µ—Å—è—Ç—å –∑–∞–ø–æ–≤–µ–¥–µ–π, –≤–æ—Å—Ö–æ–¥—è—â–∏—Ö –∫ –Ω–µ–±—É',
                baseFreq: 396,
                color: '#8b7355',
                tempo: 80
            },
            incarnationLabyrinth: {
                name: '–õ–∞–±–∏—Ä–∏–Ω—Ç –í–æ–ø–ª–æ—â–µ–Ω–∏—è',
                icon: 'üåü',
                description: '33 —Å—Ç–∞–Ω—Ü–∏–∏ —Ö—Ä–∏—Å—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏',
                baseFreq: 639,
                color: '#ff6b6b',
                tempo: 66
            },
            apocalypseGates: {
                name: '–í—Ä–∞—Ç–∞ –û—Ç–∫—Ä–æ–≤–µ–Ω–∏—è',
                icon: 'üö™',
                description: '–≠—Å—Ö–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª –≤ –±—É–¥—É—â–µ–µ',
                baseFreq: 852,
                color: '#9b59b6',
                tempo: 120
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞
        async function startAudioSystem() {
            const button = document.getElementById('initButton');
            button.disabled = true;
            button.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Tone.js
                if (typeof Tone === 'undefined') {
                    throw new Error('Tone.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
                await Tone.start();
                console.log('‚úÖ Tone.js –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                await setupEffects();
                console.log('‚úÖ –≠—Ñ—Ñ–µ–∫—Ç—ã —Å–æ–∑–¥–∞–Ω—ã');
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–æ–≤
                await setupSynths();
                console.log('‚úÖ –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã');
                
                // –°–æ–∑–¥–∞–Ω–∏–µ UI
                createZoneCards();
                setupVolumeControl();
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∑–æ–Ω—ã
                document.getElementById('zonesContainer').classList.add('active');
                button.style.display = 'none';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
                initVisualizer();
                
                isInitialized = true;
                console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ: ' + error.message);
                button.disabled = false;
                button.textContent = 'üéµ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        async function setupEffects() {
            return new Promise((resolve, reject) => {
                try {
                    effects.reverb = new Tone.Reverb({ 
                        decay: 8, 
                        wet: 0.3,
                        preDelay: 0.1
                    }).toDestination();
                    
                    effects.delay = new Tone.FeedbackDelay({
                        delayTime: "8n", 
                        feedback: 0.3,
                        wet: 0.3
                    }).connect(effects.reverb);
                    
                    effects.chorus = new Tone.Chorus({
                        frequency: 4,
                        delayTime: 2.5,
                        depth: 0.5,
                        wet: 0.5
                    }).connect(effects.delay);
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–æ–≤
        async function setupSynths() {
            return new Promise((resolve, reject) => {
                try {
                    Object.keys(zones).forEach(zoneKey => {
                        synths[zoneKey] = {
                            drone: new Tone.PolySynth(Tone.AMSynth, {
                                oscillator: { type: "sine" },
                                envelope: { 
                                    attack: 2, 
                                    decay: 1, 
                                    sustain: 0.8, 
                                    release: 4 
                                },
                                volume: -10
                            }).connect(effects.chorus),
                            
                            melody: new Tone.PolySynth(Tone.FMSynth, {
                                oscillator: { type: "triangle" },
                                envelope: { 
                                    attack: 0.5, 
                                    decay: 0.3, 
                                    sustain: 0.5, 
                                    release: 2 
                                },
                                modulation: { type: "sine" },
                                volume: -12
                            }).connect(effects.delay),
                            
                            bass: new Tone.MonoSynth({
                                oscillator: { type: "sawtooth" },
                                envelope: { 
                                    attack: 0.1, 
                                    decay: 0.3, 
                                    sustain: 0.4, 
                                    release: 0.5 
                                },
                                filter: { 
                                    Q: 2, 
                                    frequency: 200, 
                                    type: "lowpass" 
                                },
                                volume: -8
                            }).connect(effects.chorus),
                            
                            ambient: new Tone.PolySynth(Tone.Synth, {
                                oscillator: { type: "sine" },
                                envelope: { 
                                    attack: 4, 
                                    decay: 2, 
                                    sustain: 0.6, 
                                    release: 8 
                                },
                                volume: -15
                            }).connect(effects.reverb)
                        };
                    });
                    
                    resolve();
                } catch (error) {
                    reject(error);
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –º—É–∑—ã–∫–∏ –¥–ª—è –∑–æ–Ω—ã
        function createZoneMusic(zoneKey) {
        const zone = zones[zoneKey];
        const zoneSynths = synths[zoneKey];
        
        if (!zoneSynths) {
            console.error('–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –∑–æ–Ω—ã:', zoneKey);
            return;
        }
    
        try {
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º–ø–∞
            Tone.Transport.bpm.value = zone.tempo;
    
            // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
            if (sequences[zoneKey]) {
                Object.values(sequences[zoneKey]).forEach(seq => {
                    seq.stop();
                    seq.dispose();
                });
            }
    
            let zoneSequences = {};
    
            switch (zoneKey) {
                case 'centralAxis':
                    // –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞
                    zoneSequences.drone = new Tone.Pattern((time, note) => {
                        if (note) zoneSynths.drone.triggerAttackRelease(note + "Hz", "2n", time);
                    }, [zone.baseFreq, zone.baseFreq * 1.5, zone.baseFreq * 2], "up");
    
                    zoneSequences.melody = new Tone.Sequence((time, note) => {
                        if (note) zoneSynths.melody.triggerAttackRelease(note + "Hz", "8n", time);
                    }, [
                        zone.baseFreq * 2, null, zone.baseFreq * 2.25, zone.baseFreq * 2.5,
                        zone.baseFreq * 3, null, zone.baseFreq * 2.75, null,
                        zone.baseFreq * 4, zone.baseFreq * 3.5, null, zone.baseFreq * 3,
                        null, zone.baseFreq * 4.5, zone.baseFreq * 5, null
                    ], "8n");
    
                    zoneSequences.ambient = new Tone.Loop((time) => {
                        const freq = zone.baseFreq * (1 + Math.random() * 4);
                        zoneSynths.ambient.triggerAttackRelease(freq + "Hz", "1n", time);
                    }, "1n");
                    break;
    
                case 'genesisCircle':
                    // –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞ —Å–µ–º–∏ –¥–Ω–µ–π
                    const sevenNotes = [1, 9/8, 5/4, 4/3, 3/2, 5/3, 15/8].map(r => zone.baseFreq * r);
                    
                    zoneSequences.drone = new Tone.Sequence((time, note) => {
                        zoneSynths.drone.triggerAttackRelease([note + "Hz", (note * 1.5) + "Hz"], "1n", time);
                    }, sevenNotes, "2n");
    
                    zoneSequences.melody = new Tone.Pattern((time, note) => {
                        zoneSynths.melody.triggerAttackRelease(note + "Hz", "4n", time);
                    }, sevenNotes.map(n => n * 2), "random");
    
                    zoneSequences.bass = new Tone.Loop((time) => {
                        const day = Math.floor((Tone.Transport.seconds / 4) % 7);
                        zoneSynths.bass.triggerAttackRelease((sevenNotes[day] / 2) + "Hz", "2n", time);
                    }, "2n");
                    break;
    
                case 'covenantTerraces':
                    // –¢–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞
                    const commandments = Array.from({length: 10}, (_, i) => 
                        zone.baseFreq * Math.pow(2, i/12)
                    );
    
                    zoneSequences.drone = new Tone.Loop((time) => {
                        zoneSynths.drone.triggerAttackRelease(
                            [zone.baseFreq + "Hz", (zone.baseFreq * 1.5) + "Hz", (zone.baseFreq * 2) + "Hz"],
                            "1n", time
                        );
                    }, "1n");
    
                    zoneSequences.melody = new Tone.Sequence((time, notes) => {
                        notes.forEach((note, i) => {
                            zoneSynths.melody.triggerAttackRelease(
                                note + "Hz", "16n", time + i * 0.125
                            );
                        });
                    }, [
                        commandments.slice(0, 4),
                        commandments.slice(2, 6),
                        commandments.slice(4, 8),
                        commandments.slice(6, 10)
                    ], "2n");
    
                    zoneSequences.bass = new Tone.Pattern((time, note) => {
                        zoneSynths.bass.triggerAttackRelease(note + "Hz", "4n", time);
                    }, [zone.baseFreq/2, zone.baseFreq/1.5, zone.baseFreq/2, zone.baseFreq/2.5], "up");
                    break;
    
                case 'incarnationLabyrinth':
                    // –ú–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞
                    zoneSequences.drone = new Tone.Loop((time) => {
                        const station = Math.floor((Tone.Transport.seconds / 2) % 33);
                        const freq = zone.baseFreq * (1 + station / 33);
                        zoneSynths.drone.triggerAttackRelease([freq + "Hz", (freq * 1.5) + "Hz"], "2n", time);
                    }, "2n");
    
                    zoneSequences.melody = new Tone.Pattern((time, note) => {
                        zoneSynths.melody.triggerAttackRelease(note + "Hz", "8n", time);
                    }, [
                        zone.baseFreq * 2,
                        zone.baseFreq * 1.875,
                        zone.baseFreq * 1.75,
                        zone.baseFreq * 1.5,
                        zone.baseFreq * 1.75,
                        zone.baseFreq * 2.25,
                        zone.baseFreq * 2
                    ], "random");
    
                    zoneSequences.ambient = new Tone.Loop((time) => {
                        if (Math.random() > 0.7) {
                            const note = zone.baseFreq * (2 + Math.random() * 2);
                            zoneSynths.ambient.triggerAttackRelease(note + "Hz", "4n", time);
                        }
                    }, "8n");
                    break;
    
                case 'apocalypseGates':
                    // –≠–ø–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞
                    zoneSequences.drone = new Tone.Loop((time) => {
                        zoneSynths.drone.triggerAttackRelease(
                            [zone.baseFreq + "Hz", (zone.baseFreq * 1.25) + "Hz", (zone.baseFreq * 1.5) + "Hz", (zone.baseFreq * 2) + "Hz"],
                            "1n", time
                        );
                    }, "2n");
    
                    zoneSequences.melody = new Tone.Sequence((time, notes) => {
                        notes.forEach((note, i) => {
                            if (note) {
                                zoneSynths.melody.triggerAttackRelease(
                                    note + "Hz", "16n", time + i * 0.0625
                                );
                            }
                        });
                    }, [
                        [zone.baseFreq * 4, null, zone.baseFreq * 3, zone.baseFreq * 4],
                        [zone.baseFreq * 5, zone.baseFreq * 4, null, zone.baseFreq * 3],
                        [zone.baseFreq * 6, null, zone.baseFreq * 5, zone.baseFreq * 4],
                        [zone.baseFreq * 8, zone.baseFreq * 6, zone.baseFreq * 5, zone.baseFreq * 4]
                    ], "4n");
    
                    zoneSequences.bass = new Tone.Loop((time) => {
                        zoneSynths.bass.triggerAttackRelease((zone.baseFreq / 2) + "Hz", "4n", time);
                        zoneSynths.bass.triggerAttackRelease((zone.baseFreq / 4) + "Hz", "4n", time + 0.125);
                    }, "2n");
    
                    zoneSequences.ambient = new Tone.Pattern((time, note) => {
                        zoneSynths.ambient.triggerAttackRelease([note + "Hz", (note * 1.5) + "Hz", (note * 2) + "Hz"], "2n", time);
                    }, [
                        zone.baseFreq * 2,
                        zone.baseFreq * 2.5,
                        zone.baseFreq * 3,
                        zone.baseFreq * 4
                    ], "random");
                    break;
            }
    
            // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
            Object.values(zoneSequences).forEach(seq => seq.start(0));
            sequences[zoneKey] = zoneSequences;
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º—É–∑—ã–∫–∏:', error);
            showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º—É–∑—ã–∫–∏: ' + error.message);
        }
    }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        async function togglePlay(zoneKey) {
            if (!isInitialized) {
                showError('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            loading = true;
            updateUI();
            
            try {
                if (isPlaying && currentZone === zoneKey) {
                    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞
                    await Tone.Transport.stop();
                    await Tone.Transport.cancel();
                    isPlaying = false;
                    currentZone = null;
                } else {
                    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–æ–Ω—ã
                    if (isPlaying) {
                        await Tone.Transport.stop();
                        await Tone.Transport.cancel();
                    }
                    
                    // –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –∑–æ–Ω—ã
                    createZoneMusic(zoneKey);
                    await Tone.Transport.start();
                    isPlaying = true;
                    currentZone = zoneKey;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                showError('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ' + error.message);
            } finally {
                loading = false;
                updateUI();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            document.querySelectorAll('.zone-card').forEach(card => {
                const zoneKey = card.dataset.zone;
                const button = card.querySelector('.play-button');
                const isActive = isPlaying && currentZone === zoneKey;
                
                if (isActive) {
                    card.classList.add('active');
                    button.classList.add('active');
                } else {
                    card.classList.remove('active');
                    button.classList.remove('active');
                }
                
                if (loading && currentZone === zoneKey) {
                    button.innerHTML = '<span class="spinner">‚ö°</span>';
                    button.disabled = true;
                } else {
                    button.innerHTML = isActive ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
                    button.disabled = false;
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –∑–æ–Ω
        function createZoneCards() {
            const grid = document.getElementById('zonesGrid');
            
            Object.entries(zones).forEach(([key, zone]) => {
                const card = document.createElement('div');
                card.className = 'zone-card';
                card.dataset.zone = key;
                
                card.innerHTML = `
                    <div class="zone-content">
                        <div class="zone-info">
                            <div class="zone-header">
                                <span class="zone-icon">${zone.icon}</span>
                                <h3 class="zone-name" style="color: ${zone.color}">${zone.name}</h3>
                            </div>
                            <p class="zone-description">${zone.description}</p>
                            <div class="zone-meta">
                                <span>–ß–∞—Å—Ç–æ—Ç–∞: ${zone.baseFreq} –ì—Ü</span>
                                <span>–¢–µ–º–ø: ${zone.tempo} BPM</span>
                            </div>
                        </div>
                        <button class="play-button" onclick="togglePlay('${key}')">‚ñ∂Ô∏è</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å—é
        function setupVolumeControl() {
            const slider = document.getElementById('volumeSlider');
            const valueDisplay = document.getElementById('volumeValue');
            
            function updateVolume() {
                const volume = Number(slider.value);
                if (Tone.Destination) {
                    Tone.Destination.volume.value = volume;
                }
                valueDisplay.textContent = Math.round(volume + 40) + '%';
                
                const percent = ((volume + 40) / 40) * 100;
                slider.style.background = `linear-gradient(to right, #fbbf24 0%, #fbbf24 ${percent}%, #374151 ${percent}%, #374151 100%)`;
            }
            
            slider.addEventListener('input', updateVolume);
            updateVolume();
        }

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä
        function initVisualizer() {
            const canvas = document.getElementById('visualizer');
            const ctx = canvas.getContext('2d');
            
            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            window.addEventListener('resize', resize);
            resize();
            
            const particles = [];
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 3 + 1,
                    hue: Math.random() * 60 + 30
                });
            }
            
            function animate() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    
                    if (isPlaying) {
                        p.size = Math.sin(Date.now() * 0.001) * 2 + 3;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = `hsl(${p.hue}, 100%, 50%)`;
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Cleanup –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (isInitialized) {
                Tone.Transport.stop();
                Tone.Transport.cancel();
                
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
                Object.values(sequences).forEach(zoneSeqs => {
                    Object.values(zoneSeqs).forEach(seq => {
                        seq.stop();
                        seq.dispose();
                    });
                });
                
                // –û—á–∏—Å—Ç–∫–∞ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–æ–≤
                Object.values(synths).forEach(zoneSynths => {
                    Object.values(zoneSynths).forEach(synth => synth.dispose());
                });
                
                // –û—á–∏—Å—Ç–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                Object.values(effects).forEach(effect => effect.dispose());
            }
        });
    </script>
</body>
</html>