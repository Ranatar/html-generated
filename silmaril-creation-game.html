<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кузница Феанора: Создание Сильмариллов</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #444;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(100, 100, 255, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #555;
            border-radius: 5px;
        }
        
        .stat-group h3 {
            color: #87ceeb;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(135, 206, 235, 0.5);
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .stat-value {
            color: #ffd700;
            font-weight: bold;
        }
        
        .game-text {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 5px;
            margin-bottom: 25px;
            line-height: 1.8;
            font-size: 1.1em;
            border: 1px solid #333;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .choice-btn {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border: 1px solid #4a69bd;
            padding: 15px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            text-align: left;
        }
        
        .choice-btn:hover {
            background: linear-gradient(135deg, #2a5298, #3a62a8);
            box-shadow: 0 0 15px rgba(74, 105, 189, 0.5);
            transform: translateX(5px);
        }
        
        .phase-indicator {
            text-align: center;
            color: #87ceeb;
            margin-bottom: 20px;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .silmaril-glow {
            display: inline-block;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #ffd700; }
            to { text-shadow: 0 0 20px #fff, 0 0 30px #ffd700, 0 0 40px #ffd700; }
        }
        
        .ending-title {
            font-size: 2em;
            color: #ffd700;
            text-align: center;
            margin: 20px 0;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }
        
        .restart-btn {
            display: block;
            margin: 30px auto;
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: white;
            border: 2px solid #ff6347;
            padding: 15px 40px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
        }
        
        .restart-btn:hover {
            background: linear-gradient(135deg, #dc143c, #ff1744);
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }
        
        .event-alert {
            background: linear-gradient(135deg, #4a0080, #6a0dad);
            border: 2px solid #9370db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(147, 112, 219, 0.5); }
            50% { box-shadow: 0 0 20px rgba(147, 112, 219, 0.8); }
            100% { box-shadow: 0 0 5px rgba(147, 112, 219, 0.5); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>⚒️ Кузница Феанора ⚒️</h1>
        <div class="phase-indicator" id="phase">Фаза: Подготовка</div>
        
        <div class="stats-panel">
            <div class="stat-group">
                <h3>Характеристики Феанора</h3>
                <div class="stat">
                    <span>Мастерство:</span>
                    <span class="stat-value" id="skill">50</span>
                </div>
                <div class="stat">
                    <span>Вдохновение:</span>
                    <span class="stat-value" id="inspiration">50</span>
                </div>
                <div class="stat">
                    <span>Гордыня:</span>
                    <span class="stat-value" id="pride">30</span>
                </div>
                <div class="stat">
                    <span>Связь с Валар:</span>
                    <span class="stat-value" id="valar">70</span>
                </div>
                <div class="stat">
                    <span>Усталость:</span>
                    <span class="stat-value" id="fatigue">0</span>
                </div>
            </div>
            
            <div class="stat-group">
                <h3>Характеристики Сильмариллов</h3>
                <div class="stat">
                    <span>Яркость света:</span>
                    <span class="stat-value" id="brightness">0</span>
                </div>
                <div class="stat">
                    <span>Чистота:</span>
                    <span class="stat-value" id="purity">0</span>
                </div>
                <div class="stat">
                    <span>Магическая сила:</span>
                    <span class="stat-value" id="magic">0</span>
                </div>
                <div class="stat">
                    <span>Прочность:</span>
                    <span class="stat-value" id="durability">0</span>
                </div>
                <div class="stat">
                    <span>Гармония:</span>
                    <span class="stat-value" id="harmony">0</span>
                </div>
            </div>
        </div>
        
        <div class="game-text" id="gameText">
            <p>Вы - Феанор, величайший из эльфийских мастеров. В вашей кузнице в Тирионе вы готовитесь к созданию величайшего творения всех времён - Сильмариллов. Свет Двух Древ Валинора вдохновляет вас на этот беспрецедентный подвиг мастерства.</p>
            <p>Но помните: каждое ваше решение повлияет не только на сами камни, но и на вашу судьбу и судьбу всего Арды...</p>
        </div>
        
        <div class="choices" id="choices"></div>
    </div>
    
    <script>
        // Игровое состояние
        let gameState = {
            phase: 0,
            step: 0,
            // Характеристики Феанора
            skill: 50,
            inspiration: 50,
            pride: 30,
            valar: 70,
            fatigue: 0,
            // Характеристики Сильмариллов
            brightness: 0,
            purity: 0,
            magic: 0,
            durability: 0,
            harmony: 0,
            // Дополнительные флаги
            materials: [],
            methods: [],
            events: [],
            oathTaken: false,
            helpFromValar: false,
            secretKnowledge: false
        };
        
        // Фазы игры
        const phases = [
            'Подготовка',
            'Выбор материалов',
            'Первый Сильмарил',
            'Второй Сильмарил',
            'Третий Сильмарил',
            'Финальная обработка',
            'Судьба'
        ];
        
        // Игровые сценарии
        const scenarios = {
            0: { // Подготовка
                0: {
                    text: `<p>Перед началом великой работы вам необходимо подготовиться. Что будет вашим первым шагом?</p>`,
                    choices: [
                        {
                            text: "Помолиться Валар и попросить их благословения",
                            effect: () => {
                                gameState.valar += 20;
                                gameState.inspiration += 10;
                                gameState.pride -= 10;
                                gameState.helpFromValar = true;
                            },
                            next: 1
                        },
                        {
                            text: "Изучить древние манускрипты Ауле о тайнах творения",
                            effect: () => {
                                gameState.skill += 15;
                                gameState.inspiration += 5;
                                gameState.secretKnowledge = true;
                            },
                            next: 1
                        },
                        {
                            text: "Положиться только на собственные силы и талант",
                            effect: () => {
                                gameState.pride += 20;
                                gameState.skill += 10;
                                gameState.valar -= 15;
                            },
                            next: 1
                        },
                        {
                            text: "Медитировать у корней Древ, впитывая их свет",
                            effect: () => {
                                gameState.inspiration += 20;
                                gameState.brightness += 10;
                                gameState.harmony += 5;
                            },
                            next: 1
                        }
                    ]
                },
                1: {
                    text: `<p>Ваша жена Нерданель беспокоится о вашем замысле. Она чувствует, что это творение может принести беду. Как вы ответите?</p>`,
                    choices: [
                        {
                            text: "Выслушать её опасения и обещать быть осторожным",
                            effect: () => {
                                gameState.pride -= 5;
                                gameState.harmony += 10;
                                gameState.fatigue -= 5;
                            },
                            next: 2
                        },
                        {
                            text: "Убедить её в величии замысла и необходимости риска",
                            effect: () => {
                                gameState.pride += 10;
                                gameState.inspiration += 10;
                            },
                            next: 2
                        },
                        {
                            text: "Проигнорировать её слова - женщины не понимают искусства",
                            effect: () => {
                                gameState.pride += 15;
                                gameState.valar -= 10;
                                gameState.harmony -= 15;
                            },
                            next: 2
                        }
                    ]
                },
                2: {
                    text: `<p class="event-alert">⚡ СОБЫТИЕ: Манвэ посылает вам видение!</p>
                    <p>Во сне вы видите три сияющих камня, но также тень и огонь. Как вы истолкуете это видение?</p>`,
                    choices: [
                        {
                            text: "Это предупреждение - нужно создать защиту для камней",
                            effect: () => {
                                gameState.durability += 15;
                                gameState.magic += 10;
                                gameState.valar += 5;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Это испытание моей воли - я должен превзойти видение",
                            effect: () => {
                                gameState.pride += 15;
                                gameState.skill += 10;
                                gameState.valar -= 5;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Это знак одобрения, но с предостережением о цене",
                            effect: () => {
                                gameState.inspiration += 10;
                                gameState.harmony += 10;
                            },
                            next: 'nextPhase'
                        }
                    ]
                }
            },
            1: { // Выбор материалов
                0: {
                    text: `<p>Настало время выбрать основные материалы для Сильмариллов. Что станет их основой?</p>`,
                    choices: [
                        {
                            text: "Чистейший кристалл из пещер Форменоса",
                            effect: () => {
                                gameState.purity += 20;
                                gameState.durability += 10;
                                gameState.materials.push('crystal');
                            },
                            next: 1
                        },
                        {
                            text: "Адамант - несокрушимое вещество земли",
                            effect: () => {
                                gameState.durability += 25;
                                gameState.brightness += 5;
                                gameState.materials.push('adamant');
                            },
                            next: 1
                        },
                        {
                            text: "Сплав мифрила и звёздной пыли",
                            effect: () => {
                                gameState.magic += 20;
                                gameState.brightness += 15;
                                gameState.materials.push('mithril');
                            },
                            next: 1
                        },
                        {
                            text: "Неизвестное вещество, найденное в метеорите",
                            effect: () => {
                                gameState.magic += 15;
                                gameState.purity += 10;
                                gameState.durability += 15;
                                gameState.pride += 10;
                                gameState.materials.push('meteor');
                            },
                            next: 1
                        }
                    ]
                },
                1: {
                    text: `<p>Как вы будете захватывать свет Древ?</p>`,
                    choices: [
                        {
                            text: "Использовать священные сосуды Варды",
                            effect: () => {
                                gameState.brightness += 25;
                                gameState.purity += 15;
                                gameState.valar += 10;
                                gameState.methods.push('varda_vessels');
                            },
                            next: 2
                        },
                        {
                            text: "Создать собственные линзы для концентрации света",
                            effect: () => {
                                gameState.brightness += 20;
                                gameState.skill += 10;
                                gameState.pride += 5;
                                gameState.methods.push('lenses');
                            },
                            next: 2
                        },
                        {
                            text: "Провести ритуал в час смешения света обоих Древ",
                            effect: () => {
                                gameState.brightness += 30;
                                gameState.harmony += 20;
                                gameState.fatigue += 10;
                                gameState.methods.push('ritual');
                            },
                            next: 2
                        }
                    ]
                },
                2: {
                    text: `<p class="event-alert">⚡ СОБЫТИЕ: Мелькор предлагает помощь!</p>
                    <p>Мелькор тайно приходит к вам и предлагает знания о создании совершенных творений. Что вы сделаете?</p>`,
                    choices: [
                        {
                            text: "Решительно отказаться и сообщить Валар",
                            effect: () => {
                                gameState.valar += 20;
                                gameState.pride -= 10;
                                gameState.purity += 15;
                                gameState.events.push('melkor_rejected');
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Выслушать, но не принимать помощь",
                            effect: () => {
                                gameState.skill += 10;
                                gameState.pride += 5;
                                gameState.valar -= 5;
                                gameState.events.push('melkor_listened');
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Принять знания - цель оправдывает средства",
                            effect: () => {
                                gameState.skill += 20;
                                gameState.magic += 15;
                                gameState.valar -= 30;
                                gameState.purity -= 20;
                                gameState.pride += 20;
                                gameState.events.push('melkor_helped');
                            },
                            next: 'nextPhase'
                        }
                    ]
                }
            },
            2: { // Первый Сильмарил
                0: {
                    text: `<p>Вы начинаете создание первого Сильмарила. Кузница раскалена, материалы готовы. Какую технику вы используете?</p>`,
                    choices: [
                        {
                            text: "Медленная кристаллизация с постепенным насыщением светом",
                            effect: () => {
                                gameState.purity += 15;
                                gameState.brightness += 10;
                                gameState.fatigue += 15;
                            },
                            next: 1
                        },
                        {
                            text: "Взрывное слияние всех элементов в момент наивысшей силы",
                            effect: () => {
                                gameState.magic += 20;
                                gameState.durability += 10;
                                gameState.fatigue += 20;
                                gameState.pride += 10;
                            },
                            next: 1
                        },
                        {
                            text: "Пение песни творения, как делал Илуватар",
                            effect: () => {
                                gameState.harmony += 25;
                                gameState.magic += 15;
                                gameState.inspiration += 10;
                            },
                            next: 1
                        }
                    ]
                },
                1: {
                    text: `<p>Первый камень начинает формироваться, но процесс нестабилен! Что делать?</p>`,
                    choices: [
                        {
                            text: "Стабилизировать собственной жизненной силой",
                            effect: () => {
                                gameState.fatigue += 25;
                                gameState.durability += 15;
                                gameState.magic += 10;
                            },
                            next: 2
                        },
                        {
                            text: "Призвать на помощь силу Древ напрямую",
                            effect: () => {
                                gameState.brightness += 20;
                                gameState.purity += 10;
                                gameState.valar -= 10;
                            },
                            next: 2
                        },
                        {
                            text: "Позволить хаосу найти свой порядок",
                            effect: () => {
                                gameState.harmony += 15;
                                gameState.magic += 25;
                                gameState.purity -= 5;
                            },
                            next: 2
                        }
                    ]
                },
                2: {
                    text: `<p>✨ Первый Сильмарил создан! Он сияет невиданным светом. Как вы его назовёте?</p>`,
                    choices: [
                        {
                            text: "Элленна - Звезда Надежды",
                            effect: () => {
                                gameState.inspiration += 15;
                                gameState.harmony += 10;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Феанаро - в честь себя",
                            effect: () => {
                                gameState.pride += 25;
                                gameState.skill += 5;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Илувао - в честь Единого",
                            effect: () => {
                                gameState.valar += 15;
                                gameState.purity += 10;
                            },
                            next: 'nextPhase'
                        }
                    ]
                }
            },
            3: { // Второй Сильмарил
                0: {
                    text: `<p>Создание второго Сильмарила. Ваши сыновья просят позволить им помочь. Что вы решите?</p>`,
                    choices: [
                        {
                            text: "Позволить всем семерым участвовать в процессе",
                            effect: () => {
                                gameState.harmony += 20;
                                gameState.fatigue -= 10;
                                gameState.skill -= 5;
                            },
                            next: 1
                        },
                        {
                            text: "Взять только Маэдроса - старшего и мудрейшего",
                            effect: () => {
                                gameState.skill += 10;
                                gameState.fatigue -= 5;
                                gameState.harmony += 5;
                            },
                            next: 1
                        },
                        {
                            text: "Работать в одиночестве - это только моё творение",
                            effect: () => {
                                gameState.pride += 15;
                                gameState.skill += 15;
                                gameState.fatigue += 10;
                            },
                            next: 1
                        }
                    ]
                },
                1: {
                    text: `<p class="event-alert">⚡ КРИТИЧЕСКОЕ СОБЫТИЕ!</p>
                    <p>В разгар работы кузница начинает рушиться от выделяемой энергии! Что важнее спасти?</p>`,
                    choices: [
                        {
                            text: "Спасти незавершённый камень любой ценой",
                            effect: () => {
                                gameState.durability += 20;
                                gameState.fatigue += 30;
                                gameState.skill += 10;
                                gameState.events.push('saved_stone');
                            },
                            next: 2
                        },
                        {
                            text: "Защитить помощников и инструменты",
                            effect: () => {
                                gameState.harmony += 25;
                                gameState.valar += 10;
                                gameState.durability -= 10;
                                gameState.events.push('saved_people');
                            },
                            next: 2
                        },
                        {
                            text: "Использовать разрушение как часть процесса создания",
                            effect: () => {
                                gameState.magic += 30;
                                gameState.pride += 20;
                                gameState.purity -= 10;
                                gameState.events.push('used_destruction');
                            },
                            next: 2
                        }
                    ]
                },
                2: {
                    text: `<p>✨ Второй Сильмарил завершён! Он отличается от первого. В чём его особенность?</p>`,
                    choices: [
                        {
                            text: "Он пульсирует как живое сердце",
                            effect: () => {
                                gameState.magic += 15;
                                gameState.harmony += 10;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Его свет может исцелять или ранить",
                            effect: () => {
                                gameState.magic += 20;
                                gameState.durability += 10;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Он отражает душу смотрящего",
                            effect: () => {
                                gameState.purity += 15;
                                gameState.magic += 10;
                            },
                            next: 'nextPhase'
                        }
                    ]
                }
            },
            4: { // Третий Сильмарил
                0: {
                    text: `<p>Для третьего Сильмарила почти не осталось сил. Варда предлагает свою помощь. Примете ли вы её?</p>`,
                    choices: [
                        {
                            text: "С благодарностью принять помощь Звёздной Королевы",
                            effect: () => {
                                gameState.brightness += 30;
                                gameState.valar += 20;
                                gameState.pride -= 15;
                                gameState.fatigue -= 20;
                            },
                            next: 1
                        },
                        {
                            text: "Вежливо отказаться - это должно быть моё творение",
                            effect: () => {
                                gameState.pride += 20;
                                gameState.fatigue += 20;
                                gameState.skill += 10;
                            },
                            next: 1
                        },
                        {
                            text: "Принять помощь, но тайно изменить её дар",
                            effect: () => {
                                gameState.brightness += 20;
                                gameState.magic += 15;
                                gameState.valar -= 15;
                                gameState.pride += 10;
                            },
                            next: 1
                        }
                    ]
                },
                1: {
                    text: `<p>Вы чувствуете, что третий камень будет особенным. Какое качество вы хотите усилить?</p>`,
                    choices: [
                        {
                            text: "Вложить в него всю оставшуюся любовь к Арде",
                            effect: () => {
                                gameState.harmony += 30;
                                gameState.purity += 20;
                                gameState.fatigue += 15;
                            },
                            next: 2
                        },
                        {
                            text: "Сделать его сильнейшим из трёх",
                            effect: () => {
                                gameState.magic += 25;
                                gameState.durability += 20;
                                gameState.pride += 15;
                                gameState.fatigue += 25;
                            },
                            next: 2
                        },
                        {
                            text: "Создать баланс между первыми двумя",
                            effect: () => {
                                gameState.harmony += 20;
                                gameState.brightness += 15;
                                gameState.purity += 15;
                            },
                            next: 2
                        }
                    ]
                },
                2: {
                    text: `<p>✨ Третий Сильмарил готов! Три камня созданы! Но вы чувствуете странное предчувствие...</p>`,
                    choices: [
                        {
                            text: "Немедленно создать защитные чары",
                            effect: () => {
                                gameState.durability += 20;
                                gameState.magic += 15;
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Показать творение всему Валинору",
                            effect: () => {
                                gameState.pride += 25;
                                gameState.inspiration += 10;
                                gameState.events.push('showed_all');
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Спрятать их и никому не говорить",
                            effect: () => {
                                gameState.purity += 10;
                                gameState.valar -= 10;
                                gameState.events.push('hidden');
                            },
                            next: 'nextPhase'
                        }
                    ]
                }
            },
            5: { // Финальная обработка
                0: {
                    text: `<p>Сильмариллы созданы, но требуют финальной обработки. Мелькор восхищается вашей работой и просит показать камни ближе...</p>`,
                    choices: [
                        {
                            text: "Показать издалека, не позволяя прикоснуться",
                            effect: () => {
                                gameState.pride += 10;
                                gameState.events.push('melkor_shown');
                            },
                            next: 1
                        },
                        {
                            text: "Резко отказать и обвинить в злых намерениях",
                            effect: () => {
                                gameState.valar += 10;
                                gameState.pride += 15;
                                gameState.events.push('melkor_accused');
                            },
                            next: 1
                        },
                        {
                            text: "Создать иллюзию камней для показа",
                            effect: () => {
                                gameState.skill += 15;
                                gameState.magic += 10;
                                gameState.events.push('melkor_tricked');
                            },
                            next: 1
                        }
                    ]
                },
                1: {
                    text: `<p>Манвэ просит вас принести клятву о судьбе Сильмариллов. Что вы поклянётесь?</p>`,
                    choices: [
                        {
                            text: "Поклясться использовать их только во благо",
                            effect: () => {
                                gameState.valar += 25;
                                gameState.purity += 20;
                                gameState.pride -= 10;
                            },
                            next: 2
                        },
                        {
                            text: "Поклясться, что никто не прикоснётся к ним без разрешения",
                            effect: () => {
                                gameState.pride += 30;
                                gameState.valar -= 20;
                                gameState.oathTaken = true;
                                gameState.events.push('terrible_oath');
                            },
                            next: 2
                        },
                        {
                            text: "Отказаться давать какие-либо клятвы",
                            effect: () => {
                                gameState.harmony += 15;
                                gameState.valar -= 5;
                            },
                            next: 2
                        }
                    ]
                },
                2: {
                    text: `<p class="event-alert">⚡ ФИНАЛЬНОЕ РЕШЕНИЕ!</p>
                    <p>Где вы будете хранить Сильмариллы?</p>`,
                    choices: [
                        {
                            text: "В железной короне, всегда при себе",
                            effect: () => {
                                gameState.pride += 30;
                                gameState.durability += 10;
                                gameState.events.push('iron_crown');
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "В священном хранилище под защитой Валар",
                            effect: () => {
                                gameState.valar += 30;
                                gameState.purity += 15;
                                gameState.events.push('valar_vault');
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "Разделить между тремя хранилищами",
                            effect: () => {
                                gameState.harmony += 20;
                                gameState.durability += 15;
                                gameState.events.push('separated');
                            },
                            next: 'nextPhase'
                        },
                        {
                            text: "В тайном месте, известном только вам",
                            effect: () => {
                                gameState.pride += 20;
                                gameState.magic += 10;
                                gameState.events.push('secret_place');
                            },
                            next: 'nextPhase'
                        }
                    ]
                }
            }
        };
        
        // Концовки
        function determineEnding() {
            let ending = {
                title: '',
                text: '',
                type: ''
            };
            
            // Вычисляем общие показатели
            const totalSilmarilPower = gameState.brightness + gameState.purity + gameState.magic + gameState.durability + gameState.harmony;
            const totalCharacter = gameState.skill + gameState.inspiration - gameState.fatigue;
            
            // Легендарная концовка
            if (totalSilmarilPower > 250 && gameState.valar > 80 && gameState.harmony > 80) {
                ending.title = "🌟 ТВОРЕЦ СВЕТА НЕЗАМУТНЁННОГО";
                ending.text = `<p>Вы создали совершенные Сильмариллы, сохранив гармонию с Валар и всем Валинором. Камни становятся величайшим сокровищем Арды, их свет исцеляет и защищает. Мелькор не смеет приблизиться к ним, а ваше имя навеки записано среди величайших творцов.</p>
                <p>Сильмариллы остаются в Валиноре, освещая его после гибели Древ. Войны и клятвы не омрачают историю эльфов. Вы прожили долгую жизнь в мире и славе.</p>
                <p><strong>Характеристики Сильмариллов:</strong><br>
                Яркость: ${gameState.brightness} | Чистота: ${gameState.purity} | Магия: ${gameState.magic}<br>
                Прочность: ${gameState.durability} | Гармония: ${gameState.harmony}</p>`;
                ending.type = 'legendary';
            }
            // Трагическая каноничная концовка
            else if (gameState.oathTaken && gameState.pride > 60) {
                ending.title = "⚔️ ПРОКЛЯТИЕ ФЕАНОРА";
                ending.text = `<p>Вы создали величайшие драгоценности, но гордыня и страшная клятва обрекли вас и ваш род на вечные страдания. Мелькор похитит Сильмариллы, убьёт вашего отца и уничтожит Древа.</p>
                <p>Ваша клятва приведёт к Исходу Нолдор, братоубийственным войнам и бесчисленным смертям. Сильмариллы станут причиной величайших трагедий Первой Эпохи.</p>
                <p>Вы падёте в битве, так и не вернув своё творение, а ваши сыновья продолжат безнадёжную борьбу...</p>`;
                ending.type = 'tragic';
            }
            // Тёмная концовка
            else if (gameState.events.includes('melkor_helped') && gameState.valar < 30) {
                ending.title = "👁️ СЛУГА ТЬМЫ";
                ending.text = `<p>Приняв помощь Мелькора, вы незаметно попали под его влияние. Сильмариллы созданы, но в них есть изъян - тёмная связь с Морготом.</p>
                <p>Когда он призывает их, камни отзываются. Вы пытаетесь сопротивляться, но слишком поздно. Тьма в камнях пробуждается, и их свет обращается во тьму.</p>
                <p>Вы становитесь первым из эльфов, добровольно служащих Тьме, а ваши Сильмариллы - орудиями порчи и разрушения...</p>`;
                ending.type = 'dark';
            }
            // Героическая концовка
            else if (totalCharacter > 100 && gameState.events.includes('saved_people')) {
                ending.title = "🛡️ ЗАЩИТНИК ВАЛИНОРА";
                ending.text = `<p>Вы создали Сильмариллы, но, что важнее, показали пример истинного величия - готовность жертвовать ради других. Когда Мелькор попытался похитить камни, вы были готовы.</p>
                <p>Благодаря вашей предусмотрительности и защитным чарам, его план провалился. Вы лично сразились с ним, защищая своё творение и весь Валинор.</p>
                <p>Хотя битва стоила вам жизни, Сильмариллы остались в безопасности и стали вечным символом надежды и мужества эльфов.</p>`;
                ending.type = 'heroic';
            }
            // Мудрая концовка
            else if (gameState.harmony > 100 && gameState.fatigue < 40) {
                ending.title = "📖 МУДРЕЦ АРДЫ";
                ending.text = `<p>Создав Сильмариллы в гармонии и мудрости, вы поняли истинную природу творения. Камни прекрасны, но вы не привязаны к ним болезненно.</p>
                <p>Когда приходит испытание, вы добровольно отдаёте один камень Валар, другой - людям, третий оставляете эльфам. Так свет распространяется по всей Арде.</p>
                <p>Вы живёте долго, делясь мудростью и знаниями, став величайшим учителем и философом среди эльдар.</p>`;
                ending.type = 'wise';
            }
            // Изгнание
            else if (gameState.valar < 20) {
                ending.title = "🌑 ИЗГНАННИК";
                ending.text = `<p>Ваше отчуждение от Валар и гордыня привели к изгнанию из Валинора ещё до похищения Сильмариллов. Вы забрали камни с собой в Средиземье.</p>
                <p>Там, вдали от света Древ, Сильмариллы постепенно тускнеют. Вы пытаетесь восстановить их сияние, но без благословения Валинора это невозможно.</p>
                <p>В конце концов, вы исчезаете в восточных землях вместе с угасающими камнями, став легендой о падшем творце...</p>`;
                ending.type = 'exile';
            }
            // Безумие
            else if (gameState.fatigue > 80 && gameState.pride > 50) {
                ending.title = "🌀 БЕЗУМИЕ ТВОРЦА";
                ending.text = `<p>Создание Сильмариллов истощило не только ваше тело, но и разум. Одержимость камнями переросла в безумие.</p>
                <p>Вы видите врагов повсюду, не доверяете даже семье. Запершись в кузнице с Сильмариллами, вы пытаетесь создать четвёртый камень, но это невозможно.</p>
                <p>В конце концов, ваши сыновья вынуждены силой забрать у вас камни. Вы проводите остаток дней в горьком одиночестве, бормоча о преданном свете...</p>`;
                ending.type = 'madness';
            }
            // Нейтральная концовка
            else {
                ending.title = "💎 ТВОРЕЦ СИЛЬМАРИЛЛОВ";
                ending.text = `<p>Вы успешно создали три Сильмарилла - величайшее творение в истории Арды. Их свет прекрасен, хотя и не идеален.</p>
                <p>Камни становятся предметом восхищения и зависти. Вы храните их, но чувствуете растущее беспокойство о их судьбе.</p>
                <p>История ещё не написана. Возможно, вы сможете защитить своё творение, а возможно, грядущие события изменят всё. Время покажет...</p>
                <p><strong>Характеристики Сильмариллов:</strong><br>
                Яркость: ${gameState.brightness} | Чистота: ${gameState.purity} | Магия: ${gameState.magic}<br>
                Прочность: ${gameState.durability} | Гармония: ${gameState.harmony}</p>`;
                ending.type = 'neutral';
            }
            
            return ending;
        }
        
        // Функция обновления UI
        function updateUI() {
            // Обновляем статы
            document.getElementById('skill').textContent = gameState.skill;
            document.getElementById('inspiration').textContent = gameState.inspiration;
            document.getElementById('pride').textContent = gameState.pride;
            document.getElementById('valar').textContent = gameState.valar;
            document.getElementById('fatigue').textContent = gameState.fatigue;
            
            document.getElementById('brightness').textContent = gameState.brightness;
            document.getElementById('purity').textContent = gameState.purity;
            document.getElementById('magic').textContent = gameState.magic;
            document.getElementById('durability').textContent = gameState.durability;
            document.getElementById('harmony').textContent = gameState.harmony;
            
            // Обновляем фазу
            document.getElementById('phase').textContent = `Фаза: ${phases[gameState.phase]}`;
        }
        
        // Функция отображения сценария
        function displayScenario() {
            const scenario = scenarios[gameState.phase][gameState.step];
            document.getElementById('gameText').innerHTML = scenario.text;
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            scenario.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                button.onclick = () => makeChoice(choice);
                choicesDiv.appendChild(button);
            });
        }
        
        // Функция выбора
        function makeChoice(choice) {
            // Применяем эффекты
            choice.effect();
            
            // Ограничиваем значения
            gameState.skill = Math.max(0, Math.min(100, gameState.skill));
            gameState.inspiration = Math.max(0, Math.min(100, gameState.inspiration));
            gameState.pride = Math.max(0, Math.min(100, gameState.pride));
            gameState.valar = Math.max(0, Math.min(100, gameState.valar));
            gameState.fatigue = Math.max(0, Math.min(100, gameState.fatigue));
            
            updateUI();
            
            // Переходим к следующему шагу
            if (choice.next === 'nextPhase') {
                gameState.phase++;
                gameState.step = 0;
                
                if (gameState.phase >= phases.length - 1) {
                    // Показываем концовку
                    showEnding();
                } else {
                    displayScenario();
                }
            } else {
                gameState.step = choice.next;
                displayScenario();
            }
        }
        
        // Функция показа концовки
        function showEnding() {
            const ending = determineEnding();
            
            let endingClass = '';
            if (ending.type === 'legendary') endingClass = 'silmaril-glow';
            
            document.getElementById('gameText').innerHTML = `
                <div class="ending-title ${endingClass}">${ending.title}</div>
                ${ending.text}
            `;
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '<button class="restart-btn" onclick="restartGame()">Начать заново</button>';
            
            document.getElementById('phase').textContent = 'Эпилог';
        }
        
        // Функция перезапуска
        function restartGame() {
            gameState = {
                phase: 0,
                step: 0,
                skill: 50,
                inspiration: 50,
                pride: 30,
                valar: 70,
                fatigue: 0,
                brightness: 0,
                purity: 0,
                magic: 0,
                durability: 0,
                harmony: 0,
                materials: [],
                methods: [],
                events: [],
                oathTaken: false,
                helpFromValar: false,
                secretKnowledge: false
            };
            
            updateUI();
            displayScenario();
        }
        
        // Инициализация игры
        displayScenario();
        updateUI();
    </script>
</body>
</html>