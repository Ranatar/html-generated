<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É–∑–Ω–∏—Ü–∞ –§–µ–∞–Ω–æ—Ä–∞: –°–æ–∑–¥–∞–Ω–∏–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Crimson+Text:ital,wght@0,400;1,400&display=swap');
        
        :root {
            --primary: #2c3e50;
            --gold: #f39c12;
            --silver: #95a5a6;
            --mithril: #e8f4f8;
            --fire: #e74c3c;
            --nature: #27ae60;
            --water: #3498db;
            --shadow: #1a1a2e;
            --light: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.03" d="M0,96L48,112C96,128,192,160,288,165.3C384,171,480,149,576,154.7C672,160,768,192,864,197.3C960,203,1056,181,1152,165.3C1248,149,1344,139,1392,133.3L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat center;
            background-size: cover;
            opacity: 0.1;
            pointer-events: none;
        }
        
        .game-container {
            max-width: 900px;
            width: 100%;
            background: rgba(26, 26, 46, 0.95);
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(243, 156, 18, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--shadow));
            padding: 30px;
            text-align: center;
            border-radius: 18px 18px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '‚ú¶';
            position: absolute;
            font-size: 200px;
            opacity: 0.05;
            top: -50px;
            right: -50px;
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
            position: relative;
        }
        
        .subtitle {
            font-style: italic;
            color: var(--mithril);
            font-size: 1.1rem;
        }
        
        .content {
            padding: 30px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(52, 73, 94, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(243, 156, 18, 0.2);
        }
        
        .stat {
            text-align: center;
            padding: 15px;
            background: rgba(44, 62, 80, 0.5);
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--gold), var(--silver), var(--gold));
            border-radius: 10px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        
        .stat:hover::before {
            opacity: 0.5;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--silver);
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .stat-value {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--gold);
            font-weight: 600;
        }
        
        .stat-bar {
            height: 4px;
            background: rgba(149, 165, 166, 0.2);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--fire));
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
        }
        
        .event-container {
            background: rgba(52, 73, 94, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(149, 165, 166, 0.2);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .event-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .event-icon {
            font-size: 1.8rem;
        }
        
        .event-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: var(--light);
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .choice-btn {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(155, 89, 182, 0.2));
            color: var(--light);
            border: 2px solid rgba(243, 156, 18, 0.3);
            padding: 15px 20px;
            border-radius: 10px;
            font-family: 'Crimson Text', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: left;
        }
        
        .choice-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(243, 156, 18, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
        }
        
        .choice-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .choice-btn:hover {
            border-color: var(--gold);
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(243, 156, 18, 0.3);
        }
        
        .choice-requirement {
            font-size: 0.9rem;
            color: var(--silver);
            font-style: italic;
        }
        
        .choice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(149, 165, 166, 0.1);
        }
        
        .choice-btn:disabled:hover {
            transform: none;
            box-shadow: none;
            border-color: rgba(243, 156, 18, 0.3);
        }
        
        .ending {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(231, 76, 60, 0.1));
            border-radius: 15px;
            border: 2px solid var(--gold);
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(243, 156, 18, 0.3); }
            50% { box-shadow: 0 0 40px rgba(243, 156, 18, 0.6); }
        }
        
        .ending-title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .ending-text {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, var(--gold), var(--fire));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }
        
        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }
        
        .materials-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding: 15px;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        
        .material-tag {
            background: rgba(39, 174, 96, 0.2);
            color: var(--nature);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .material-icon {
            font-size: 1rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            border: 2px solid var(--gold);
            border-radius: 10px;
            padding: 15px 20px;
            max-width: 300px;
            animation: slideIn 0.5s ease, slideOut 0.5s ease 2.5s;
            animation-fill-mode: forwards;
            z-index: 1000;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        .special-event {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(52, 152, 219, 0.2));
            border: 2px solid rgba(155, 89, 182, 0.5);
        }
        
        .legendary-event {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.3), rgba(231, 76, 60, 0.3));
            border: 2px solid var(--gold);
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.4);
        }
        
        .mini-game {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .puzzle-piece {
            aspect-ratio: 1;
            background: rgba(52, 73, 94, 0.5);
            border: 2px solid rgba(243, 156, 18, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .puzzle-piece:hover {
            background: rgba(243, 156, 18, 0.2);
            transform: scale(1.1);
        }
        
        .puzzle-piece.selected {
            background: rgba(39, 174, 96, 0.3);
            border-color: var(--nature);
        }
        
        .relations-display {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .relation-badge {
            background: rgba(231, 76, 60, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .positive-relation {
            background: rgba(39, 174, 96, 0.2);
            color: var(--nature);
        }
        
        .negative-relation {
            background: rgba(231, 76, 60, 0.2);
            color: var(--fire);
        }
        
        .achievement {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--gold), var(--fire));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(243, 156, 18, 0.5);
            animation: achievementPop 3s ease forwards;
            z-index: 1000;
        }
        
        @keyframes achievementPop {
            0% {
                opacity: 0;
                transform: translateY(100px) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translateY(0) scale(1.1);
            }
            30% {
                transform: translateY(0) scale(1);
            }
            80% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(100px) scale(0.5);
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .choice-btn {
                padding: 12px 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>–ö—É–∑–Ω–∏—Ü–∞ –§–µ–∞–Ω–æ—Ä–∞</h1>
            <div class="subtitle">–°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–ª–∏—á–∞–π—à–∏—Ö —Ç–≤–æ—Ä–µ–Ω–∏–π –ê—Ä–¥—ã</div>
        </div>
        
        <div class="content">
            <div class="stats-container">
                <div class="stat">
                    <div class="stat-label">–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ</div>
                    <div class="stat-value" id="skill">50</div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="skill-bar" style="width: 50%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ</div>
                    <div class="stat-value" id="inspiration">50</div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="inspiration-bar" style="width: 50%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">–û–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å</div>
                    <div class="stat-value" id="obsession">30</div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="obsession-bar" style="width: 30%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">–°–≤–µ—Ç –î—Ä–µ–≤</div>
                    <div class="stat-value" id="light">40</div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="light-bar" style="width: 40%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">–†–µ–ø—É—Ç–∞—Ü–∏—è</div>
                    <div class="stat-value" id="reputation">50</div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="reputation-bar" style="width: 50%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">–†–µ—Å—É—Ä—Å—ã</div>
                    <div class="stat-value" id="resources">50</div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="resources-bar" style="width: 50%"></div>
                    </div>
                </div>
            </div>
            
            <div id="event-display"></div>
        </div>
    </div>

    <script>
        const gameState = {
            skill: 50,
            inspiration: 50,
            obsession: 30,
            light: 40,
            reputation: 50,
            resources: 50,
            eventIndex: 0,
            materials: [],
            relations: {},
            achievements: [],
            silmarilCount: 0,
            secretsDiscovered: [],
            path: 'normal',
            choices: []
        };

        const materials = {
            mithril: { name: '–ú–∏—Ñ—Ä–∏–ª', icon: '‚ö™', rarity: 'rare' },
            starDust: { name: '–ó–≤—ë–∑–¥–Ω–∞—è –ø—ã–ª—å', icon: '‚ú®', rarity: 'legendary' },
            treeEssence: { name: '–≠—Å—Å–µ–Ω—Ü–∏—è –î—Ä–µ–≤', icon: 'üå≥', rarity: 'legendary' },
            dragonScale: { name: '–ß–µ—à—É—è –¥—Ä–∞–∫–æ–Ω–∞', icon: 'üêâ', rarity: 'epic' },
            valarBlessing: { name: '–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –í–∞–ª–∞—Ä', icon: 'üåü', rarity: 'legendary' },
            shadowGem: { name: '–¢–µ–Ω–µ–≤–æ–π –∫–∞–º–µ–Ω—å', icon: 'üíé', rarity: 'epic' },
            moonstone: { name: '–õ—É–Ω–Ω—ã–π –∫–∞–º–µ–Ω—å', icon: 'üåô', rarity: 'rare' },
            fireHeart: { name: '–°–µ—Ä–¥—Ü–µ –ø–ª–∞–º–µ–Ω–∏', icon: 'üî•', rarity: 'epic' },
            iceEssence: { name: '–õ–µ–¥—è–Ω–∞—è —ç—Å—Å–µ–Ω—Ü–∏—è', icon: '‚ùÑÔ∏è', rarity: 'rare' },
            timeFragment: { name: '–û—Å–∫–æ–ª–æ–∫ –≤—Ä–µ–º–µ–Ω–∏', icon: '‚è≥', rarity: 'legendary' }
        };

        const events = [
            // –ù–∞—á–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            {
                id: 'start',
                type: 'normal',
                title: '‚öíÔ∏è –ù–∞—á–∞–ª–æ –≤–µ–ª–∏–∫–æ–≥–æ —Ç—Ä—É–¥–∞',
                text: '–¢—ã —Å—Ç–æ–∏—à—å –≤ —Å–≤–æ–µ–π –∫—É–∑–Ω–∏—Ü–µ, –≥–æ—Ç–æ–≤—ã–π –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ–ª–∏—á–∞–π—à–∏—Ö —Ç–≤–æ—Ä–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ê—Ä–¥—ã. –°–≤–µ—Ç –î—Ä–µ–≤ —Å—Ç—Ä—É–∏—Ç—Å—è —á–µ—Ä–µ–∑ –æ–∫–Ω–∞, –æ—Å–≤–µ—â–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ–≤–∏–¥–∞–Ω–Ω–æ–π –∫—Ä–∞—Å–æ—Ç—ã. –ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å –ø–µ—Ä–≤—ã–º?',
                choices: [
                    {
                        text: '–ú–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —É —Å–≤–µ—Ç–∞ –î—Ä–µ–≤, –∏—â–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ',
                        requirements: {},
                        effects: { inspiration: 20, light: 15, obsession: 5 },
                        next: 'tree_meditation'
                    },
                    {
                        text: '–ò–∑—É—á–∏—Ç—å –¥—Ä–µ–≤–Ω–∏–µ –∑–Ω–∞–Ω–∏—è –ê—É–ª–µ',
                        requirements: {},
                        effects: { skill: 15, inspiration: 5, obsession: 10 },
                        next: 'aule_knowledge'
                    },
                    {
                        text: '–°–æ–±—Ä–∞—Ç—å —Ä–µ–¥—á–∞–π—à–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                        requirements: {},
                        effects: { resources: 20, skill: 5 },
                        materials: ['mithril'],
                        next: 'material_gathering'
                    },
                    {
                        text: '–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–∞–π–Ω—ã–π —Ä–∏—Ç—É–∞–ª –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è',
                        requirements: { obsession: 25 },
                        effects: { obsession: 20, skill: 10, reputation: -10 },
                        materials: ['shadowGem'],
                        next: 'secret_ritual'
                    }
                ]
            },
            
            // –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É –î—Ä–µ–≤
            {
                id: 'tree_meditation',
                type: 'special',
                title: 'üå≥ –û—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ –î—Ä–µ–≤',
                text: '–í –º–µ–¥–∏—Ç–∞—Ü–∏–∏ —Ç—ã –≤–∏–¥–∏—à—å –≤–∏–¥–µ–Ω–∏–µ: –õ–∞—É—Ä–µ–ª–∏–Ω –∏ –¢–µ–ª—å–ø–µ—Ä–∏–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–±–µ —Ç–∞–π–Ω—É —Å–≤–æ–µ–≥–æ —Å–≤–µ—Ç–∞. –ù–æ –≤–∏–¥–µ–Ω–∏–µ —Ä–∞–∑–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è...',
                choices: [
                    {
                        text: '–°–ª–µ–¥–æ–≤–∞—Ç—å –∑–æ–ª–æ—Ç–æ–º—É –ø—É—Ç–∏ –õ–∞—É—Ä–µ–ª–∏–Ω',
                        requirements: { light: 30 },
                        effects: { light: 25, inspiration: 15, skill: 10 },
                        materials: ['treeEssence'],
                        next: 'golden_path'
                    },
                    {
                        text: '–°–ª–µ–¥–æ–≤–∞—Ç—å —Å–µ—Ä–µ–±—Ä—è–Ω–æ–º—É –ø—É—Ç–∏ –¢–µ–ª—å–ø–µ—Ä–∏–æ–Ω–∞',
                        requirements: { inspiration: 40 },
                        effects: { light: 20, skill: 20, obsession: -5 },
                        materials: ['moonstone'],
                        next: 'silver_path'
                    },
                    {
                        text: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–±–∞ –ø—É—Ç–∏',
                        requirements: { skill: 60, inspiration: 60 },
                        effects: { light: 40, inspiration: 30, obsession: 15 },
                        materials: ['treeEssence', 'starDust'],
                        next: 'dual_path'
                    }
                ]
            },
            
            // –ó–Ω–∞–Ω–∏—è –ê—É–ª–µ
            {
                id: 'aule_knowledge',
                type: 'normal',
                title: 'üìö –ù–∞—Å–ª–µ–¥–∏–µ –ê—É–ª–µ',
                text: '–í –¥—Ä–µ–≤–Ω–∏—Ö —Å–≤–∏—Ç–∫–∞—Ö —Ç—ã –Ω–∞—Ö–æ–¥–∏—à—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ç–µ—Ö–Ω–∏–∫–µ, –∫–æ—Ç–æ—Ä—É—é —Å–∞–º –ê—É–ª–µ —Å—á–∏—Ç–∞–ª —Å–ª–∏—à–∫–æ–º –æ–ø–∞—Å–Ω–æ–π. –†—è–¥–æ–º –ª–µ–∂–∏—Ç –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π, –Ω–æ –º–µ–Ω–µ–µ –º–æ—â–Ω—ã–π –º–µ—Ç–æ–¥.',
                choices: [
                    {
                        text: '–ò–∑—É—á–∏—Ç—å –∑–∞–ø—Ä–µ—Ç–Ω—É—é —Ç–µ—Ö–Ω–∏–∫—É',
                        requirements: { skill: 45 },
                        effects: { skill: 30, obsession: 25, reputation: -15 },
                        next: 'forbidden_technique'
                    },
                    {
                        text: '–û—Å–≤–æ–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥',
                        requirements: {},
                        effects: { skill: 20, reputation: 10 },
                        next: 'safe_method'
                    },
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ç–µ—Ö–Ω–∏–∫—É',
                        requirements: { inspiration: 70, skill: 50 },
                        effects: { skill: 25, inspiration: 20, reputation: 15 },
                        materials: ['fireHeart'],
                        next: 'original_technique'
                    }
                ]
            },
            
            // –°–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
            {
                id: 'material_gathering',
                type: 'normal',
                title: 'üíé –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤',
                text: '–¢–≤–æ–∏ –ø–æ–∏—Å–∫–∏ –ø—Ä–∏–≤–µ–ª–∏ —Ç–µ–±—è –∫ —Ä–∞–∑–≤–∏–ª–∫–µ: –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –æ–ø–∞—Å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∑–∞ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏–ª–∏ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –º–∞—Å—Ç–µ—Ä–∞–º–∏ –æ–± –æ–±–º–µ–Ω–µ.',
                choices: [
                    {
                        text: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø–æ–¥–∑–µ–º–µ–ª—å—è –ú–æ—Ä–∏–∏',
                        requirements: { resources: 40 },
                        effects: { resources: -20, skill: 15 },
                        materials: ['mithril', 'dragonScale'],
                        next: 'moria_expedition'
                    },
                    {
                        text: '–¢–æ—Ä–≥–æ–≤–∞—Ç—å —Å —ç–ª—å—Ñ–∏–π—Å–∫–∏–º–∏ –º–∞—Å—Ç–µ—Ä–∞–º–∏',
                        requirements: { reputation: 45 },
                        effects: { resources: 15, reputation: 10 },
                        materials: ['moonstone'],
                        next: 'elf_trade'
                    },
                    {
                        text: '–ò—Å–∫–∞—Ç—å –≤ —Ç–∞–π–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –í–∞–ª–∏–Ω–æ—Ä–∞',
                        requirements: { light: 50, reputation: 60 },
                        effects: { light: 10, resources: 30 },
                        materials: ['starDust', 'treeEssence'],
                        next: 'valinor_search'
                    },
                    {
                        text: '–ü—Ä–∏–∑–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–∏–ª–æ–π –≤–æ–ª–∏',
                        requirements: { obsession: 60, skill: 70 },
                        effects: { obsession: 20, resources: 40, light: -20 },
                        materials: ['shadowGem', 'fireHeart'],
                        next: 'material_summoning'
                    }
                ]
            },
            
            // –¢–∞–π–Ω—ã–π —Ä–∏—Ç—É–∞–ª
            {
                id: 'secret_ritual',
                type: 'legendary',
                title: 'üåë –ó–∞–ø—Ä–µ—Ç–Ω—ã–π —Ä–∏—Ç—É–∞–ª',
                text: '–î—Ä–µ–≤–Ω–∏–π —Ä–∏—Ç—É–∞–ª –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç –≤ —Ç–µ–±–µ —Å–∏–ª—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö —Ç—ã –Ω–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–ª. –¢–µ–Ω–∏ —Ç–∞–Ω—Ü—É—é—Ç –≤–æ–∫—Ä—É–≥, –∏ —Ç—ã —Å–ª—ã—à–∏—à—å —à—ë–ø–æ—Ç... –ú–µ–ª—å–∫–æ—Ä? –ò–ª–∏ —Ç–≤–æ—ë —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ ambition?',
                choices: [
                    {
                        text: '–ü—Ä–∏–Ω—è—Ç—å —Ç—ë–º–Ω—É—é —Å–∏–ª—É –ø–æ–ª–Ω–æ—Å—Ç—å—é',
                        requirements: { obsession: 50 },
                        effects: { obsession: 40, skill: 35, light: -30, reputation: -30 },
                        materials: ['shadowGem', 'timeFragment'],
                        next: 'dark_embrace'
                    },
                    {
                        text: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–ª—É, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å',
                        requirements: { skill: 70, inspiration: 60 },
                        effects: { skill: 30, obsession: 15, light: -10 },
                        materials: ['shadowGem'],
                        next: 'controlled_darkness'
                    },
                    {
                        text: '–û—Ç–≤–µ—Ä–≥–Ω—É—Ç—å —Ç—å–º—É –∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –í–∞–ª–∞—Ä',
                        requirements: { light: 60 },
                        effects: { light: 30, reputation: 20, obsession: -20 },
                        materials: ['valarBlessing'],
                        next: 'valar_redemption'
                    }
                ]
            },
            
            // –ü—É—Ç—å –∑–æ–ª–æ—Ç–æ–≥–æ —Å–≤–µ—Ç–∞
            {
                id: 'golden_path',
                type: 'special',
                title: '‚òÄÔ∏è –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –õ–∞—É—Ä–µ–ª–∏–Ω',
                text: '–ó–æ–ª–æ—Ç–æ–π —Å–≤–µ—Ç –õ–∞—É—Ä–µ–ª–∏–Ω –Ω–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–≤–æ—é –∫—É–∑–Ω–∏—Ü—É. –¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—É—é —Å–∏–ª—É, –Ω–æ —Ç–∞–∫–∂–µ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –î—Ä–µ–≤–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–µ–±–µ –≤—ã–±–æ—Ä –¥–∞—Ä–æ–≤.',
                choices: [
                    {
                        text: '–ü—Ä–∏–Ω—è—Ç—å –¥–∞—Ä –≤–µ—á–Ω–æ–≥–æ –ø–ª–∞–º–µ–Ω–∏',
                        requirements: { light: 55 },
                        effects: { skill: 25, light: 20, inspiration: 15 },
                        materials: ['fireHeart', 'treeEssence'],
                        next: 'eternal_flame'
                    },
                    {
                        text: '–ü–æ–ø—Ä–æ—Å–∏—Ç—å –º—É–¥—Ä–æ—Å—Ç—å –≤–µ–∫–æ–≤',
                        requirements: { inspiration: 65 },
                        effects: { inspiration: 35, skill: 20, obsession: -10 },
                        next: 'ancient_wisdom'
                    },
                    {
                        text: '–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å–≤–æ—é –¥—É—à—É —Å –î—Ä–µ–≤–æ–º',
                        requirements: { light: 70, obsession: 20 },
                        effects: { light: 50, obsession: 30, skill: 30 },
                        materials: ['treeEssence', 'starDust', 'fireHeart'],
                        next: 'soul_merge'
                    }
                ]
            },
            
            // –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –≤ –ú–æ—Ä–∏—é
            {
                id: 'moria_expedition', 
                type: 'special',
                title: '‚õèÔ∏è –ì–ª—É–±–∏–Ω—ã –ú–æ—Ä–∏–∏',
                text: '–í –¥—Ä–µ–≤–Ω–∏—Ö –∑–∞–ª–∞—Ö –ö–∞–∑–∞–¥-–î—É–º–∞ —Ç—ã –Ω–∞—Ö–æ–¥–∏—à—å –Ω–µ —Ç–æ–ª—å–∫–æ –º–∏—Ñ—Ä–∏–ª, –Ω–æ –∏ —Å–ª–µ–¥—ã –µ—â–µ –±–æ–ª–µ–µ –¥—Ä–µ–≤–Ω–µ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏. –ó–∞–≥–∞–¥–æ—á–Ω—ã–µ —Ä—É–Ω—ã —Å–≤–µ—Ç—è—Ç—Å—è –Ω–∞ —Å—Ç–µ–Ω–∞—Ö.',
                puzzle: 'rune_puzzle',
                choices: [
                    {
                        text: '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ä—É–Ω—ã',
                        requirements: { skill: 55 },
                        effects: { skill: 20, inspiration: 25 },
                        materials: ['timeFragment'],
                        next: 'ancient_secret'
                    },
                    {
                        text: '–°–æ–±—Ä–∞—Ç—å —Å–æ–∫—Ä–æ–≤–∏—â–∞ –∏ —É–π—Ç–∏',
                        requirements: {},
                        effects: { resources: 40, reputation: 5 },
                        materials: ['mithril', 'dragonScale'],
                        next: 'treasure_haul'
                    },
                    {
                        text: '–ü—Ä–æ–±—É–¥–∏—Ç—å –¥—Ä–µ–≤–Ω–µ–≥–æ —Å—Ç—Ä–∞–∂–∞',
                        requirements: { obsession: 45, skill: 60 },
                        effects: { skill: 30, obsession: 20, resources: -30 },
                        materials: ['dragonScale', 'shadowGem', 'fireHeart'],
                        next: 'guardian_awakening'
                    }
                ]
            },
            
            // –ú–∏–Ω–∏-–∏–≥—Ä–∞ —Å —Ä—É–Ω–∞–º–∏
            {
                id: 'rune_puzzle_result',
                type: 'mini_game',
                title: 'üéØ –†–∞–∑–≥–∞–¥–∫–∞ —Ä—É–Ω',
                text: '–¢–≤–æ—ë –ø–æ–Ω–∏–º–∞–Ω–∏–µ –¥—Ä–µ–≤–Ω–∏—Ö —Ä—É–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!',
                choices: [
                    {
                        text: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞–Ω–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ',
                        requirements: {},
                        effects: { skill: 25, inspiration: 20 },
                        materials: ['timeFragment'],
                        next: 'immediate_use'
                    },
                    {
                        text: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏–µ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–≤–æ—Ä–µ–Ω–∏—è',
                        requirements: {},
                        effects: { inspiration: 30 },
                        next: 'preserved_knowledge'
                    }
                ]
            },
            
            // –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ —Å—Ç—Ä–∞–∂–∞
            {
                id: 'guardian_awakening',
                type: 'legendary',
                title: 'üê≤ –î—Ä–µ–≤–Ω–∏–π —Å—Ç—Ä–∞–∂',
                text: '–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç—Å—è –ì–ª–∞—É—Ä—É–Ω–≥-–ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫, –¥—Ä–∞–∫–æ–Ω —Å—Ç–∞—Ä—à–µ —Å–∞–º–æ–≥–æ –ú–µ–ª—å–∫–æ—Ä–∞. –û–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–¥–µ–ª–∫—É: –µ–≥–æ –ø–ª–∞–º—è –¥–ª—è —Ç–≤–æ–∏—Ö –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ –≤ –æ–±–º–µ–Ω –Ω–∞... —á—Ç–æ-—Ç–æ —Ü–µ–Ω–Ω–æ–µ.',
                choices: [
                    {
                        text: '–û—Ç–¥–∞—Ç—å —á–∞—Å—Ç—å —Å–≤–æ–µ–π –¥—É—à–∏',
                        requirements: { obsession: 60 },
                        effects: { obsession: 30, skill: 40, light: -25 },
                        materials: ['dragonScale', 'fireHeart', 'shadowGem'],
                        silmarilBonus: 1,
                        next: 'soul_bargain'
                    },
                    {
                        text: '–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–æ—é–∑ –ø—Ä–æ—Ç–∏–≤ –ú–µ–ª—å–∫–æ—Ä–∞',
                        requirements: { reputation: 70, skill: 65 },
                        effects: { reputation: 25, skill: 30 },
                        materials: ['dragonScale', 'fireHeart'],
                        next: 'dragon_alliance'
                    },
                    {
                        text: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–¥—á–∏–Ω–∏—Ç—å –¥—Ä–∞–∫–æ–Ω–∞',
                        requirements: { obsession: 70, skill: 75 },
                        effects: { obsession: 40, skill: 35, reputation: -40 },
                        materials: ['dragonScale', 'fireHeart', 'shadowGem', 'timeFragment'],
                        silmarilBonus: 2,
                        next: 'dragon_domination'
                    },
                    {
                        text: '–ë–µ–∂–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ —É—Å–ø–µ–ª –≤–∑—è—Ç—å',
                        requirements: {},
                        effects: { resources: 20, reputation: -10 },
                        materials: ['mithril'],
                        next: 'hasty_retreat'
                    }
                ]
            },
            
            // –í—Å—Ç—Ä–µ—á–∞ —Å –í–∞–ª–∞—Ä
            {
                id: 'valar_redemption',
                type: 'special',
                title: '‚≠ê –°—É–¥ –í–∞–ª–∞—Ä',
                text: '–ú–∞–Ω–≤—ç, –í–∞—Ä–¥–∞ –∏ –ê—É–ª–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π. –û–Ω–∏ –≥–æ—Ç–æ–≤—ã –¥–∞—Ç—å —Ç–µ–±–µ –≤—Ç–æ—Ä–æ–π —à–∞–Ω—Å, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ —Ç–≤–æ–µ–π –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç–∏ —Å–≤–µ—Ç—É.',
                choices: [
                    {
                        text: '–ü–æ–∫–ª—è—Å—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã –≤–æ —Å–ª–∞–≤—É –í–∞–ª–∞—Ä',
                        requirements: { light: 65 },
                        effects: { light: 40, reputation: 50, obsession: -30 },
                        materials: ['valarBlessing', 'treeEssence'],
                        next: 'valar_oath'
                    },
                    {
                        text: '–ü–æ–ø—Ä–æ—Å–∏—Ç—å –∏—Ö —Å–∏–ª—É, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å',
                        requirements: { skill: 70, reputation: 60 },
                        effects: { skill: 30, light: 20, reputation: 15 },
                        materials: ['valarBlessing'],
                        next: 'independent_blessing'
                    },
                    {
                        text: '–û–±–º–∞–Ω—É—Ç—å –í–∞–ª–∞—Ä, –ø—Ä–∏—Ç–≤–æ—Ä–∏–≤—à–∏—Å—å —Ä–∞—Å–∫–∞—è–≤—à–∏–º—Å—è',
                        requirements: { obsession: 55 },
                        effects: { obsession: 25, skill: 20, light: 10, reputation: -20 },
                        materials: ['shadowGem'],
                        next: 'deception'
                    }
                ]
            },
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤
            {
                id: 'silmaril_creation',
                type: 'legendary',
                title: 'üíé –ß–∞—Å —Ç–≤–æ—Ä–µ–Ω–∏—è',
                text: '–ù–∞—Å—Ç–∞–ª –º–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã. –í—Å–µ —Ç–≤–æ–∏ –∑–Ω–∞–Ω–∏—è, –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Å–∏–ª—ã —Å–æ–±—Ä–∞–Ω—ã –≤–æ–µ–¥–∏–Ω–æ. –ö–∞–∫ —Ç—ã —Å–æ–∑–¥–∞—à—å –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã?',
                choices: [
                    {
                        text: '–°–ª–µ–¥–æ–≤–∞—Ç—å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–º—É –º–µ—Ç–æ–¥—É',
                        requirements: { skill: 70, light: 60 },
                        effects: { skill: 20, light: 20 },
                        silmarils: 3,
                        next: 'traditional_creation'
                    },
                    {
                        text: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞–Ω–∏—è',
                        requirements: { obsession: 70, skill: 75 },
                        effects: { obsession: 30, skill: 30 },
                        silmarils: 4,
                        next: 'forbidden_creation'
                    },
                    {
                        text: '–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å–≤–µ—Ç –∏ —Ç—å–º—É –≤ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ',
                        requirements: { skill: 80, inspiration: 80, light: 50, obsession: 50 },
                        effects: { skill: 40, inspiration: 40 },
                        silmarils: 5,
                        next: 'perfect_balance'
                    },
                    {
                        text: '–í–ª–æ–∂–∏—Ç—å –≤—Å—é —Å–≤–æ—é —Å—É—â–Ω–æ—Å—Ç—å –≤ —Ç–≤–æ—Ä–µ–Ω–∏–µ',
                        requirements: { obsession: 80, inspiration: 85 },
                        effects: { obsession: 50, inspiration: 50 },
                        silmarils: 7,
                        next: 'ultimate_sacrifice'
                    }
                ]
            },
            
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—É—Ç–∏
            {
                id: 'dragon_alliance',
                type: 'special',
                title: 'ü§ù –°–æ—é–∑ —Å –¥—Ä–µ–≤–Ω–∏–º',
                text: '–î—Ä–∞–∫–æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–≤–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –í–º–µ—Å—Ç–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—á—Ç–æ –Ω–µ–≤–∏–¥–∞–Ω–Ω–æ–µ - –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã, –≥–æ—Ä—è—â–∏–µ –¥—Ä–∞–∫–æ–Ω—å–∏–º –ø–ª–∞–º–µ–Ω–µ–º.',
                choices: [
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å –ü–ª–∞–º–µ–Ω–Ω—ã–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã',
                        requirements: { skill: 70 },
                        effects: { skill: 30, obsession: 20 },
                        silmarils: 3,
                        silmarilType: 'fire',
                        next: 'fire_silmarils'
                    },
                    {
                        text: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à–µ –∫–∞–º–Ω–µ–π',
                        requirements: { resources: 70, skill: 80 },
                        effects: { resources: -40, skill: 35 },
                        silmarils: 5,
                        silmarilType: 'fire',
                        next: 'many_fire_silmarils'
                    }
                ]
            },
            
            {
                id: 'soul_merge',
                type: 'legendary',
                title: 'üåü –ï–¥–∏–Ω–µ–Ω–∏–µ —Å –î—Ä–µ–≤–æ–º',
                text: '–¢–≤–æ—è –¥—É—à–∞ —Å–ª–∏–≤–∞–µ—Ç—Å—è —Å —Å—É—â–Ω–æ—Å—Ç—å—é –õ–∞—É—Ä–µ–ª–∏–Ω. –¢—ã –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —ç–ª—å—Ñ - —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è –∂–∏–≤—ã–º –≤–æ–ø–ª–æ—â–µ–Ω–∏–µ–º —Å–≤–µ—Ç–∞.',
                choices: [
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å –ñ–∏–≤—ã–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã',
                        requirements: {},
                        effects: { light: 100, obsession: 100 },
                        silmarils: 3,
                        silmarilType: 'living',
                        next: 'living_silmarils'
                    },
                    {
                        text: '–°—Ç–∞—Ç—å —Å–∞–º–∏–º –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–º',
                        requirements: { obsession: 90 },
                        effects: {},
                        silmarils: 1,
                        silmarilType: 'self',
                        next: 'become_silmaril'
                    }
                ]
            },
            
            // –û—Å–æ–±—ã–µ –∫–æ–Ω—Ü–æ–≤–∫–∏
            {
                id: 'become_silmaril',
                type: 'ending',
                title: '‚ú® –ñ–∏–≤–æ–π –°–∏–ª—å–º–∞—Ä–∏–ª–ª',
                text: '–¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —á–µ—Ç–≤—ë—Ä—Ç—ã–º –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–º - –∂–∏–≤—ã–º, –¥—ã—à–∞—â–∏–º, –≤–µ—á–Ω—ã–º. –¢–≤–æ—ë —Ç–µ–ª–æ –∏–∑–ª—É—á–∞–µ—Ç —Å–≤–µ—Ç –î—Ä–µ–≤, —Ç–≤–æ—è –¥—É—à–∞ - —á–∏—Å—Ç–æ–µ —Å–∏—è–Ω–∏–µ. –≠–ª—å—Ñ—ã –±—É–¥—É—Ç –ø–µ—Ç—å –æ —Ç–µ–±–µ –¥–æ –∫–æ–Ω—Ü–∞ –≤—Ä–µ–º—ë–Ω, –Ω–æ —Ç—ã —É–∂–µ –Ω–µ —É—Å–ª—ã—à–∏—à—å –∏—Ö –ø–µ—Å–µ–Ω, –∏–±–æ —Å—Ç–∞–ª —Å–∞–º–æ–π –ø–µ—Å–Ω–µ–π.',
                achievement: '–¢—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ—Å—Ç—å'
            },
            
            {
                id: 'perfect_balance',
                type: 'ending', 
                title: '‚òØÔ∏è –°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–µ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ',
                text: '–¢—ã —Å–æ–∑–¥–∞–ª –ø—è—Ç—å –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ –Ω–µ–≤–∏–¥–∞–Ω–Ω–æ–π –∫—Ä–∞—Å–æ—Ç—ã - –¥–≤–∞ —Å–≤–µ—Ç–ª—ã—Ö, –¥–≤–∞ —Ç—ë–º–Ω—ã—Ö –∏ –æ–¥–∏–Ω, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –æ–±–µ —Å–∏–ª—ã. –ë–∞–ª–∞–Ω—Å –ê—Ä–¥—ã –∏–∑–º–µ–Ω—ë–Ω –Ω–∞–≤—Å–µ–≥–¥–∞. –í–∞–ª–∞—Ä –∏ –ú–µ–ª—å–∫–æ—Ä —Ä–∞–≤–Ω–æ –ø–æ—Ä–∞–∂–µ–Ω—ã —Ç–≤–æ–∏–º —Ç–≤–æ—Ä–µ–Ω–∏–µ–º. –¢—ã –ø—Ä–µ–≤–∑–æ—à—ë–ª —Å–∞–º–æ–≥–æ –ò–ª—É–≤–∞—Ç–∞—Ä–∞ –≤ –∏—Å–∫—É—Å—Å—Ç–≤–µ —Ç–≤–æ—Ä–µ–Ω–∏—è.',
                achievement: '–ù–æ–≤—ã–π –¢–≤–æ—Ä–µ—Ü'
            },
            
            {
                id: 'ultimate_sacrifice',
                type: 'ending',
                title: 'üíÄ –í–µ–ª–∏—á–∞–π—à–∞—è –∂–µ—Ä—Ç–≤–∞',
                text: '–°–µ–º—å –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ —Å–∏—è—é—Ç –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π, –Ω–æ —Ç—ã —É–∂–µ –Ω–µ –º–æ–∂–µ—à—å –∏—Ö –≤–∏–¥–µ—Ç—å. –¢–≤–æ—è –¥—É—à–∞, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω–∞—è –º–µ–∂–¥—É –Ω–∏–º–∏, –¥–∞—Ä–∏—Ç –∫–∞–∂–¥–æ–º—É –∫–∞–º–Ω—é –∏—Å—Ç–∏–Ω–Ω—É—é –∂–∏–∑–Ω—å. –§–µ–∞–Ω–æ—Ä –º—ë—Ä—Ç–≤, –Ω–æ –µ–≥–æ –Ω–∞—Å–ª–µ–¥–∏–µ –±—É–¥–µ—Ç –∂–∏—Ç—å –≤–µ—á–Ω–æ –≤ —Å–µ–º–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç—è—Ö —Å–≤–µ—Ç–∞.',
                achievement: '–°–µ–º–∏–∫—Ä–∞—Ç–Ω–æ–µ –±–µ—Å—Å–º–µ—Ä—Ç–∏–µ'
            },
            
            {
                id: 'fire_silmarils',
                type: 'ending',
                title: 'üî• –ü–ª–∞–º–µ–Ω–Ω—ã–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã',
                text: '–¢—Ä–∏ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–∞ –ø—ã–ª–∞—é—Ç –≤–µ—á–Ω—ã–º –¥—Ä–∞–∫–æ–Ω—å–∏–º –æ–≥–Ω—ë–º. –û–Ω–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ö—Ä–∞–Ω—è—Ç —Å–≤–µ—Ç - –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç –µ–≥–æ, –≤—ã–∂–∏–≥–∞—è —Ç—å–º—É wherever –æ–Ω–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è. –î–∞–∂–µ –ú–µ–ª—å–∫–æ—Ä –±–æ–∏—Ç—Å—è –ø—Ä–∏–∫–æ—Å–Ω—É—Ç—å—Å—è –∫ –Ω–∏–º.',
                achievement: '–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –¥—Ä–∞–∫–æ–Ω–æ–≤'
            },
            
            {
                id: 'many_fire_silmarils',
                type: 'ending',
                title: 'üåã –ü–ª–∞–º–µ–Ω–Ω–∞—è –∫–æ—Ä–æ–Ω–∞',
                text: '–ü—è—Ç—å –æ–≥–Ω–µ–Ω–Ω—ã—Ö –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ –æ–±—Ä–∞–∑—É—é—Ç –∫–æ—Ä–æ–Ω—É —Ç–∞–∫–æ–π –º–æ—â–∏, —á—Ç–æ –¥–∞–∂–µ –í–∞–ª–∞—Ä –ø—Ä–∏–∑–Ω–∞—é—Ç —Ç–µ–±—è —Ä–∞–≤–Ω—ã–º. –¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è –í–ª–∞–¥—ã–∫–æ–π –ü–ª–∞–º–µ–Ω–∏, –Ω–æ–≤–æ–π —Å–∏–ª–æ–π –≤ –ê—Ä–¥–µ.',
                achievement: '–û–≥–Ω–µ–Ω–Ω—ã–π –≤–ª–∞–¥—ã–∫–∞'
            },
            
            {
                id: 'living_silmarils',
                type: 'ending',
                title: 'üå± –ñ–∏–≤—ã–µ –∫–∞–º–Ω–∏',
                text: '–¢—Ä–∏ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–∞ –ø—É–ª—å—Å–∏—Ä—É—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∂–∏–∑–Ω—å—é. –û–Ω–∏ —Ä–∞—Å—Ç—É—Ç, –∏–∑–º–µ–Ω—è—é—Ç—Å—è, –¥–∞–∂–µ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç. –¢—ã —Å–æ–∑–¥–∞–ª –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–∞–º–Ω–∏ - —Ç—ã —Å–æ–∑–¥–∞–ª –Ω–æ–≤—É—é —Ä–∞—Å—É –±–µ—Å—Å–º–µ—Ä—Ç–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤ —Å–≤–µ—Ç–∞.',
                achievement: '–°–æ–∑–¥–∞—Ç–µ–ª—å –∂–∏–∑–Ω–∏'
            },
            
            {
                id: 'dark_embrace',
                type: 'ending',
                title: 'üåë –¢—ë–º–Ω—ã–π —Ç—Ä–∏—É–º—Ñ',
                text: '–ü–æ–¥–¥–∞–≤—à–∏—Å—å —Ç—å–º–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é, —Ç—ã —Å–æ–∑–¥–∞—ë—à—å –ß—ë—Ä–Ω—ã–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã - –∞–Ω—Ç–∏—Ç–µ–∑—É —Å–≤–µ—Ç—É. –ú–µ–ª—å–∫–æ—Ä –ø—Ä–∏–∑–Ω–∞—ë—Ç —Ç–µ–±—è —Ä–∞–≤–Ω—ã–º, –∏ –≤–º–µ—Å—Ç–µ –≤—ã –ø–æ–≥—Ä—É–∂–∞–µ—Ç–µ –ê—Ä–¥—É –≤ –≤–µ—á–Ω—É—é –Ω–æ—á—å. –ù–æ –≤ —ç—Ç–æ–π —Ç—å–º–µ –µ—Å—Ç—å —Å—Ç—Ä–∞–Ω–Ω–∞—è, –∏–∑–≤—Ä–∞—â—ë–Ω–Ω–∞—è –∫—Ä–∞—Å–æ—Ç–∞.',
                achievement: '–¢—ë–º–Ω—ã–π –º–∞—Å—Ç–µ—Ä'
            },
            
            {
                id: 'valar_oath',
                type: 'ending',
                title: 'üëë –ò–∑–±—Ä–∞–Ω–Ω—ã–π –í–∞–ª–∞—Ä',
                text: '–°–æ–∑–¥–∞–≤ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã –≤–æ —Å–ª–∞–≤—É –í–∞–ª–∞—Ä, —Ç—ã –ø–æ–¥–Ω–∏–º–∞–µ—à—å—Å—è –¥–æ –∏—Ö —É—Ä–æ–≤–Ω—è. –ú–∞–Ω–≤—ç –¥–∞—Ä—É–µ—Ç —Ç–µ–±–µ –º–µ—Å—Ç–æ —Å—Ä–µ–¥–∏ –í–∞–ª–∞—Ä –∫–∞–∫ –ü–æ–∫—Ä–æ–≤–∏—Ç–µ–ª—è –ú–∞—Å—Ç–µ—Ä–æ–≤. –¢–≤–æ–∏ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–æ–≤—ã–º–∏ –∑–≤—ë–∑–¥–∞–º–∏ –Ω–∞ –Ω–µ–±–µ –ê—Ä–¥—ã.',
                achievement: '–í–æ–∑–Ω–µ—Å–µ–Ω–∏–µ'
            },
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            {
                id: 'ancient_wisdom',
                type: 'special',
                title: 'üìñ –ú—É–¥—Ä–æ—Å—Ç—å –≤–µ–∫–æ–≤',
                text: '–ó–Ω–∞–Ω–∏–µ —Ç—ã—Å—è—á–µ–ª–µ—Ç–∏–π –≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–≤–æ–π —Ä–∞–∑—É–º. –¢—ã –≤–∏–¥–∏—à—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.',
                choices: [
                    {
                        text: '–í—ã–±—Ä–∞—Ç—å –ø—É—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–∞',
                        requirements: { inspiration: 75 },
                        effects: { inspiration: 20, skill: 25 },
                        next: 'path_of_many'
                    },
                    {
                        text: '–í—ã–±—Ä–∞—Ç—å –ø—É—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–∞',
                        requirements: { skill: 75 },
                        effects: { skill: 30, obsession: 10 },
                        next: 'path_of_one'
                    },
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—É—Ç—å',
                        requirements: { inspiration: 85, skill: 85 },
                        effects: { inspiration: 30, skill: 30, obsession: 20 },
                        next: 'new_path'
                    }
                ]
            },
            
            {
                id: 'path_of_many',
                type: 'special',
                title: 'üí´ –ü—É—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–∞',
                text: '–¢—ã —Ä–µ—à–∞–µ—à—å —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ–Ω—å—à–∏—Ö –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ –≤–º–µ—Å—Ç–æ —Ç—Ä—ë—Ö –≤–µ–ª–∏–∫–∏—Ö.',
                choices: [
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å –¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å –º–∞–ª—ã—Ö –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤',
                        requirements: { skill: 70, resources: 80 },
                        effects: {},
                        silmarils: 12,
                        silmarilType: 'minor',
                        next: 'twelve_stones'
                    },
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å —Å–æ–∑–≤–µ–∑–¥–∏–µ –∏–∑ –∫–∞–º–Ω–µ–π',
                        requirements: { inspiration: 90, light: 70 },
                        effects: {},
                        silmarils: 20,
                        silmarilType: 'constellation',
                        next: 'star_constellation'
                    }
                ]
            },
            
            {
                id: 'twelve_stones',
                type: 'ending',
                title: 'üíé –î–≤–µ–Ω–∞–¥—Ü–∞—Ç—å —Å—É–¥–µ–±',
                text: '–î–≤–µ–Ω–∞–¥—Ü–∞—Ç—å –º–∞–ª—ã—Ö –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ —Ä–∞–∑–ª–µ—Ç–∞—é—Ç—Å—è –ø–æ –ê—Ä–¥–µ, –∫–∞–∂–¥—ã–π –Ω–∞—Ö–æ–¥–∏—Ç —Å–≤–æ–µ–≥–æ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è. –¢—ã –∏–∑–º–µ–Ω–∏–ª —Å—É–¥—å–±—É –º–∏—Ä–∞, –¥–∞–≤ —Å–∏–ª—É –º–Ω–æ–≥–∏–º –≤–º–µ—Å—Ç–æ few.',
                achievement: '–î–µ–º–æ–∫—Ä–∞—Ç —Å–≤–µ—Ç–∞'
            },
            
            {
                id: 'star_constellation',
                type: 'ending',
                title: 'üåå –ó–≤—ë–∑–¥–Ω–æ–µ —Ç–≤–æ—Ä–µ–Ω–∏–µ',
                text: '–î–≤–∞–¥—Ü–∞—Ç—å –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –≤ –Ω–µ–±–æ, –æ–±—Ä–∞–∑—É—è –Ω–æ–≤–æ–µ —Å–æ–∑–≤–µ–∑–¥–∏–µ. –í–∞—Ä–¥–∞ –ø–æ—Ä–∞–∂–µ–Ω–∞ - —Ç—ã —Å–æ–∑–¥–∞–ª –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–∞–º–Ω–∏, –Ω–æ –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞ –¥–ª—è –≤—Å–µ–π –ê—Ä–¥—ã.',
                achievement: '–ó–≤–µ–∑–¥–æ—á—ë—Ç'
            },
            
            {
                id: 'path_of_one',
                type: 'special',
                title: '1Ô∏è‚É£ –ü—É—Ç—å –µ–¥–∏–Ω–æ–≥–æ',
                text: '–í—Å—é —Å–≤–æ—é —Å–∏–ª—É —Ç—ã —Ä–µ—à–∞–µ—à—å –≤–ª–æ–∂–∏—Ç—å –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ, —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–∞.',
                choices: [
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å –ü–µ—Ä–≤–æ–∑–¥–∞–Ω–Ω—ã–π –°–∏–ª—å–º–∞—Ä–∏–ª–ª',
                        requirements: { skill: 90, inspiration: 90, light: 80 },
                        effects: {},
                        silmarils: 1,
                        silmarilType: 'primordial',
                        next: 'primordial_silmaril'
                    },
                    {
                        text: '–°–æ–∑–¥–∞—Ç—å –°–∏–ª—å–º–∞—Ä–∏–ª–ª-—Å–µ—Ä–¥—Ü–µ',
                        requirements: { obsession: 90, skill: 85 },
                        effects: {},
                        silmarils: 1,
                        silmarilType: 'heart',
                        next: 'heart_silmaril'
                    }
                ]
            },
            
            {
                id: 'primordial_silmaril',
                type: 'ending',
                title: 'üåü –ü–µ—Ä–≤–æ–∑–¥–∞–Ω–Ω—ã–π —Å–≤–µ—Ç',
                text: '–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –°–∏–ª—å–º–∞—Ä–∏–ª–ª —Å–∏—è–µ—Ç —è—Ä—á–µ —Ç—ã—Å—è—á–∏ —Å–æ–ª–Ω—Ü. –û–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Å–≤–µ—Ç–∞ –ø–æ—Å–ª–µ –≥–∏–±–µ–ª–∏ –î—Ä–µ–≤. –¢—ã —Å–ø–∞—Å –í–∞–ª–∏–Ω–æ—Ä, –Ω–æ —Ü–µ–Ω–∞ - —Ç–≤–æ—è –∂–∏–∑–Ω—å, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–¥–∞–Ω–Ω–∞—è —Ç–≤–æ—Ä–µ–Ω–∏—é.',
                achievement: '–°–ø–∞—Å–∏—Ç–µ–ª—å –í–∞–ª–∏–Ω–æ—Ä–∞'
            },
            
            {
                id: 'heart_silmaril',
                type: 'ending',
                title: '‚ù§Ô∏è –°–µ—Ä–¥—Ü–µ –ê—Ä–¥—ã',
                text: '–°–∏–ª—å–º–∞—Ä–∏–ª–ª-—Å–µ—Ä–¥—Ü–µ –±—å—ë—Ç—Å—è –≤ —É–Ω–∏—Å–æ–Ω —Å —Å–∞–º–æ–π –ê—Ä–¥–æ–π. –û–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –µ—ë –Ω–æ–≤—ã–º —Ü–µ–Ω—Ç—Ä–æ–º, –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –≤—Å–µ–π –∂–∏–∑–Ω–∏ –∏ —Å–≤–µ—Ç–∞. –¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–ª –∫–∞–º–µ–Ω—å - —Ç—ã –ø–µ—Ä–µ—Å–æ–∑–¥–∞–ª –º–∏—Ä.',
                achievement: '–ù–æ–≤–æ–µ —Å–µ—Ä–¥—Ü–µ –º–∏—Ä–∞'
            }
        ];

        function updateStats() {
            for (let stat in gameState) {
                if (stat === 'eventIndex' || stat === 'materials' || stat === 'relations' || 
                    stat === 'achievements' || stat === 'silmarilCount' || stat === 'secretsDiscovered' || 
                    stat === 'path' || stat === 'choices') continue;
                
                const element = document.getElementById(stat);
                const barElement = document.getElementById(stat + '-bar');
                if (element) {
                    element.textContent = gameState[stat];
                    if (barElement) {
                        barElement.style.width = gameState[stat] + '%';
                    }
                }
            }
        }

        function showNotification(text, type = 'normal') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            if (type === 'achievement') {
                notification.className += ' achievement';
            }
            notification.innerHTML = text;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3500);
        }

        function addMaterial(materialKey) {
            if (!gameState.materials.includes(materialKey)) {
                gameState.materials.push(materialKey);
                const material = materials[materialKey];
                showNotification(`${material.icon} –ü–æ–ª—É—á–µ–Ω: ${material.name}`, 'normal');
            }
        }

        function displayMaterials() {
            if (gameState.materials.length === 0) return '';
            
            let html = '<div class="materials-container">';
            html += '<div style="width: 100%; color: var(--silver); margin-bottom: 10px;">üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</div>';
            
            gameState.materials.forEach(materialKey => {
                const material = materials[materialKey];
                if (material) {
                    html += `<div class="material-tag">
                        <span class="material-icon">${material.icon}</span>
                        <span>${material.name}</span>
                    </div>`;
                }
            });
            
            html += '</div>';
            return html;
        }

        function checkRequirements(requirements) {
            for (let req in requirements) {
                if (gameState[req] < requirements[req]) {
                    return false;
                }
            }
            return true;
        }

        function applyEffects(effects) {
            for (let stat in effects) {
                if (gameState[stat] !== undefined) {
                    gameState[stat] += effects[stat];
                    gameState[stat] = Math.max(0, Math.min(100, gameState[stat]));
                }
            }
        }

        function createPuzzle(puzzleType) {
            if (puzzleType === 'rune_puzzle') {
                const runes = ['·ö†', '·ö¢', '·ö¶', '·ö®', '·ö±', '·ö≤', '·ö∑', '·öπ', '·ö∫'];
                let puzzleHtml = '<div class="mini-game">';
                puzzleHtml += '<p>–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä—É–Ω –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–∞–π–Ω—ã:</p>';
                puzzleHtml += '<div class="puzzle-container">';
                
                for (let i = 0; i < 9; i++) {
                    puzzleHtml += `<div class="puzzle-piece" data-index="${i}">${runes[i]}</div>`;
                }
                
                puzzleHtml += '</div>';
                puzzleHtml += '<button class="choice-btn" onclick="solvePuzzle()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</button>';
                puzzleHtml += '</div>';
                
                return puzzleHtml;
            }
            return '';
        }

        function solvePuzzle() {
            const selected = document.querySelectorAll('.puzzle-piece.selected');
            if (selected.length >= 3) {
                showNotification('‚ú® –ó–∞–≥–∞–¥–∫–∞ —Ä–∞–∑–≥–∞–¥–∞–Ω–∞! –î—Ä–µ–≤–Ω–∏–µ —Ç–∞–π–Ω—ã –æ—Ç–∫—Ä—ã—Ç—ã —Ç–µ–±–µ.', 'achievement');
                gameState.skill += 15;
                gameState.inspiration += 20;
                addMaterial('timeFragment');
                updateStats();
                displayEvent(events.find(e => e.id === 'rune_puzzle_result'));
            } else {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –±–æ–ª—å—à–µ —Ä—É–Ω –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–≥–∞–¥–∫–∏', 'normal');
            }
        }

        function displayEvent(event) {
            if (!event) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                const finalEvent = determineFinalEvent();
                displayEvent(finalEvent);
                return;
            }
            
            const eventDisplay = document.getElementById('event-display');
            let html = `<div class="event-container ${event.type === 'legendary' ? 'legendary-event' : event.type === 'special' ? 'special-event' : ''}">`;
            
            html += `<div class="event-title">
                <span class="event-icon">${event.title.split(' ')[0]}</span>
                <span>${event.title.substring(event.title.indexOf(' ') + 1)}</span>
            </div>`;
            
            html += `<div class="event-text">${event.text}</div>`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            html += displayMaterials();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∏–Ω–∏-–∏–≥—Ä—É –µ—Å–ª–∏ –µ—Å—Ç—å
            if (event.puzzle) {
                html += createPuzzle(event.puzzle);
            }
            
            if (event.type === 'ending') {
                html += `<div class="ending">`;
                html += `<div class="ending-title">${event.title}</div>`;
                html += `<div class="ending-text">${event.text}</div>`;
                
                if (event.achievement) {
                    html += `<div style="margin: 20px 0; color: var(--gold);">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: ${event.achievement}</div>`;
                    gameState.achievements.push(event.achievement);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                html += `<div style="margin: 20px 0; padding: 20px; background: rgba(52, 73, 94, 0.3); border-radius: 10px;">`;
                html += `<h3 style="color: var(--gold); margin-bottom: 15px;">–ò—Ç–æ–≥–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</h3>`;
                html += `<p>‚öíÔ∏è –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ: ${gameState.skill}</p>`;
                html += `<p>üí° –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ: ${gameState.inspiration}</p>`;
                html += `<p>üî• –û–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å: ${gameState.obsession}</p>`;
                html += `<p>‚ú® –°–≤–µ—Ç –î—Ä–µ–≤: ${gameState.light}</p>`;
                html += `<p>üëë –†–µ–ø—É—Ç–∞—Ü–∏—è: ${gameState.reputation}</p>`;
                html += `<p>üíé –°–æ–∑–¥–∞–Ω–Ω—ã—Ö –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤: ${gameState.silmarilCount || 3}</p>`;
                html += `<p>üì¶ –°–æ–±—Ä–∞–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${gameState.materials.length}</p>`;
                html += '</div>';
                
                html += `<button class="restart-btn" onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>`;
                html += `</div>`;
            } else {
                html += '<div class="choices">';
                
                event.choices.forEach((choice, index) => {
                    const canChoose = checkRequirements(choice.requirements);
                    let choiceText = choice.text;
                    
                    if (Object.keys(choice.requirements).length > 0) {
                        const reqText = Object.entries(choice.requirements)
                            .map(([stat, val]) => `${getStatName(stat)} ${val}+`)
                            .join(', ');
                        choiceText += `<div class="choice-requirement">(–¢—Ä–µ–±—É–µ—Ç—Å—è: ${reqText})</div>`;
                    }
                    
                    html += `<button class="choice-btn" ${!canChoose ? 'disabled' : ''} 
                            onclick="makeChoice(${index})">
                            ${choiceText}
                        </button>`;
                });
                
                html += '</div>';
            }
            
            html += '</div>';
            
            eventDisplay.innerHTML = html;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–∞–∑–ª–∞
            if (event.puzzle) {
                document.querySelectorAll('.puzzle-piece').forEach(piece => {
                    piece.addEventListener('click', function() {
                        this.classList.toggle('selected');
                    });
                });
            }
        }

        function getStatName(stat) {
            const names = {
                skill: '–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ',
                inspiration: '–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ',
                obsession: '–û–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å', 
                light: '–°–≤–µ—Ç',
                reputation: '–†–µ–ø—É—Ç–∞—Ü–∏—è',
                resources: '–†–µ—Å—É—Ä—Å—ã'
            };
            return names[stat] || stat;
        }

        function makeChoice(choiceIndex) {
            const currentEvent = events.find(e => e.id === gameState.currentEventId) || events[0];
            const choice = currentEvent.choices[choiceIndex];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
            gameState.choices.push({
                event: currentEvent.id,
                choice: choiceIndex
            });
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (choice.effects) {
                applyEffects(choice.effects);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            if (choice.materials) {
                choice.materials.forEach(mat => addMaterial(mat));
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤
            if (choice.silmarils) {
                gameState.silmarilCount = choice.silmarils;
                showNotification(`üíé –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: ${choice.silmarils}`, 'achievement');
            }
            
            if (choice.silmarilBonus) {
                gameState.silmarilCount = (gameState.silmarilCount || 3) + choice.silmarilBonus;
                showNotification(`üíé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –°–∏–ª—å–º–∞—Ä–∏–ª–ª—ã: +${choice.silmarilBonus}`, 'achievement');
            }
            
            if (choice.silmarilType) {
                gameState.silmarilType = choice.silmarilType;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateStats();
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–æ–±—ã—Ç–∏—é
            const nextEvent = events.find(e => e.id === choice.next);
            if (nextEvent) {
                gameState.currentEventId = choice.next;
                setTimeout(() => displayEvent(nextEvent), 500);
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω—Ü–æ–≤–∫—É
                const ending = determineFinalEvent();
                setTimeout(() => displayEvent(ending), 500);
            }
        }

        function determineFinalEvent() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ü–æ–≤–æ–∫
            if (gameState.silmarilCount > 0) {
                // –ï—Å–ª–∏ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω —Ç–∏–ø –°–∏–ª—å–º–∞—Ä–∏–ª–ª–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–æ–Ω—Ü–æ–≤–∫—É
                const endings = events.filter(e => e.type === 'ending');
                return endings[Math.floor(Math.random() * endings.length)];
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω—Ü–æ–≤–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
            if (gameState.obsession >= 80 && gameState.skill >= 80) {
                return events.find(e => e.id === 'ultimate_sacrifice');
            } else if (gameState.light >= 80 && gameState.reputation >= 70) {
                return events.find(e => e.id === 'valar_oath');
            } else if (gameState.obsession >= 70 && gameState.light <= 30) {
                return events.find(e => e.id === 'dark_embrace');
            } else if (gameState.skill >= 80 && gameState.inspiration >= 80) {
                return events.find(e => e.id === 'perfect_balance');
            } else {
                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞
                return {
                    id: 'standard_ending',
                    type: 'ending',
                    title: 'üíé –¢—Ä–∏ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–∞',
                    text: '–¢—ã —Å–æ–∑–¥–∞–ª —Ç—Ä–∏ –°–∏–ª—å–º–∞—Ä–∏–ª–ª–∞, –∫–∞–∫ –∏ –±—ã–ª–æ –ø—Ä–µ–¥–Ω–∞—á–µ—Ä—Ç–∞–Ω–æ. –û–Ω–∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã, –æ–Ω–∏ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã, –æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç –ø—Ä–∏—á–∏–Ω–æ–π –≤–µ–ª–∏—á–∞–π—à–∏—Ö –≤–æ–π–Ω –∏ –ø–æ–¥–≤–∏–≥–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ê—Ä–¥—ã. –¢–≤–æ—ë –∏–º—è –±—É–¥–µ—Ç –∂–∏—Ç—å –≤–µ—á–Ω–æ.',
                    achievement: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ'
                };
            }
        }

        function restartGame() {
            gameState.skill = 50;
            gameState.inspiration = 50;
            gameState.obsession = 30;
            gameState.light = 40;
            gameState.reputation = 50;
            gameState.resources = 50;
            gameState.eventIndex = 0;
            gameState.materials = [];
            gameState.relations = {};
            gameState.achievements = [];
            gameState.silmarilCount = 0;
            gameState.secretsDiscovered = [];
            gameState.path = 'normal';
            gameState.choices = [];
            gameState.currentEventId = 'start';
            
            updateStats();
            displayEvent(events[0]);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        gameState.currentEventId = 'start';
        updateStats();
        displayEvent(events[0]);
    </script>
</body>
</html>