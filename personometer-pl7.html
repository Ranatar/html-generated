<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—Ä—Å–æ–Ω–æ–º–µ—Ç—Ä-–ü–õ7 ¬´–î—É—à–µ–ø—Ä–æ–¥–∞–≤–µ—Ü¬ª</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow-x: hidden;
        window.activateMode = activateMode;
        window.emergency = emergency;
        window.connectPort = connectPort;
        window.indicatorClick = indicatorClick;
        window.selfTest = selfTest;
        window.showWarning = showWarning;
        window.printDiagnosis = printDiagnosis;
        window.screenClick = screenClick;
        window.closePopup = closePopup;

        .device-container {
            perspective: 1000px;
            position: relative;
        }

        .device {
            width: 360px;
            height: 600px;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border-radius: 20px;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.8),
                inset 0 2px 5px rgba(255,255,255,0.1),
                inset 0 -2px 5px rgba(0,0,0,0.5);
            padding: 20px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .device.shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotateZ(-2deg); }
            75% { transform: translateX(10px) rotateZ(2deg); }
        }

        .device:hover {
            transform: rotateY(5deg) rotateX(-5deg);
        }

        .device::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.03) 10px, rgba(255,255,255,0.03) 20px),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="10" y="20" font-size="8" fill="rgba(255,255,255,0.05)" transform="rotate(-45 50 50)">–ó–ù–ê–ú–Ø</text><text x="10" y="40" font-size="8" fill="rgba(255,255,255,0.05)" transform="rotate(-45 50 50)">–ù–û–í–´–ô –ú–ò–†</text><text x="10" y="60" font-size="8" fill="rgba(255,255,255,0.05)" transform="rotate(-45 50 50)">–û–ö–¢–Ø–ë–†–¨</text></svg>');
            pointer-events: none;
            border-radius: 20px;
        }

        .brand {
            text-align: center;
            margin-bottom: 15px;
        }

        .brand h1 {
            font-size: 18px;
            margin: 0;
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255,107,107,0.5);
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .brand h1:hover {
            transform: scale(1.1);
            text-shadow: 0 0 20px rgba(255,107,107,0.8);
        }

        .brand p {
            font-size: 10px;
            margin: 5px 0 0 0;
            color: #666;
            font-style: italic;
        }

        .screen {
            width: 100%;
            height: 220px;
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            cursor: crosshair;
        }

        .screen.analyzing {
            animation: screenFlicker 0.1s ease-in-out infinite;
        }

        @keyframes screenFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .scale {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            height: 40px;
        }

        .scale-bar {
            width: 100%;
            height: 10px;
            background: linear-gradient(to right, 
                #00ff00 0%, 
                #ffff00 25%, 
                #ff9900 50%, 
                #ff3300 75%, 
                #990000 100%);
            border-radius: 5px;
            position: relative;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 8px;
            color: #666;
        }

        .needle {
            position: absolute;
            top: -15px;
            left: 10%;
            width: 2px;
            height: 25px;
            background: #ff0000;
            box-shadow: 0 0 10px rgba(255,0,0,0.8);
            transition: left 0.5s ease;
        }

        .display-text {
            position: absolute;
            top: 20px;
            left: 10px;
            right: 10px;
            font-size: 12px;
            color: #00ff00;
            text-shadow: 0 0 5px rgba(0,255,0,0.5);
        }

        .running-text {
            position: absolute;
            top: 60px;
            left: 0;
            width: 100%;
            height: 20px;
            overflow: hidden;
        }

        .running-text span {
            position: absolute;
            white-space: nowrap;
            color: #ff9900;
            font-size: 10px;
            animation: marquee 15s linear infinite;
        }

        @keyframes marquee {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }

        .current-mode {
            font-size: 10px;
            color: #ff9900;
            margin-top: 10px;
        }

        .poem-input {
            position: absolute;
            bottom: 60px;
            left: 10px;
            right: 10px;
            display: none;
        }

        .poem-input textarea {
            width: 100%;
            height: 60px;
            background: rgba(0,255,0,0.1);
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            padding: 5px;
            border-radius: 5px;
            resize: none;
            transition: all 0.3s ease;
        }

        .poem-input textarea.danger {
            background: rgba(255,0,0,0.1);
            border-color: #ff0000;
            color: #ff6666;
            animation: textPulse 1s ease-in-out infinite;
        }

        .poem-input textarea.warning {
            background: rgba(255,255,0,0.1);
            border-color: #ffff00;
            color: #ffff66;
        }

        @keyframes textPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255,0,0,0.5); }
            50% { box-shadow: 0 0 20px rgba(255,0,0,0.8); }
        }

        .analysis-result {
            position: absolute;
            top: 90px;
            left: 10px;
            right: 10px;
            font-size: 9px;
            color: #ff9900;
            background: rgba(0,0,0,0.7);
            padding: 5px;
            border-radius: 5px;
            display: none;
            max-height: 40px;
            overflow-y: auto;
        }

        .diagnosis-meter {
            position: absolute;
            top: 135px;
            left: 10px;
            right: 10px;
            height: 20px;
            display: none;
        }

        .diagnosis-meter .meter-fill {
            height: 100%;
            background: linear-gradient(to right, #00ff00, #ffff00, #ff0000);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .button {
            padding: 12px;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border: none;
            border-radius: 10px;
            color: #aaa;
            font-size: 11px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 
                2px 2px 5px rgba(0,0,0,0.5),
                -2px -2px 5px rgba(255,255,255,0.05);
        }

        .button:hover {
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 
                4px 4px 10px rgba(0,0,0,0.5),
                -2px -2px 5px rgba(255,255,255,0.1);
        }

        .button:active {
            transform: translateY(0);
            box-shadow: 
                inset 2px 2px 5px rgba(0,0,0,0.5),
                inset -2px -2px 5px rgba(255,255,255,0.05);
        }

        .button.active {
            background: linear-gradient(145deg, #4a3a3a, #3a2a2a);
            color: #ff6b6b;
        }

        .button.danger {
            animation: pulseRed 2s ease-in-out infinite;
        }

        @keyframes pulseRed {
            0%, 100% { box-shadow: 0 0 10px rgba(255,0,0,0.3); }
            50% { box-shadow: 0 0 20px rgba(255,0,0,0.6); }
        }

        .emergency-button {
            grid-column: 1 / -1;
            background: linear-gradient(145deg, #5a1a1a, #4a0a0a);
            color: #ff3333;
            position: relative;
            overflow: hidden;
        }

        .emergency-button::before {
            content: '‚ö†Ô∏è –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –†–ï–ê–ù–ò–ú–ê–¶–ò–Ø –õ–ò–ß–ù–û–°–¢–ò ‚ö†Ô∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            font-size: 9px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .emergency-button:hover::before {
            opacity: 1;
        }

        .indicators {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
        }

        .indicator {
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .indicator:hover {
            transform: scale(1.1);
        }

        .led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 auto 5px;
            background: #1a1a1a;
            box-shadow: inset 0 0 3px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        .led.red {
            background: #ff3333;
            box-shadow: 0 0 15px rgba(255,51,51,0.8);
            animation: blink 1s ease-in-out infinite;
        }

        .led.green {
            background: #33ff33;
            box-shadow: 0 0 15px rgba(51,255,51,0.8);
        }

        .led.yellow {
            background: #ffff33;
            box-shadow: 0 0 15px rgba(255,255,51,0.8);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .indicator-label {
            font-size: 8px;
            color: #666;
        }

        .ports {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .port {
            width: 40px;
            height: 15px;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .port:hover {
            border-color: #666;
            transform: scale(1.1);
        }

        .port.connected {
            border-color: #00ff00;
            animation: portGlow 1s ease-in-out infinite;
        }

        @keyframes portGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(0,255,0,0.5); }
            50% { box-shadow: 0 0 15px rgba(0,255,0,0.8); }
        }

        .port::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 8px;
            background: #1a1a1a;
            border-radius: 2px;
        }

        .port-label {
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: #444;
            white-space: nowrap;
        }

        .warning-sticker {
            position: absolute;
            bottom: 80px;
            right: 20px;
            background: #ffff00;
            color: #000;
            padding: 5px 10px;
            font-size: 8px;
            border-radius: 3px;
            transform: rotate(-5deg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .warning-sticker:hover {
            transform: rotate(-5deg) scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .glitch {
            animation: glitch 0.5s ease-in-out;
        }

        @keyframes glitch {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-2px); }
            40% { transform: translateX(2px); }
            60% { transform: translateX(-1px); }
            80% { transform: translateX(1px); }
        }

        .popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,0,0,0.9);
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            animation: popupAppear 0.3s ease-out;
        }

        @keyframes popupAppear {
            from { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .smoke {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to top, rgba(100,100,100,0.3), transparent);
            opacity: 0;
            pointer-events: none;
            animation: smoke 3s ease-out;
        }

        @keyframes smoke {
            0% { opacity: 0; transform: translateY(0); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        .sparks {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffff00;
            border-radius: 50%;
            animation: spark 1s ease-out;
            pointer-events: none;
        }

        @keyframes spark {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }

        .mini-printer {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 20px;
            background: #333;
            border: 1px solid #555;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mini-printer:hover {
            transform: scale(1.2);
            border-color: #888;
        }

        .paper {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 0;
            background: #fff;
            transition: height 0.5s ease;
        }

        .mini-printer.printing .paper {
            height: 30px;
        }

        .paper-text {
            font-size: 4px;
            color: #000;
            padding: 2px;
            line-height: 1.2;
        }
    </style>
</head>
<body>
    <div class="device-container">
        <div class="device" id="device">
            <div class="mini-printer" id="printer" onclick="printDiagnosis()">
                <div class="paper" id="paper">
                    <div class="paper-text" id="paperText"></div>
                </div>
            </div>

            <div class="brand" onclick="selfTest()">
                <h1>–ü–ï–†–°–û–ù–û–ú–ï–¢–†-–ü–õ7</h1>
                <p>"–î—É—à–µ–ø—Ä–æ–¥–∞–≤–µ—Ü"</p>
            </div>

            <div class="screen" id="screen" onclick="screenClick(event)">
                <div class="display-text">
                    <div>–ê–ù–ê–õ–ò–ó –õ–ò–ß–ù–û–°–¢–ò: <span id="status">–ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï</span></div>
                    <div class="current-mode">–†–µ–∂–∏–º: <span id="mode">–û–ñ–ò–î–ê–ù–ò–ï</span></div>
                </div>
                <div class="running-text">
                    <span id="runningText">–í–ù–ò–ú–ê–ù–ò–ï: –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –ø–æ—Ç–µ—Ä–µ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç–∏...</span>
                </div>
                <div class="poem-input" id="poemInput">
                    <textarea id="poemText" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å–≤–æ–π —Å—Ç–∏—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞..."></textarea>
                </div>
                <div class="analysis-result" id="analysisResult"></div>
                <div class="diagnosis-meter" id="diagnosisMeter">
                    <div class="meter-fill" id="meterFill"></div>
                </div>
                <div class="scale">
                    <div class="scale-bar">
                        <div class="needle" id="needle"></div>
                    </div>
                    <div class="scale-labels">
                        <span>–ü–æ–¥–ø–æ–ª—å–Ω—ã–π<br>–≥–µ–Ω–∏–π</span>
                        <span>–°–∞–º–∏–∑–¥–∞—Ç</span>
                        <span>–õ–∏—Ç–æ–±—ä–µ–¥.</span>
                        <span>–ì—Ä–∞–Ω—Ç–æ–µ–¥</span>
                        <span>–ß–ª–µ–Ω –°–ü</span>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="button" onclick="activateMode('journal', event)">–¢–æ–ª—Å—Ç—ã–π –∂—É—Ä–Ω–∞–ª</button>
                <button class="button" onclick="activateMode('bar', event)">–ë–∞—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ</button>
                <button class="button" onclick="activateMode('grant', event)">–î–µ—Ç–µ–∫—Ç–æ—Ä –≥—Ä–∞–Ω—Ç–æ–≤</button>
                <button class="button" onclick="activateMode('network', event)">–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥</button>
                <button class="button emergency-button" onclick="emergency()">–ê–í–ê–†–ò–ô–ù–´–ô –°–ë–†–û–°</button>
                <button class="button" style="grid-column: 1 / -1; font-size: 9px;" onclick="insertSamplePoem()">
                    –í—Å—Ç–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü –≥—Ä–∞—Ñ–æ–º–∞–Ω–∏–∏
                </button>
            </div>

            <div class="indicators">
                <div class="indicator" onclick="indicatorClick('sincerity', event)">
                    <div class="led" id="sincerity"></div>
                    <div class="indicator-label">–ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å</div>
                </div>
                <div class="indicator" onclick="indicatorClick('conformity', event)">
                    <div class="led" id="conformity"></div>
                    <div class="indicator-label">–ö–æ–Ω—Ñ–æ—Ä–º–∏–∑–º</div>
                </div>
                <div class="indicator" onclick="indicatorClick('soul', event)">
                    <div class="led" id="soul"></div>
                    <div class="indicator-label">–î—É—à–∞</div>
                </div>
            </div>

            <div class="warning-sticker" onclick="showWarning()">
                –í–ù–ò–ú–ê–ù–ò–ï!<br>
                –ì–æ—Å–ø—Ä–µ–º–∏—è<br>
                –∞–Ω–Ω—É–ª–∏—Ä—É–µ—Ç<br>
                –≥–∞—Ä–∞–Ω—Ç–∏—é
            </div>

            <div class="ports">
                <div class="port" id="port1" onclick="connectPort('grant', event)">
                    <div class="port-label">USB-–ì—Ä–∞–Ω—Ç</div>
                </div>
                <div class="port" id="port2" onclick="connectPort('alco', event)">
                    <div class="port-label">–ê–ª–∫–æ—Ç–µ—Å—Ç</div>
                </div>
                <div class="port" id="port3" onclick="connectPort('audio', event)">
                    <div class="port-label">–ê—É–¥–∏–æ</div>
                </div>
            </div>

            <div class="popup" id="popup">
                <h3>–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê!</h3>
                <p></p>
                <button onclick="closePopup()">OK</button>
            </div>
        </div>
    </div>

    <script>
        let currentMode = null;
        let personalityLevel = 50;
        let isAnalyzing = false;
        
        const needle = document.getElementById('needle');
        const status = document.getElementById('status');
        const mode = document.getElementById('mode');
        const sincerity = document.getElementById('sincerity');
        const conformity = document.getElementById('conformity');
        const soul = document.getElementById('soul');
        const device = document.getElementById('device');
        const screen = document.getElementById('screen');
        const popup = document.getElementById('popup');
        const runningText = document.getElementById('runningText');
        const poemInput = document.getElementById('poemInput');
        const poemText = document.getElementById('poemText');

        const messages = [
            "–í–ù–ò–ú–ê–ù–ò–ï: –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –ø–æ—Ç–µ—Ä–µ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç–∏...",
            "–û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∫–ª–∏—à–µ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ç–µ–∫—Å—Ç–µ...",
            "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Ä–∞–Ω–Ω–µ–≥–æ –ú–∞–Ω–¥–µ–ª—å—à—Ç–∞–º–∞...",
            "–£—Ä–æ–≤–µ–Ω—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–æ–∫...",
            "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–ª–µ–¥—ã –≤–ª–∏—è–Ω–∏—è –≥—Ä–∞–Ω—Ç–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫...",
            "–°–∏–Ω–¥—Ä–æ–º '–≤–∞–∂–Ω–æ–≥–æ –ø–æ—ç—Ç–∞' –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä—É–µ—Ç...",
            "–†–∏—Ñ–º–∞ '–ª—é–±–æ–≤—å-–∫—Ä–æ–≤—å' –ø—Ä–µ–≤—ã—Å–∏–ª–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –Ω–æ—Ä–º—ã...",
            "–ú–µ—Ç–∞—Ñ–æ—Ä—ã –∏–∑–Ω–æ—à–µ–Ω—ã –Ω–∞ 87%..."
        ];

        let messageIndex = 0;

        setInterval(() => {
            messageIndex = (messageIndex + 1) % messages.length;
            runningText.textContent = messages[messageIndex];
        }, 5000);

        window.activateMode = function(modeType, event) {
            if (isAnalyzing) return;
            
            document.querySelectorAll('.button').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            device.classList.add('glitch');
            setTimeout(() => device.classList.remove('glitch'), 500);

            screen.classList.add('analyzing');
            isAnalyzing = true;
            status.textContent = '–ê–ù–ê–õ–ò–ó...';

            setTimeout(() => {
                screen.classList.remove('analyzing');
                isAnalyzing = false;

                switch(modeType) {
                    case 'journal':
                        mode.textContent = '–¢–û–õ–°–¢–´–ô –ñ–£–†–ù–ê–õ';
                        status.textContent = '–ö–†–ò–¢–ò–ß–ù–û';
                        personalityLevel = 85;
                        sincerity.className = 'led red';
                        conformity.className = 'led green';
                        soul.className = 'led';
                        poemInput.style.display = 'block';
                        break;
                    case 'bar':
                        mode.textContent = '–ë–ê–†–ù–û–ï –ß–¢–ï–ù–ò–ï';
                        status.textContent = '–û–ü–ê–°–ù–û';
                        personalityLevel = 65;
                        sincerity.className = 'led yellow';
                        conformity.className = 'led yellow';
                        soul.className = 'led red';
                        createSparks();
                        poemInput.style.display = 'none';
                        document.getElementById('analysisResult').style.display = 'none';
                        document.getElementById('diagnosisMeter').style.display = 'none';
                        break;
                    case 'grant':
                        mode.textContent = '–î–ï–¢–ï–ö–¢–û–† –ì–†–ê–ù–¢–û–í';
                        status.textContent = '–ü–†–û–î–ê–ù–û';
                        personalityLevel = 95;
                        sincerity.className = 'led';
                        conformity.className = 'led green';
                        soul.className = 'led red';
                        if (event && event.target) {
                            event.target.classList.add('danger');
                        }
                        poemInput.style.display = 'none';
                        document.getElementById('analysisResult').style.display = 'none';
                        document.getElementById('diagnosisMeter').style.display = 'none';
                        break;
                    case 'network':
                        mode.textContent = '–ù–ï–¢–í–û–†–ö–ò–ù–ì';
                        status.textContent = '–ü–û–¢–ï–†–Ø 75%';
                        personalityLevel = 75;
                        sincerity.className = 'led red';
                        conformity.className = 'led green';
                        soul.className = 'led yellow';
                        poemInput.style.display = 'none';
                        document.getElementById('analysisResult').style.display = 'none';
                        document.getElementById('diagnosisMeter').style.display = 'none';
                        break;
                }
                
                needle.style.left = personalityLevel + '%';
            }, 1500);
        }

        // –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è
        let analysisTimeout;
        let lastAnalysis = '';
        
        poemText.addEventListener('input', () => {
            clearTimeout(analysisTimeout);
            analysisTimeout = setTimeout(() => analyzePoem(), 500);
        });

        function analyzePoem() {
            const text = poemText.value;
            if (!text || text === lastAnalysis) return;
            lastAnalysis = text;
            
            const analysis = performDetailedAnalysis(text);
            updateDeviceState(analysis);
        }

        function performDetailedAnalysis(text) {
            const lower = text.toLowerCase();
            const lines = text.split('\n').filter(l => l.trim());
            const words = lower.split(/\s+/).filter(w => w.length > 0);
            
            let score = 0;
            let diagnosis = [];
            let severity = 0;

            // 1. –ê–Ω–∞–ª–∏–∑ –∫–ª–∏—à–µ
            const cliches = {
                '–ª—é–±–æ–≤—å': 5, '–∫—Ä–æ–≤—å': 5, '–¥—É—à–∞': 4, '—Å–µ—Ä–¥—Ü–µ': 4, 
                '—Å–ª–µ–∑–∞': 6, '—Å–ª—ë–∑—ã': 6, '–º–µ—á—Ç–∞': 5, '–∑–≤–µ–∑–¥–∞': 5,
                '–Ω–µ–±–æ': 3, '–Ω–µ–±–µ—Å–∞': 4, '–∞–Ω–≥–µ–ª': 7, '–±–æ–ª—å': 6,
                '—Ç–æ—Å–∫–∞': 5, '–ø–µ—á–∞–ª—å': 5, '–≥—Ä—É—Å—Ç—å': 4, '—Å—É–¥—å–±–∞': 8
            };
            
            let clicheCount = 0;
            for (let [word, penalty] of Object.entries(cliches)) {
                const count = (lower.match(new RegExp(word, 'g')) || []).length;
                if (count > 0) {
                    score += penalty * count;
                    clicheCount += count;
                }
            }
            
            if (clicheCount > 3) {
                diagnosis.push(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${clicheCount} –∫–ª–∏—à–µ. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞—Ä–∞–∂–µ–Ω–∏–µ –±–∞–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é!`);
                severity += 2;
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Å–µ–≤–¥–æ–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª–∏–∑–º
            const pretentious = {
                '–¥–∏—Å–∫—É—Ä—Å': 10, '–∫–æ–Ω—Ç–µ–∫—Å—Ç': 8, '–¥–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è': 12,
                '–Ω–∞—Ä—Ä–∞—Ç–∏–≤': 9, '–ø–∞—Ä–∞–¥–∏–≥–º–∞': 11, '—ç–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π': 10,
                '–ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω': 12, '—Å–∏–º—É–ª—è–∫—Ä': 15, '—Ä–∏–∑–æ–º–∞': 20,
                '—Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω—ã–π': 11, '–∏–º–º–∞–Ω–µ–Ω—Ç–Ω—ã–π': 12
            };
            
            let pretentiousCount = 0;
            for (let [word, penalty] of Object.entries(pretentious)) {
                if (lower.includes(word)) {
                    score += penalty;
                    pretentiousCount++;
                }
            }
            
            if (pretentiousCount > 0) {
                diagnosis.push(`–ü—Å–µ–≤–¥–æ–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª–∏–∑–º –∑–∞—à–∫–∞–ª–∏–≤–∞–µ—Ç! –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${pretentiousCount} —É–º–Ω—ã—Ö —Å–ª–æ–≤.`);
                severity += 3;
            }

            // 3. –ê–Ω–∞–ª–∏–∑ —Ä–∏—Ñ–º
            if (lines.length >= 2) {
                const lastWords = lines.map(line => {
                    const words = line.trim().split(/\s+/);
                    return words[words.length - 1]?.toLowerCase().replace(/[.,!?;:]/, '') || '';
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–Ω–∞–ª—å–Ω—ã—Ö —Ä–∏—Ñ–º
                const badRhymes = [
                    ['–ª—é–±–æ–≤—å', '–∫—Ä–æ–≤—å'], ['—Ä–æ–∑—ã', '–º–æ—Ä–æ–∑—ã'], ['—Å–ª–µ–∑—ã', '–≥—Ä–µ–∑—ã'],
                    ['–¥–µ–Ω—å', '—Ç–µ–Ω—å'], ['–Ω–æ—á—å', '–ø—Ä–æ—á—å'], ['–º–µ—á—Ç—ã', '—Ü–≤–µ—Ç—ã']
                ];
                
                for (let i = 0; i < lastWords.length - 1; i++) {
                    for (let j = i + 1; j < lastWords.length; j++) {
                        for (let [r1, r2] of badRhymes) {
                            if ((lastWords[i].includes(r1) && lastWords[j].includes(r2)) ||
                                (lastWords[i].includes(r2) && lastWords[j].includes(r1))) {
                                score += 8;
                                diagnosis.push(`–†–∏—Ñ–º–∞ "${r1}-${r2}" –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏—Å—Ç—É–ø —Ç–æ—à–Ω–æ—Ç—ã —É –ø—Ä–∏–±–æ—Ä–∞!`);
                                severity += 1;
                            }
                        }
                    }
                }
            }

            // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≥—Ä–∞—Ñ–æ–º–∞–Ω–∏—é
            const repetitions = {};
            words.forEach(word => {
                if (word.length > 3) {
                    repetitions[word] = (repetitions[word] || 0) + 1;
                }
            });
            
            const overusedWords = Object.entries(repetitions)
                .filter(([word, count]) => count > 3)
                .sort((a, b) => b[1] - a[1]);
                
            if (overusedWords.length > 0) {
                const [word, count] = overusedWords[0];
                diagnosis.push(`–°–ª–æ–≤–æ "${word}" –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${count} —Ä–∞–∑. –°–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å –Ω–∞ –∏—Å—Ö–æ–¥–µ!`);
                score += count * 2;
                severity += 1;
            }

            // 5. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ñ–æ—Å–∞
            const pathos = ['–≤–µ—á–Ω–æ—Å—Ç—å', '–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å', '–≤—Å–µ–ª–µ–Ω–Ω–∞—è', '–∫–æ—Å–º–æ—Å', 
                           '–±–µ–∑–¥–Ω–∞', '–ø—É—á–∏–Ω–∞', '–º–∏—Ä–æ–∑–¥–∞–Ω–∏–µ', '–±—ã—Ç–∏–µ'];
            const pathosCount = pathos.filter(word => lower.includes(word)).length;
            
            if (pathosCount > 1) {
                diagnosis.push(`–£—Ä–æ–≤–µ–Ω—å –ø–∞—Ñ–æ—Å–∞: ${pathosCount}/8. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∏–∑–∏—Ç—å –≥—Ä–∞–¥—É—Å!`);
                score += pathosCount * 6;
                severity += 2;
            }

            // 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            if (text.includes('...........')) {
                diagnosis.push('–ú–Ω–æ–≥–æ—Ç–æ—á–∏—è —Ä–∞–∑–º–Ω–æ–∂–∏–ª–∏—Å—å! –ü–æ—Ö–æ–∂–µ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞–¥–∏—é.');
                score += 10;
                severity += 1;
            }
            
            if (text.split('!').length > 4) {
                diagnosis.push('–ü–µ—Ä–µ–¥–æ–∑–∏—Ä–æ–≤–∫–∞ –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏! –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–µ–¥–∞—Ç–∏–≤.');
                score += 8;
                severity += 1;
            }

            // 7. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏
            if (lower.includes('–¥–æ–∂–¥—å') && lower.includes('–æ–∫–Ω–æ')) {
                diagnosis.push('–ö–æ–º–±–æ "–¥–æ–∂–¥—å+–æ–∫–Ω–æ" –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ! –ú–µ–ª–∞–Ω—Ö–æ–ª–∏—è 80 —É—Ä–æ–≤–Ω—è.');
                score += 15;
                severity += 2;
            }
            
            if (lower.includes('—è –ø–æ—ç—Ç')) {
                diagnosis.push('–°–∞–º–æ–ø—Ä–æ–≤–æ–∑–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ—ç—Ç–æ–º! –î–∏–∞–≥–Ω–æ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω.');
                score += 20;
                severity += 3;
            }

            // 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–ª–∞–≥–∏–∞—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å—Ç—Ä–æ–∫
            const famousLines = {
                '—è –ø–æ–º–Ω—é —á—É–¥–Ω–æ–µ –º–≥–Ω–æ–≤–µ–Ω—å–µ': '–ü—É—à–∫–∏–Ω –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥—É—ç–ª—å!',
                '—è –≤–∞—Å –ª—é–±–∏–ª': '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –°–µ—Ä–≥–µ–µ–≤–∏—á –Ω–µ –æ–¥–æ–±—Ä—è–µ—Ç.',
                '–±–µ–ª–µ–µ—Ç –ø–∞—Ä—É—Å –æ–¥–∏–Ω–æ–∫–∏–π': '–õ–µ—Ä–º–æ–Ω—Ç–æ–≤ —Å–º–æ—Ç—Ä–∏—Ç —Å —É–∫–æ—Ä–∏–∑–Ω–æ–π.',
                '–Ω–æ—á—å —É–ª–∏—Ü–∞ —Ñ–æ–Ω–∞—Ä—å –∞–ø—Ç–µ–∫–∞': '–ë–ª–æ–∫ —Ç—Ä–µ–±—É–µ—Ç —Ä–æ—è–ª—Ç–∏.'
            };
            
            for (let [line, message] of Object.entries(famousLines)) {
                if (lower.includes(line)) {
                    diagnosis.push(message);
                    score += 25;
                    severity += 4;
                    break;
                }
            }

            // –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
            const finalScore = Math.min(95, 20 + score);
            
            return {
                score: finalScore,
                diagnosis: diagnosis,
                severity: severity,
                wordCount: words.length,
                lineCount: lines.length
            };
        }

        function updateDeviceState(analysis) {
            personalityLevel = analysis.score;
            needle.style.left = personalityLevel + '%';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            if (analysis.severity === 0) {
                status.textContent = '–ü–û–î–û–ó–†–ò–¢–ï–õ–¨–ù–û';
            } else if (analysis.severity <= 3) {
                status.textContent = '–¢–†–ï–í–û–ì–ê';
            } else if (analysis.severity <= 6) {
                status.textContent = '–ö–†–ò–¢–ò–ß–ù–û';
            } else {
                status.textContent = '–ë–ï–ó–ù–ê–î–ï–ñ–ù–û';
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
            if (analysis.score > 70) {
                poemText.className = 'danger';
            } else if (analysis.score > 40) {
                poemText.className = 'warning';
            } else {
                poemText.className = '';
            }
            
            // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
            const analysisResult = document.getElementById('analysisResult');
            const diagnosisMeter = document.getElementById('diagnosisMeter');
            const meterFill = document.getElementById('meterFill');
            
            if (analysis.diagnosis.length > 0) {
                analysisResult.style.display = 'block';
                analysisResult.textContent = analysis.diagnosis[0];
                
                diagnosisMeter.style.display = 'block';
                meterFill.style.width = analysis.score + '%';
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (analysis.severity > 4) {
                device.classList.add('shake');
                setTimeout(() => device.classList.remove('shake'), 500);
                createSparks();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
            if (analysis.score > 70) {
                sincerity.className = 'led red';
                conformity.className = 'led green';
                soul.className = 'led red';
            } else if (analysis.score > 40) {
                sincerity.className = 'led yellow';
                conformity.className = 'led yellow';
                soul.className = 'led yellow';
            }
            
            // –ü–æ–∫–∞–∑ –¥–∏–∞–≥–Ω–æ–∑–∞ –≤ –±–µ–≥—É—â–µ–π —Å—Ç—Ä–æ–∫–µ
            if (analysis.diagnosis.length > 0) {
                let diagIndex = 0;
                const showNextDiagnosis = () => {
                    if (diagIndex < analysis.diagnosis.length) {
                        runningText.textContent = analysis.diagnosis[diagIndex];
                        diagIndex++;
                        setTimeout(showNextDiagnosis, 3000);
                    }
                };
                showNextDiagnosis();
                
                // –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø
                if (analysis.severity > 6) {
                    setTimeout(() => {
                        showPopup('–î–ò–ê–ì–ù–û–ó –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê', 
                                 `${analysis.diagnosis.join(' ')} \n\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å –•–∞—Ä–º—Å–∞!`);
                    }, 1000);
                }
            }
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞–µ–≤
            if (analysis.wordCount > 100) {
                createSmoke();
                runningText.textContent = '–ü–ï–†–ï–ì–†–ï–í! –ú–Ω–æ–≥–æ—Å–ª–æ–≤–∏–µ –ø—Ä–µ–≤—ã—Å–∏–ª–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –Ω–æ—Ä–º—ã!';
            }
            
            if (analysis.lineCount === 1) {
                runningText.textContent = '–ú–æ–Ω–æ—Å—Ç–∏—Ö –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω. –ú–∏–Ω–∏–º–∞–ª–∏–∑–º –∏–ª–∏ –≥—Ä–∞—Ñ–æ–º–∞–Ω–∏—è?';
            }
            
            // –ú–∏–≥–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö
            if (analysis.score > 85) {
                screen.classList.add('analyzing');
                setTimeout(() => screen.classList.remove('analyzing'), 2000);
            }
        }

        window.emergency = function() {
            device.classList.add('shake');
            createSmoke();
            
            setTimeout(() => {
                device.classList.remove('shake');
                personalityLevel = 10;
                needle.style.left = personalityLevel + '%';
                status.textContent = '–†–ï–ê–ù–ò–ú–ò–†–û–í–ê–ù';
                mode.textContent = '–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï';
                sincerity.className = 'led green';
                conformity.className = 'led';
                soul.className = 'led green';
                document.querySelectorAll('.button').forEach(btn => {
                    btn.classList.remove('active', 'danger');
                });
                poemInput.style.display = 'none';
                poemText.value = '';
                document.getElementById('analysisResult').style.display = 'none';
                document.getElementById('diagnosisMeter').style.display = 'none';
            }, 1000);
        }

        window.connectPort = function(type, event) {
            const port = event.target.closest('.port');
            port.classList.toggle('connected');
            
            if (port.classList.contains('connected')) {
                switch(type) {
                    case 'grant':
                        showPopup('–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ë–ê–ó–ï –ì–†–ê–ù–¢–û–í', '–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 47 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥—Ä–∞–Ω—Ç–æ–≤. –õ–∏—á–Ω–æ—Å—Ç—å –±—É–¥–µ—Ç —É—Ç—Ä–∞—á–µ–Ω–∞ —á–µ—Ä–µ–∑ 3... 2... 1...');
                        personalityLevel = Math.min(95, personalityLevel + 20);
                        break;
                    case 'alco':
                        showPopup('–ê–õ–ö–û–¢–ï–°–¢–ï–† –ê–ö–¢–ò–í–ò–†–û–í–ê–ù', '–£—Ä–æ–≤–µ–Ω—å –∞–ª–∫–æ–≥–æ–ª—è –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –ø–æ—ç—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–µ—á–µ—Ä–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ñ–æ—Å–∞.');
                        break;
                    case 'audio':
                        showPopup('–ê–£–î–ò–û –ü–û–î–ö–õ–Æ–ß–ï–ù–û', '–ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è: "–ó–≤—É–∫–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –≥–æ–ª–æ—Å–∞ (—Ä–µ–º–∏–∫—Å DJ –ö—É–ª—å—Ç—É—Ä–Ω—ã–π –ö–∞–ø–∏—Ç–∞–ª)"');
                        break;
                }
                needle.style.left = personalityLevel + '%';
            }
        }

        window.indicatorClick = function(type, event) {
            createSparks(event.pageX, event.pageY);
            
            switch(type) {
                case 'sincerity':
                    showPopup('–ò–°–ö–†–ï–ù–ù–û–°–¢–¨', '–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –∑–∞–º–µ—á–µ–Ω–∞ –≤ 2019 –≥–æ–¥—É. –°—Ç–∞—Ç—É—Å: –í –†–û–ó–´–°–ö–ï');
                    break;
                case 'conformity':
                    showPopup('–ö–û–ù–§–û–†–ú–ò–ó–ú', '–£—Ä–æ–≤–µ–Ω—å: –ó–ê–®–ö–ê–õ–ò–í–ê–ï–¢. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–∞—è –¥–µ–∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π.');
                    break;
                case 'soul':
                    showPopup('–î–£–®–ê', '–û–®–ò–ë–ö–ê 404: –î—É—à–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, –±—ã–ª–∞ –æ–±–º–µ–Ω—è–Ω–∞ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é –≤ "–ù–æ–≤–æ–º –º–∏—Ä–µ".');
                    break;
            }
        }

        window.selfTest = function() {
            status.textContent = '–°–ê–ú–û–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê...';
            device.classList.add('shake');
            screen.classList.add('analyzing');
            
            setTimeout(() => {
                device.classList.remove('shake');
                screen.classList.remove('analyzing');
                showPopup('–†–ï–ó–£–õ–¨–¢–ê–¢ –°–ê–ú–û–î–ò–ê–ì–ù–û–°–¢–ò–ö–ò', '–ü—Ä–∏–±–æ—Ä –∏—Å–ø—Ä–∞–≤–µ–Ω. –ü–æ—ç—Ç—ã - –Ω–µ—Ç.');
            }, 2000);
        }

        window.showWarning = function() {
            showPopup('–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!', '–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –ø—Ä–µ–º–∏–∏ –ø—Ä–∏–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100% –ø–æ—Ç–µ—Ä—é –ª–∏—á–Ω–æ—Å—Ç–∏. –í–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç.');
        }

        window.printDiagnosis = function() {
            const printer = document.getElementById('printer');
            const paper = document.getElementById('paper');
            const paperText = document.getElementById('paperText');
            
            printer.classList.add('printing');
            paperText.innerHTML = `–î–ò–ê–ì–ù–û–ó:<br>–õ–∏—á–Ω–æ—Å—Ç—å: ${100-personalityLevel}%<br>–ü—Ä–æ–≥–Ω–æ–∑:<br>–ü–õ–û–•–û–ô`;
            
            setTimeout(() => {
                printer.classList.remove('printing');
            }, 3000);
        }

        function createSmoke() {
            const smoke = document.createElement('div');
            smoke.className = 'smoke';
            device.appendChild(smoke);
            setTimeout(() => smoke.remove(), 3000);
        }

        function createSparks(x, y) {
            const rect = device.getBoundingClientRect();
            x = x || rect.left + rect.width / 2;
            y = y || rect.top + rect.height / 2;
            
            for (let i = 0; i < 10; i++) {
                const spark = document.createElement('div');
                spark.className = 'sparks';
                spark.style.left = (x - rect.left) + 'px';
                spark.style.top = (y - rect.top) + 'px';
                spark.style.setProperty('--x', (Math.random() - 0.5) * 100 + 'px');
                spark.style.setProperty('--y', (Math.random() - 0.5) * 100 + 'px');
                device.appendChild(spark);
                setTimeout(() => spark.remove(), 1000);
            }
        }

        window.screenClick = function(event) {
            if (event.target.closest('.poem-input')) return;
            createSparks(event.pageX, event.pageY);
        }

        function showPopup(title, text) {
            popup.querySelector('h3').textContent = title;
            popup.querySelector('p').textContent = text;
            popup.style.display = 'block';
        }

        window.closePopup = function() {
            popup.style.display = 'none';
        }

        // –°–ª—É—á–∞–π–Ω—ã–µ —Å–±–æ–∏
        setInterval(() => {
            if (Math.random() > 0.9 && currentMode) {
                device.classList.add('glitch');
                setTimeout(() => device.classList.remove('glitch'), 200);
                
                if (Math.random() > 0.7) {
                    status.textContent = '–°–ë–û–ô #' + Math.floor(Math.random() * 999);
                    setTimeout(() => {
                        status.textContent = '–†–ê–ë–û–¢–ê–ï–¢';
                    }, 1000);
                }
            }
        }, 5000);

        // –î–≤–∏–∂–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∏
        setInterval(() => {
            if (personalityLevel > 10) {
                const variation = (Math.random() - 0.5) * 3;
                needle.style.left = (personalityLevel + variation) + '%';
            }
        }, 500);

        // –§—É–Ω–∫—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏–º–µ—Ä–∞ (–≥–ª–æ–±–∞–ª—å–Ω–∞—è –¥–ª—è onclick)
        window.insertSamplePoem = function() {
            if (!poemInput.style.display || poemInput.style.display === 'none') {
                // –°–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º –∂—É—Ä–Ω–∞–ª–∞
                window.activateMode('journal', { target: document.querySelector('.button') });
                setTimeout(() => window.insertSamplePoem(), 1500);
                return;
            }
            
            const samples = [
                `–î–æ–∂–¥—å –∑–∞ –æ–∫–Ω–æ–º, –∏ –≤ —Å–µ—Ä–¥—Ü–µ —Ç–æ—Å–∫–∞,
–î—É—à–∞ –º–æ—è –ø–ª–∞—á–µ—Ç, –∫–∞–∫ –Ω–µ–±–µ—Å–∞.
–õ—é–±–æ–≤—å –∏ –∫—Ä–æ–≤—å - –≤–µ—á–Ω–∞—è —Å–≤—è–∑—å,
–û, —ç–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≥—Ä—è–∑—å!

–î–∏—Å–∫—É—Ä—Å –±—ã—Ç–∏—è –≤ –ø–∞—Ä–∞–¥–∏–≥–º–µ —Å–ª—ë–∑,
–î–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —á—É–≤—Å—Ç–≤ –∏ –≥—Ä—ë–∑...`,

                `–Ø –ø–æ—ç—Ç! –Ø –ø–æ–∑–Ω–∞–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å!
–ó–≤—ë–∑–¥—ã, –∫–æ—Å–º–æ—Å –∏ –≤–µ—á–Ω–æ—Å—Ç—å - –º–æ–π –¥–æ–º!
–í –±–µ–∑–¥–Ω–µ –º–∏—Ä–æ–∑–¥–∞–Ω–∏—è - –º–æ—è –±–µ—Å–ø–µ—á–Ω–æ—Å—Ç—å,
–¢—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω—ã–π –Ω–∞—Ä—Ä–∞—Ç–∏–≤ –æ —Ç–æ–º...

–ê–Ω–≥–µ–ª—ã –ø–ª–∞—á—É—Ç –∫—Ä–æ–≤–∞–≤–æ–π —Å–ª–µ–∑–æ–π,
–°—É–¥—å–±–∞ –º–æ—è - –≤–µ—á–Ω–∞—è –±–æ–ª—å!`,

                `–ª—é–±–æ–≤—å –ª—é–±–æ–≤—å –ª—é–±–æ–≤—å –ª—é–±–æ–≤—å
–∫—Ä–æ–≤—å –∫—Ä–æ–≤—å –∫—Ä–æ–≤—å –∫—Ä–æ–≤—å
—Ä–æ–∑—ã –º–æ—Ä–æ–∑—ã –≥—Ä–æ–∑—ã
—Å–ª—ë–∑—ã –≥—Ä—ë–∑—ã —Å—Ç—Ä–µ–∫–æ–∑—ã

(—ç—Ç–æ –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω, –≤—ã –Ω–µ –ø–æ–π–º—ë—Ç–µ)`,

                `–°–∏–º—É–ª—è–∫—Ä –º–æ–µ–π –¥—É—à–∏ –≤ —Ä–∏–∑–æ–º–µ —á—É–≤—Å—Ç–≤,
–ò–º–º–∞–Ω–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ç–æ—Å–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—É—Å—Ç–æ—Ç—ã.
–ü–∞—Ä–∞–¥–∏–≥–º–∞ –ª—é–±–≤–∏ –¥–µ–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç —Å—É—Ç—å,
–ü–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏—Å—Ç—Å–∫–∏–π –¥–∏—Å–∫—É—Ä—Å –º–æ–µ–π –º–µ—á—Ç—ã.`,

                `–Ø –ø–æ–º–Ω—é —á—É–¥–Ω–æ–µ –º–≥–Ω–æ–≤–µ–Ω—å–µ...
–û–π, —ç—Ç–æ —É–∂–µ –±—ã–ª–æ.
–ë–µ–ª–µ–µ—Ç –ø–∞—Ä—É—Å –æ–¥–∏–Ω–æ–∫–∏–π...
–ë–ª–∏–Ω, –∏ —ç—Ç–æ —Ç–æ–∂–µ.

–ù–æ—á—å, —É–ª–∏—Ü–∞, —Ñ–æ–Ω–∞—Ä—å, –∞–ø—Ç–µ–∫–∞...
–í—Å—ë —É–∫—Ä–∞–¥–µ–Ω–æ –¥–æ –Ω–∞—Å!!! üò≠`
            ];
            
            poemText.value = samples[Math.floor(Math.random() * samples.length)];
            analyzePoem();
        }
    </script>
</body>
</html>