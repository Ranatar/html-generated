<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ –ñ–∏–∑–Ω—å: –í–æ–π–Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö (–ø–æ –ì–æ–±–±—Å—É)</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        h1 {
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #a0a0a0;
            font-style: italic;
            margin-bottom: 20px;
            text-align: center;
        }
        
        #canvas {
            border: 2px solid #444;
            background: #0a0a0a;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            cursor: crosshair;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }
        
        button.success {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
        }
        
        .stats {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 1000px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .normal-cell { color: #51cf66; }
        .xenophobic-cell { color: #ff6b6b; }
        .war-zones { color: #ffd43b; }
        
        .legend {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .slider-group label {
            font-size: 12px;
            color: #888;
        }
        
        input[type="range"] {
            width: 150px;
        }
    </style>
</head>
<body>
    <h1>üî• –ò–≥—Ä–∞ –ñ–∏–∑–Ω—å: –í–æ–π–Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö üî•</h1>
    <div class="subtitle">"Homo homini lupus est" ‚Äî –¢–æ–º–∞—Å –ì–æ–±–±—Å<br>
    <small style="color: #666;">–ö—Å–µ–Ω–æ—Ñ–æ–±—ã –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã –∏ –Ω–µ —Ç–µ—Ä–ø—è—Ç —Å–æ—Å–µ–¥—Å—Ç–≤–∞. –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –º–∏—Ä–Ω—ã–µ, –Ω–æ –∑–∞—â–∏—â–∞—é—Ç—Å—è —á–∏—Å–ª–æ–º.</small></div>
    
    <canvas id="canvas" width="800" height="800"></canvas>
    
    <div class="controls">
        <button id="startBtn" class="success">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
        <button id="pauseBtn">‚è∏ –ü–∞—É–∑–∞</button>
        <button id="clearBtn" class="danger">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="randomBtn">üé≤ –°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
        
        <div class="slider-group">
            <label>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="speedValue">100</span> –º—Å</label>
            <input type="range" id="speedSlider" min="10" max="500" value="100" step="10">
        </div>
        
        <div class="slider-group">
            <label>–®–∞–Ω—Å –∫—Å–µ–Ω–æ—Ñ–æ–±–∏–∏: <span id="xenoChanceValue">33</span>%</label>
            <input type="range" id="xenoChanceSlider" min="0" max="100" value="33" step="1">
        </div>
        
        <div class="slider-group">
            <label>–®–∞–Ω—Å —É–±–µ–∂–¥–µ–Ω–∏—è: <span id="persuasionValue">15</span>%</label>
            <input type="range" id="persuasionSlider" min="0" max="100" value="15" step="1">
        </div>
        
        <div class="slider-group">
            <label>–ù–∞—á–∞–ª—å–Ω–∞—è –∫—Å–µ–Ω–æ—Ñ–æ–±–∏—è: <span id="initialXenoValue">33</span>%</label>
            <input type="range" id="initialXenoSlider" min="0" max="100" value="33" step="1">
        </div>
        
        <div class="slider-group">
            <label>–°—Ç–µ–ø–µ–Ω—å –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏: <span id="hostilityValue">50</span>%</label>
            <input type="range" id="hostilitySlider" min="0" max="100" value="50" step="10">
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            <div class="stat-label">–ü–æ–∫–æ–ª–µ–Ω–∏–µ</div>
            <div class="stat-value" id="generation">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">–ñ–∏–≤—ã—Ö –∫–ª–µ—Ç–æ–∫</div>
            <div class="stat-value" id="totalCells">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label normal-cell">–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ</div>
            <div class="stat-value normal-cell" id="normalCells">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label xenophobic-cell">–ö—Å–µ–Ω–æ—Ñ–æ–±–Ω—ã–µ</div>
            <div class="stat-value xenophobic-cell" id="xenoCells">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label war-zones">–ó–æ–Ω—ã –≤–æ–π–Ω—ã</div>
            <div class="stat-value war-zones" id="warZones">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label war-zones">–°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–π–Ω—ã</div>
            <div class="stat-value war-zones" id="avgHeat">0%</div>
        </div>
    </div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #51cf66;"></div>
            <span>–ù–æ—Ä–º–∞–ª—å–Ω–∞—è –∫–ª–µ—Ç–∫–∞ ‚Äî –º–∏—Ä–Ω–∞—è, –∑–∞—â–∏—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∞—Ç–∞–∫—É—é—Ç</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff6b6b;"></div>
            <span>–ö—Å–µ–Ω–æ—Ñ–æ–±–Ω–∞—è –∫–ª–µ—Ç–∫–∞ ‚Äî –≤–æ—é–µ—Ç —Å–æ –≤—Å–µ–º–∏, –Ω–µ —Ç–µ—Ä–ø–∏—Ç —Å–æ—Å–µ–¥—Å—Ç–≤–∞</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(to right, #ffd43b, #ffa500, #ff0000, #8b0000);"></div>
            <span>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–π–Ω—ã: –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ—Ä–æ–Ω—Ç ‚Üí –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        const CELL_SIZE = 8;
        const COLS = Math.floor(canvas.width / CELL_SIZE);
        const ROWS = Math.floor(canvas.height / CELL_SIZE);
        const WAR_ZONE_SIZE = 10; // –†–∞–∑–º–µ—Ä –∑–æ–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        const WAR_THRESHOLD = 0.5; // 50% –ø–æ—Ä–æ–≥
        
        let grid = [];
        let isRunning = false;
        let generation = 0;
        let interval = null;
        let speed = 100;
        let xenoChance = 0.33;
        let persuasionChance = 0.15;
        let initialXenoChance = 0.33;
        let hostility = 0.5; // –°—Ç–µ–ø–µ–Ω—å –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏ 0-1
        let warZones = new Set();
        let warZoneData = new Map(); // –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ" –∑–æ–Ω
        
        // –¢–∏–ø—ã –∫–ª–µ—Ç–æ–∫
        const CELL_TYPE = {
            DEAD: 0,
            NORMAL: 1,
            XENOPHOBIC: 2
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏
        function initGrid() {
            grid = [];
            for (let y = 0; y < ROWS; y++) {
                grid[y] = [];
                for (let x = 0; x < COLS; x++) {
                    grid[y][x] = CELL_TYPE.DEAD;
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
        function draw() {
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –°–Ω–∞—á–∞–ª–∞ —Ä–∏—Å—É–µ–º –∑–æ–Ω—ã –≤–æ–π–Ω—ã —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
            warZones.forEach(zoneKey => {
                const [zx, zy] = zoneKey.split(',').map(Number);
                const zoneData = warZoneData.get(zoneKey);
                const heat = zoneData ? zoneData.heat : 0;
                
                // –¶–≤–µ—Ç–æ–≤–∞—è —à–∫–∞–ª–∞ –æ—Ç –∂–µ–ª—Ç–æ–≥–æ (—Ö–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞) –¥–æ —Ç–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω–æ–≥–æ (–≥–æ—Ä—è—á–∞—è –≤–æ–π–Ω–∞)
                // heat –æ—Ç 0 (50% –∫—Å–µ–Ω–æ—Ñ–æ–±–æ–≤) –¥–æ 1 (100% –∫—Å–µ–Ω–æ—Ñ–æ–±–æ–≤ –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏)
                let r, g, b;
                if (heat < 0.33) {
                    // –ñ–µ–ª—Ç—ã–π ‚Üí –û—Ä–∞–Ω–∂–µ–≤—ã–π
                    const t = heat / 0.33;
                    r = 255;
                    g = Math.floor(212 - t * 47); // 212 ‚Üí 165
                    b = Math.floor(59 * (1 - t)); // 59 ‚Üí 0
                } else if (heat < 0.66) {
                    // –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Üí –ö—Ä–∞—Å–Ω—ã–π
                    const t = (heat - 0.33) / 0.33;
                    r = 255;
                    g = Math.floor(165 * (1 - t)); // 165 ‚Üí 0
                    b = 0;
                } else {
                    // –ö—Ä–∞—Å–Ω—ã–π ‚Üí –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π
                    const t = (heat - 0.66) / 0.34;
                    r = Math.floor(255 - t * 100); // 255 ‚Üí 155
                    g = 0;
                    b = 0;
                }
                
                ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${0.2 + heat * 0.3})`;
                ctx.fillRect(zx * CELL_SIZE, zy * CELL_SIZE, 
                           WAR_ZONE_SIZE * CELL_SIZE, WAR_ZONE_SIZE * CELL_SIZE);
                ctx.strokeStyle = `rgb(${r}, ${g}, ${b})`;
                ctx.lineWidth = 2 + heat * 2;
                ctx.strokeRect(zx * CELL_SIZE, zy * CELL_SIZE, 
                             WAR_ZONE_SIZE * CELL_SIZE, WAR_ZONE_SIZE * CELL_SIZE);
            });
            
            // –†–∏—Å—É–µ–º –∫–ª–µ—Ç–∫–∏
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] === CELL_TYPE.NORMAL) {
                        ctx.fillStyle = '#51cf66';
                        ctx.fillRect(x * CELL_SIZE + 1, y * CELL_SIZE + 1, 
                                   CELL_SIZE - 2, CELL_SIZE - 2);
                    } else if (grid[y][x] === CELL_TYPE.XENOPHOBIC) {
                        ctx.fillStyle = '#ff6b6b';
                        ctx.fillRect(x * CELL_SIZE + 1, y * CELL_SIZE + 1, 
                                   CELL_SIZE - 2, CELL_SIZE - 2);
                        // –î–æ–±–∞–≤–ª—è–µ–º "–∑–ª–æ–π" —ç—Ñ—Ñ–µ–∫—Ç
                        ctx.fillStyle = '#ff0000';
                        ctx.fillRect(x * CELL_SIZE + 3, y * CELL_SIZE + 3, 
                                   CELL_SIZE - 6, CELL_SIZE - 6);
                    }
                }
            }
        }
        
        // –ü–æ–¥—Å—á–µ—Ç —Å–æ—Å–µ–¥–µ–π
        function countNeighbors(x, y, type = null) {
            let count = 0;
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    if (dx === 0 && dy === 0) continue;
                    
                    const nx = (x + dx + COLS) % COLS;
                    const ny = (y + dy + ROWS) % ROWS;
                    
                    if (type === null) {
                        // –°—á–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∂–∏–≤—ã—Ö —Å–æ—Å–µ–¥–µ–π
                        if (grid[ny][nx] !== CELL_TYPE.DEAD) count++;
                    } else {
                        // –°—á–∏—Ç–∞–µ–º —Å–æ—Å–µ–¥–µ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
                        if (grid[ny][nx] === type) count++;
                    }
                }
            }
            return count;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–æ–Ω—ã –Ω–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∫—Å–µ–Ω–æ—Ñ–æ–±–æ–≤ –∏ —Ä–∞—Å—á–µ—Ç "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã" –≤–æ–π–Ω—ã
        function checkWarZone(startX, startY) {
            let totalCells = 0;
            let xenoCells = 0;
            let normalCells = 0;
            let conflictEdges = 0; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä —Å–æ—Å–µ–¥–Ω–∏—Ö –∫–ª–µ—Ç–æ–∫ —Ä–∞–∑–Ω–æ–≥–æ —Ç–∏–ø–∞
            const maxCells = WAR_ZONE_SIZE * WAR_ZONE_SIZE;
            
            // –ü–µ—Ä–≤—ã–π –ø—Ä–æ—Ö–æ–¥ - –ø–æ–¥—Å—á–µ—Ç –∫–ª–µ—Ç–æ–∫
            for (let y = startY; y < Math.min(startY + WAR_ZONE_SIZE, ROWS); y++) {
                for (let x = startX; x < Math.min(startX + WAR_ZONE_SIZE, COLS); x++) {
                    if (grid[y][x] !== CELL_TYPE.DEAD) {
                        totalCells++;
                        if (grid[y][x] === CELL_TYPE.XENOPHOBIC) {
                            xenoCells++;
                        } else {
                            normalCells++;
                        }
                    }
                }
            }
            
            if (totalCells === 0) return { isWar: false, heat: 0 };
            
            const xenoRatio = xenoCells / totalCells;
            const isWar = xenoRatio > WAR_THRESHOLD;
            
            if (!isWar) return { isWar: false, heat: 0 };
            
            // –í—Ç–æ—Ä–æ–π –ø—Ä–æ—Ö–æ–¥ - –ø–æ–¥—Å—á–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü
            for (let y = startY; y < Math.min(startY + WAR_ZONE_SIZE, ROWS); y++) {
                for (let x = startX; x < Math.min(startX + WAR_ZONE_SIZE, COLS); x++) {
                    const current = grid[y][x];
                    if (current === CELL_TYPE.DEAD) continue;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å–µ–¥–µ–π —Å–ø—Ä–∞–≤–∞ –∏ —Å–Ω–∏–∑—É (—á—Ç–æ–±—ã –Ω–µ —Å—á–∏—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã)
                    const neighbors = [
                        { dx: 1, dy: 0 },  // —Å–ø—Ä–∞–≤–∞
                        { dx: 0, dy: 1 },  // —Å–Ω–∏–∑—É
                    ];
                    
                    for (const {dx, dy} of neighbors) {
                        const nx = x + dx;
                        const ny = y + dy;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ—Å–µ–¥ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–æ–Ω—ã
                        if (nx >= startX && nx < Math.min(startX + WAR_ZONE_SIZE, COLS) &&
                            ny >= startY && ny < Math.min(startY + WAR_ZONE_SIZE, ROWS)) {
                            
                            const neighbor = grid[ny][nx];
                            
                            // –°—á–∏—Ç–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã (—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∫–ª–µ—Ç–æ–∫)
                            if ((current === CELL_TYPE.NORMAL && neighbor === CELL_TYPE.XENOPHOBIC) ||
                                (current === CELL_TYPE.XENOPHOBIC && neighbor === CELL_TYPE.NORMAL)) {
                                conflictEdges++;
                            }
                        }
                    }
                }
            }
            
            // –†–∞—Å—á–µ—Ç "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã" –≤–æ–π–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫:
            
            // –ú–µ—Ç—Ä–∏–∫–∞ 1: –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ - –º–Ω–æ–≥–æ –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü?
            // –ú–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ 50/50 —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏
            // –ü—Ä–∏ –ø–æ–ª–Ω–æ–º –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü –ø–æ—á—Ç–∏ –Ω–µ—Ç
            const maxPossibleEdges = totalCells * 2; // –≥—Ä—É–±–∞—è –æ—Ü–µ–Ω–∫–∞
            const conflictIntensity = conflictEdges / Math.max(1, maxPossibleEdges);
            
            // –ú–µ—Ç—Ä–∏–∫–∞ 2: –î–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç 50%)
            const dominance = Math.abs(xenoRatio - 0.5) * 2; // 0 –ø—Ä–∏ 50/50, 1 –ø—Ä–∏ 100/0
            
            // –ú–µ—Ç—Ä–∏–∫–∞ 3: –ü–ª–æ—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è
            const density = totalCells / maxCells;
            
            // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:
            // - –í—ã—Å–æ–∫–∞—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —Ñ—Ä–æ–Ω—Ç–µ (–º–Ω–æ–≥–æ –≥—Ä–∞–Ω–∏—Ü) –ò –≤—ã—Å–æ–∫–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
            // - –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
            // - –ù–∏–∑–∫–∞—è –ø—Ä–∏ –º–∞–ª–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º conflictIntensity –¥–ª—è –ª—É—á—à–µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
            const normalizedConflict = Math.min(1, conflictIntensity * 5);
            
            // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç:
            // 60% - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ (–º–Ω–æ–≥–æ –≥—Ä–∞–Ω–∏—Ü = –≥–æ—Ä—è—á–æ)
            // 20% - –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—á–µ–º –±–æ–ª—å—à–µ –ø–µ—Ä–µ–≤–µ—Å, —Ç–µ–º —Ö–æ–ª–æ–¥–Ω–µ–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–∏–∫–∞)
            // 20% - –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è
            let heat = normalizedConflict * 0.6 + dominance * 0.2 + density * 0.2;
            
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –Ω–∞ "–ø–µ—Ä–µ–ª–æ–º–Ω–æ–º –º–æ–º–µ–Ω—Ç–µ"
            // –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∏ –≤—ã—Å–æ–∫–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ—Å—Ç—å –ò –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            const transitionHeat = normalizedConflict * (1 - dominance * 0.5);
            heat = Math.max(heat, transitionHeat);
            
            return { 
                isWar: true, 
                heat: Math.min(1, heat),
                xenoRatio: xenoRatio,
                density: density,
                totalCells: totalCells,
                xenoCells: xenoCells,
                normalCells: normalCells,
                conflictEdges: conflictEdges,
                conflictIntensity: normalizedConflict
            };
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∫–ª–µ—Ç–∫–∞ –≤ –∑–æ–Ω–µ –≤–æ–π–Ω—ã
        function isInWarZone(x, y) {
            for (let zy = Math.floor(y / WAR_ZONE_SIZE) * WAR_ZONE_SIZE - WAR_ZONE_SIZE; 
                 zy <= Math.floor(y / WAR_ZONE_SIZE) * WAR_ZONE_SIZE + WAR_ZONE_SIZE; 
                 zy += WAR_ZONE_SIZE) {
                for (let zx = Math.floor(x / WAR_ZONE_SIZE) * WAR_ZONE_SIZE - WAR_ZONE_SIZE; 
                     zx <= Math.floor(x / WAR_ZONE_SIZE) * WAR_ZONE_SIZE + WAR_ZONE_SIZE; 
                     zx += WAR_ZONE_SIZE) {
                    if (zx >= 0 && zy >= 0 && zx < COLS && zy < ROWS) {
                        if (warZones.has(`${zx},${zy}`)) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function update() {
            const newGrid = [];
            warZones.clear();
            warZoneData.clear();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∑–æ–Ω—ã –Ω–∞ –≤–æ–π–Ω—É
            for (let y = 0; y < ROWS; y += WAR_ZONE_SIZE) {
                for (let x = 0; x < COLS; x += WAR_ZONE_SIZE) {
                    const zoneCheck = checkWarZone(x, y);
                    if (zoneCheck.isWar) {
                        const zoneKey = `${x},${y}`;
                        warZones.add(zoneKey);
                        warZoneData.set(zoneKey, zoneCheck);
                    }
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
            for (let y = 0; y < ROWS; y++) {
                newGrid[y] = [];
                for (let x = 0; x < COLS; x++) {
                    const neighbors = countNeighbors(x, y);
                    const xenoNeighbors = countNeighbors(x, y, CELL_TYPE.XENOPHOBIC);
                    const normalNeighbors = countNeighbors(x, y, CELL_TYPE.NORMAL);
                    const currentCell = grid[y][x];
                    const inWarZone = isInWarZone(x, y);
                    
                    // –ê–°–ò–ú–ú–ï–¢–†–ò–ß–ù–´–ï –ü–†–ê–í–ò–õ–ê –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–ª–µ—Ç–æ–∫
                    
                    if (currentCell === CELL_TYPE.XENOPHOBIC) {
                        // === –ö–°–ï–ù–û–§–û–ë–ù–ê–Ø –ö–õ–ï–¢–ö–ê: –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø ===
                        // –ö—Å–µ–Ω–æ—Ñ–æ–±—ã –Ω–µ —Ç–µ—Ä–ø—è—Ç —Å–æ—Å–µ–¥—Å—Ç–≤–∞ –∏ –≤–æ—é—é—Ç —Å–æ –≤—Å–µ–º–∏, –≤–∫–ª—é—á–∞—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞
                        
                        if (neighbors < 2) {
                            // –°–º–µ—Ä—Ç—å –æ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞
                            newGrid[y][x] = CELL_TYPE.DEAD;
                        } else if (xenoNeighbors === 0) {
                            // –û–∫—Ä—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –∞—Ç–∞–∫—É–µ—Ç –∏ –≤—ã–∂–∏–≤–∞–µ—Ç
                            if (neighbors <= 3) {
                                newGrid[y][x] = CELL_TYPE.XENOPHOBIC;
                            } else {
                                newGrid[y][x] = CELL_TYPE.DEAD;
                            }
                        } else {
                            // –ï—Å—Ç—å –∫—Å–µ–Ω–æ—Ñ–æ–±–Ω—ã–µ —Å–æ—Å–µ–¥–∏ - —Ä–∏—Å–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
                            // –°–Ω–∏–∂–µ–Ω—ã —à–∞–Ω—Å—ã –¥–ª—è –±–∞–ª–∞–Ω—Å–∞
                            
                            let conflictChance = 0;
                            
                            if (xenoNeighbors === 1) {
                                conflictChance = 0.02 + hostility * 0.08; // 2-10%
                            } else if (xenoNeighbors === 2) {
                                conflictChance = 0.05 + hostility * 0.15; // 5-20%
                            } else if (xenoNeighbors === 3) {
                                conflictChance = 0.1 + hostility * 0.25; // 10-35%
                            } else if (xenoNeighbors >= 4) {
                                conflictChance = 0.2 + hostility * 0.4; // 20-60%
                            }
                            
                            // –í–æ–π–Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö - —Å–ª—É—á–∞–π–Ω–∞—è –≥–∏–±–µ–ª—å –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
                            if (Math.random() < conflictChance) {
                                newGrid[y][x] = CELL_TYPE.DEAD;
                            } else {
                                // –í—ã–∂–∏–ª –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–Ω–∞—Å–µ–ª–µ–Ω–∏—è
                                if (neighbors >= 2 && neighbors <= 3) {
                                    newGrid[y][x] = CELL_TYPE.XENOPHOBIC;
                                } else if (neighbors === 4) {
                                    // –ü—Ä–∏ 4 —Å–æ—Å–µ–¥—è—Ö –µ—â–µ –º–æ–∂–µ—Ç –≤—ã–∂–∏—Ç—å —Å —à–∞–Ω—Å–æ–º
                                    if (Math.random() < 0.5) {
                                        newGrid[y][x] = CELL_TYPE.XENOPHOBIC;
                                    } else {
                                        newGrid[y][x] = CELL_TYPE.DEAD;
                                    }
                                } else {
                                    newGrid[y][x] = CELL_TYPE.DEAD;
                                }
                            }
                        }
                        
                    } else if (currentCell === CELL_TYPE.NORMAL) {
                        // === –ù–û–†–ú–ê–õ–¨–ù–ê–Ø –ö–õ–ï–¢–ö–ê: –ú–ò–†–ù–ê–Ø, –ù–û –ó–ê–©–ò–©–ê–ï–¢–°–Ø ===
                        
                        if (xenoNeighbors === 0) {
                            // –ù–µ—Ç –∫—Å–µ–Ω–æ—Ñ–æ–±–æ–≤ —Ä—è–¥–æ–º - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–∏—Ä–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
                            if (neighbors >= 2 && neighbors <= 3) {
                                newGrid[y][x] = CELL_TYPE.NORMAL;
                            } else {
                                newGrid[y][x] = CELL_TYPE.DEAD;
                            }
                        } else {
                            // –ï—Å—Ç—å –∫—Å–µ–Ω–æ—Ñ–æ–±–Ω—ã–µ —Å–æ—Å–µ–¥–∏ - –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π!
                            
                            // –ë–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ –±–æ–ª–µ–µ —Ö—Ä—É–ø–∫–∏–µ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º
                            // –Ω–æ –º–æ–≥—É—Ç –≤—ã–∂–∏—Ç—å –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –¥—Ä—É–≥–∏—Ö –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö
                            
                            const xenoPressure = xenoNeighbors / neighbors; // –î–æ–ª—è –∫—Å–µ–Ω–æ—Ñ–æ–±–æ–≤ —Å—Ä–µ–¥–∏ —Å–æ—Å–µ–¥–µ–π
                            
                            // –ï—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–æ—Å–µ–¥–µ–π –∫—Å–µ–Ω–æ—Ñ–æ–±—ã - –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
                            if (xenoPressure > 0.6) {
                                // –ë–æ–ª–µ–µ 60% —Å–æ—Å–µ–¥–µ–π –∫—Å–µ–Ω–æ—Ñ–æ–±—ã
                                const survivalChance = 0.3 * (1 - hostility * 0.7); // 30% –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏, 9% –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π
                                if (Math.random() > survivalChance) {
                                    newGrid[y][x] = CELL_TYPE.DEAD;
                                } else {
                                    newGrid[y][x] = CELL_TYPE.NORMAL;
                                }
                            } else if (neighbors >= 2 && neighbors <= 3) {
                                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —á–∏—Å–ª–æ —Å–æ—Å–µ–¥–µ–π, –Ω–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫—Å–µ–Ω–æ—Ñ–æ–±–æ–≤
                                // –ú–æ–∂–µ—Ç –≤—ã–∂–∏—Ç—å –µ—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤
                                if (normalNeighbors >= 1) {
                                    newGrid[y][x] = CELL_TYPE.NORMAL;
                                } else {
                                    // –û–¥–∏–Ω –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö
                                    if (Math.random() < 0.5 - hostility * 0.3) {
                                        newGrid[y][x] = CELL_TYPE.NORMAL;
                                    } else {
                                        newGrid[y][x] = CELL_TYPE.DEAD;
                                    }
                                }
                            } else {
                                // –ù–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–µ —á–∏—Å–ª–æ —Å–æ—Å–µ–¥–µ–π
                                newGrid[y][x] = CELL_TYPE.DEAD;
                            }
                            
                            // –ú–µ—Ö–∞–Ω–∏–∫–∞ —É–±–µ–∂–¥–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–∂–∏–ª–∞)
                            if (newGrid[y][x] === CELL_TYPE.NORMAL && xenoNeighbors >= 2) {
                                const persuasionPower = (inWarZone ? persuasionChance * 1.5 : persuasionChance) * (1 + hostility * 0.5);
                                if (Math.random() < persuasionPower) {
                                    newGrid[y][x] = CELL_TYPE.XENOPHOBIC;
                                }
                            }
                        }
                        
                    } else if (neighbors === 3) {
                        // === –†–û–ñ–î–ï–ù–ò–ï –ù–û–í–û–ô –ö–õ–ï–¢–ö–ò ===
                        
                        let birthXenoChance = xenoChance;
                        
                        // –í –∑–æ–Ω–µ –≤–æ–π–Ω—ã —à–∞–Ω—Å –∫—Å–µ–Ω–æ—Ñ–æ–±–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
                        if (inWarZone) {
                            birthXenoChance = Math.min(0.8, xenoChance + 0.3);
                        }
                        
                        // –ï—Å–ª–∏ –º–Ω–æ–≥–æ –∫—Å–µ–Ω–æ—Ñ–æ–±–Ω—ã—Ö "—Ä–æ–¥–∏—Ç–µ–ª–µ–π", —à–∞–Ω—Å —Ç–æ–∂–µ –≤—ã—à–µ
                        if (xenoNeighbors >= 2) {
                            birthXenoChance = Math.min(0.9, birthXenoChance + 0.2 + hostility * 0.2);
                        }
                        
                        // –í—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–π —à–∞–Ω—Å –∫—Å–µ–Ω–æ—Ñ–æ–±–∏–∏ –ø—Ä–∏ —Ä–æ–∂–¥–µ–Ω–∏–∏
                        birthXenoChance = Math.min(0.95, birthXenoChance + hostility * 0.1);
                        
                        newGrid[y][x] = Math.random() < birthXenoChance 
                            ? CELL_TYPE.XENOPHOBIC 
                            : CELL_TYPE.NORMAL;
                    } else {
                        newGrid[y][x] = CELL_TYPE.DEAD;
                    }
                }
            }
            
            grid = newGrid;
            generation++;
            updateStats();
            draw();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            let total = 0;
            let normal = 0;
            let xeno = 0;
            
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (grid[y][x] !== CELL_TYPE.DEAD) {
                        total++;
                        if (grid[y][x] === CELL_TYPE.NORMAL) normal++;
                        else if (grid[y][x] === CELL_TYPE.XENOPHOBIC) xeno++;
                    }
                }
            }
            
            // –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤–æ–π–Ω—ã
            let avgHeat = 0;
            if (warZones.size > 0) {
                let totalHeat = 0;
                warZoneData.forEach(data => {
                    totalHeat += data.heat;
                });
                avgHeat = (totalHeat / warZones.size) * 100;
            }
            
            document.getElementById('generation').textContent = generation;
            document.getElementById('totalCells').textContent = total;
            document.getElementById('normalCells').textContent = normal;
            document.getElementById('xenoCells').textContent = xeno;
            document.getElementById('warZones').textContent = warZones.size;
            document.getElementById('avgHeat').textContent = avgHeat.toFixed(1) + '%';
        }
        
        // –°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
        function randomFill() {
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (Math.random() < 0.3) {
                        grid[y][x] = Math.random() < initialXenoChance 
                            ? CELL_TYPE.XENOPHOBIC 
                            : CELL_TYPE.NORMAL;
                    }
                }
            }
            generation = 0;
            updateStats();
            draw();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        function start() {
            if (!isRunning) {
                isRunning = true;
                interval = setInterval(update, speed);
            }
        }
        
        function pause() {
            isRunning = false;
            if (interval) clearInterval(interval);
        }
        
        function clear() {
            pause();
            initGrid();
            generation = 0;
            warZones.clear();
            warZoneData.clear();
            updateStats();
            draw();
        }
        
        // –°–æ–±—ã—Ç–∏—è
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / CELL_SIZE);
            const y = Math.floor((e.clientY - rect.top) / CELL_SIZE);
            
            if (x >= 0 && x < COLS && y >= 0 && y < ROWS) {
                if (grid[y][x] === CELL_TYPE.DEAD) {
                    grid[y][x] = e.shiftKey ? CELL_TYPE.XENOPHOBIC : CELL_TYPE.NORMAL;
                } else {
                    grid[y][x] = CELL_TYPE.DEAD;
                }
                updateStats();
                draw();
            }
        });
        
        document.getElementById('startBtn').addEventListener('click', start);
        document.getElementById('pauseBtn').addEventListener('click', pause);
        document.getElementById('clearBtn').addEventListener('click', clear);
        document.getElementById('randomBtn').addEventListener('click', randomFill);
        
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = speed;
            if (isRunning) {
                pause();
                start();
            }
        });
        
        document.getElementById('xenoChanceSlider').addEventListener('input', (e) => {
            xenoChance = parseInt(e.target.value) / 100;
            document.getElementById('xenoChanceValue').textContent = e.target.value;
        });
        
        document.getElementById('persuasionSlider').addEventListener('input', (e) => {
            persuasionChance = parseInt(e.target.value) / 100;
            document.getElementById('persuasionValue').textContent = e.target.value;
        });
        
        document.getElementById('initialXenoSlider').addEventListener('input', (e) => {
            initialXenoChance = parseInt(e.target.value) / 100;
            document.getElementById('initialXenoValue').textContent = e.target.value;
        });
        
        document.getElementById('hostilitySlider').addEventListener('input', (e) => {
            hostility = parseInt(e.target.value) / 100;
            document.getElementById('hostilityValue').textContent = e.target.value;
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        initGrid();
        draw();
        updateStats();
    </script>
</body>
</html>
