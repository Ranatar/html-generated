<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расширенный граф философских концепций</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #graph {
            width: 100%;
            height: 100%;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: brightness(1.3);
        }

        .node circle {
            stroke-width: 3px;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.4));
        }

        .node.dimmed {
            opacity: 0.2;
        }

        .node.highlighted {
            opacity: 1;
        }

        .node.highlighted circle {
            stroke-width: 5px;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.8));
        }

        .node.selected circle {
            stroke-width: 6px;
            stroke: #ffd700 !important;
            filter: drop-shadow(0 0 15px #ffd700);
        }

        .node text {
            font-size: 10px;
            font-weight: 600;
            pointer-events: none;
            text-shadow: 0 0 4px black, 0 0 4px black, 0 0 4px black;
            fill: #fff;
        }

        .link {
            fill: none;
            stroke-width: 2px;
            opacity: 0.4;
            transition: opacity 0.3s, stroke-width 0.3s;
        }

        .link:hover {
            opacity: 0.9;
            stroke-width: 3.5px;
        }

        .link.dimmed {
            opacity: 0.1;
        }

        .link.highlighted {
            opacity: 1;
            stroke-width: 4px;
            filter: drop-shadow(0 0 5px currentColor);
        }

        .link.bidirectional {
            stroke-dasharray: 5, 5;
        }

        #legend {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.97);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            max-width: 340px;
            backdrop-filter: blur(10px);
            max-height: 85vh;
            overflow-y: auto;
        }
        
        #legend h3 {
            margin: 0 0 15px 0;
            color: #1a1a2e;
            font-size: 19px;
            border-bottom: 3px solid #6c5ce7;
            padding-bottom: 10px;
        }
        
        .legend-section {
            margin-bottom: 18px;
        }
        
        .legend-section h4 {
            margin: 0 0 10px 0;
            color: #2d3436;
            font-size: 13px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Стили для radio buttons */
        .legend-item input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
            width: 16px;
            height: 16px;
            accent-color: #6c5ce7;
        }
        
        .filter-controls {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .filter-controls button {
            flex: 1;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .filter-controls button:hover {
            background: #7f8c8d;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s;
            cursor: pointer;
        }
        
        .legend-item:hover {
            background: rgba(108, 92, 231, 0.1);
        }
        
        .legend-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
            width: 16px;
            height: 16px;
            accent-color: #6c5ce7;
        }
        
        .legend-item label {
            cursor: pointer;
            font-size: 11px;
            color: #2d3436;
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #2d3436;
            flex-shrink: 0;
        }
        
        .legend-line {
            width: 35px;
            height: 2.5px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .filter-stats {
            font-size: 10px;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }
        
        #legend::-webkit-scrollbar {
            width: 6px;
        }
        
        #legend::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        #legend::-webkit-scrollbar-thumb {
            background: #6c5ce7;
            border-radius: 10px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.92);
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
            max-width: 280px;
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 1000;
        }

        .tooltip strong {
            font-size: 15px;
            display: block;
            margin-bottom: 5px;
            color: #a29bfe;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.97);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        #controls button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin: 3px;
            font-size: 12px;
            font-weight: 600;
            transition: background 0.3s;
        }

        #controls button:hover {
            background: #5f4fd1;
        }

        #controls button.active {
            background: #00b894;
        }

        #info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.97);
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 13px;
            color: #2d3436;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-weight: 500;
        }
        
        #detailModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.92);
            color: white;
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            max-width: 550px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 2000;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        #detailModal.show {
            display: block;
        }
        
        #modalOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1999;
        }
        
        #modalOverlay.show {
            display: block;
        }
        
        #detailModal h2 {
            margin: 0 0 8px 0;
            color: #a29bfe;
            font-size: 22px;
            font-weight: 600;
        }
        
        #detailModal .philosopher-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-bottom: 12px;
            opacity: 0.9;
        }
        
        #detailModal .description {
            color: #e0e0e0;
            margin-bottom: 18px;
            line-height: 1.5;
            font-size: 13px;
        }
        
        #detailModal .rubric-section {
            background: rgba(255, 255, 255, 0.08);
            padding: 18px;
            border-radius: 10px;
            border-left: 3px solid #a29bfe;
        }
        
        #detailModal .rubric-title {
            font-size: 15px;
            font-weight: 700;
            color: #a29bfe;
            margin-bottom: 6px;
        }
        
        #detailModal .rubric-description {
            font-size: 12px;
            color: #b0b0b0;
            margin-bottom: 14px;
            font-style: italic;
        }
        
        #detailModal .related-concepts {
            margin-top: 12px;
        }
        
        #detailModal .related-title {
            font-size: 13px;
            font-weight: 700;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        
        #detailModal .concept-item {
            display: flex;
            align-items: center;
            padding: 7px 10px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #detailModal .concept-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
            border-color: rgba(162, 155, 254, 0.4);
        }
        
        #detailModal .concept-color {
            width: 11px;
            height: 11px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
            box-shadow: 0 0 8px currentColor;
        }
        
        #detailModal .concept-name {
            font-size: 13px;
            color: #e0e0e0;
            flex-grow: 1;
        }
        
        #detailModal .concept-philosopher {
            font-size: 10px;
            color: #a0a0a0;
            font-style: italic;
        }
        
        #detailModal .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            transition: all 0.2s;
        }
        
        #detailModal .close-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(90deg);
        }
        
        #detailModal::-webkit-scrollbar {
            width: 6px;
        }
        
        #detailModal::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        #detailModal::-webkit-scrollbar-thumb {
            background: #a29bfe;
            border-radius: 10px;
        }
        
        #detailModal::-webkit-scrollbar-thumb:hover {
            background: #8b7fe6;
        }
        
        /* Панель поиска пути - с возможностью сворачивания */
        #pathFinder {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.97);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            max-width: 320px;
            backdrop-filter: blur(10px);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        #pathFinder.collapsed {
            max-width: 60px;
            padding: 10px;
        }
        
        #pathFinder.collapsed .panel-content {
            display: none;
        }
        
        #pathFinder h3 {
            margin: 0 0 15px 0;
            color: #1a1a2e;
            font-size: 17px;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #pathFinder.collapsed h3 {
            border-bottom: none;
            margin: 0;
            padding: 0;
        }
        
        .path-select-group {
            margin-bottom: 15px;
        }
        
        .path-select-group label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 5px;
        }
        
        .path-select-group select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            font-size: 12px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .path-select-group select:focus {
            outline: none;
            border-color: #e74c3c;
        }
        
        #findPathBtn {
            width: 100%;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: background 0.3s;
            margin-bottom: 10px;
        }
        
        #findPathBtn:hover {
            background: #c0392b;
        }
        
        #pathResult {
            margin-top: 15px;
            padding: 12px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            border-left: 3px solid #e74c3c;
            display: none;
        }
        
        #pathResult.show {
            display: block;
        }
        
        #pathResult .path-length {
            font-size: 12px;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 8px;
        }
        
        #pathResult .path-chain {
            font-size: 11px;
            color: #2d3436;
            line-height: 1.6;
        }
        
        #pathResult .path-node {
            display: inline-block;
            padding: 3px 8px;
            background: white;
            border-radius: 4px;
            margin: 2px;
            border: 1px solid #e74c3c;
        }
        
        #pathResult .path-arrow {
            color: #e74c3c;
            margin: 0 5px;
        }
        
        /* Контейнер для узла пути с философом */
        .path-node-container {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 2px;
            vertical-align: middle;
        }
        
        .path-philosopher {
            font-size: 9px;
            color: #95a5a6;
            font-style: italic;
            margin-bottom: 2px;
            white-space: nowrap;
        }
        
        .path-node {
            display: inline-block;
            padding: 3px 8px;
            background: white;
            border-radius: 4px;
            margin: 0;
            border: 1px solid;
        }
        
        .path-arrow {
            display: inline-flex;
            align-items: center;
            margin: 0 5px;
            font-weight: bold;
            font-size: 14px;
            vertical-align: middle;
        }
        
        .path-arrow.bidirectional {
            font-size: 12px;
        }
        
        /* Панель статистики - с возможностью сворачивания */
        #statsPanel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.97);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            max-width: 320px;
            max-height: 450px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        #statsPanel.collapsed {
            max-width: 60px;
            max-height: 60px;
            padding: 10px;
            overflow: hidden;
        }
        
        #statsPanel.collapsed .panel-content {
            display: none;
        }
        
        #statsPanel h3 {
            margin: 0 0 15px 0;
            color: #1a1a2e;
            font-size: 17px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #statsPanel.collapsed h3 {
            border-bottom: none;
            margin: 0;
            padding: 0;
        }
        
        /* Кнопка сворачивания */
        .collapse-btn {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .collapse-btn:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: scale(1.1);
        }
        
        .collapsed .collapse-btn {
            width: 40px;
            height: 40px;
            font-size: 20px;
        }
        
        .stats-section {
            margin-bottom: 20px;
        }
        
        .stats-section h4 {
            font-size: 13px;
            font-weight: 700;
            color: #2d3436;
            margin: 0 0 10px 0;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            margin: 4px 0;
            background: rgba(52, 152, 219, 0.08);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .stat-item:hover {
            background: rgba(52, 152, 219, 0.18);
            transform: translateX(3px);
        }
        
        .stat-rank {
            font-size: 13px;
            font-weight: 700;
            color: #3498db;
            min-width: 25px;
        }
        
        .stat-name {
            flex-grow: 1;
            font-size: 11px;
            color: #2d3436;
        }
        
        .stat-value {
            font-size: 11px;
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .stat-philosopher {
            font-size: 9px;
            color: #95a5a6;
            font-style: italic;
            margin-left: 5px;
        }
        
        #statsPanel::-webkit-scrollbar {
            width: 6px;
        }
        
        #statsPanel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        #statsPanel::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 10px;
        }
        
        /* Улучшенные связи с весами */
        .link.weight-weak {
            stroke-width: 2px;
        }
        
        .link.weight-medium {
            stroke-width: 3px;
        }
        
        .link.weight-strong {
            stroke-width: 5px;
        }
        
        .link.path-highlight {
            stroke-width: 6px !important;
            opacity: 1 !important;
            filter: drop-shadow(0 0 8px currentColor);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Стили для внутренних противоречий */
        .link.internal-contradiction {
            stroke-dasharray: 8, 4;
            animation: dash 20s linear infinite;
        }
        
        @keyframes dash {
            to {
                stroke-dashoffset: -1000;
            }
        }
        
        /* Легенда весов */
        .weight-legend {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }
        
        .weight-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 10px;
            color: #7f8c8d;
        }
        
        .weight-line {
            height: 2px;
            margin-right: 10px;
            background: #95a5a6;
            flex-shrink: 0;
        }
        
        .weight-line.weak { width: 20px; height: 2px; }
        .weight-line.medium { width: 20px; height: 3px; }
        .weight-line.strong { width: 20px; height: 5px; }
        
        /* Плавная анимация для заголовков при сворачивании */
        .panel-title {
            transition: opacity 0.2s;
        }
        
        .collapsed .panel-title {
            opacity: 0;
            font-size: 0;
            overflow: hidden;
        }
        
        /* Иконка разворачивания для свернутых панелей */
        .collapsed .collapse-btn .expand-icon {
            font-size: 24px;
            font-weight: bold;
        }
        
    </style>
</head>
<body>
    <div id="container">
        <svg id="graph"></svg>
        
        <div id="modalOverlay"></div>
            <div id="detailModal">
                <button class="close-btn" onclick="closeDetailModal()">×</button>
                <div id="modalContent"></div>
            </div>
        
        <div id="legend">
            <h3>🔍 Фильтры и легенда</h3>
            
            <div class="legend-section">
                <h4>
                    <span>Философы:</span>
                </h4>
                <div class="filter-controls">
                    <button onclick="selectAllPhilosophers()">Все</button>
                    <button onclick="deselectAllPhilosophers()">Сбросить</button>
                </div>
                <div id="philosopherFilters"></div>
            </div>
        
            <div class="legend-section">
                <h4>
                    <span>Режим фильтрации:</span>
                </h4>
                <div class="legend-item">
                    <input type="radio" id="filterAll" name="filterMode" value="all" checked onchange="changeFilterMode('all')">
                    <label for="filterAll" style="font-size: 11px;">
                        <span>Только выбранные философы</span>
                    </label>
                </div>
                <div class="legend-item">
                    <input type="radio" id="filterInternal" name="filterMode" value="internal" onchange="changeFilterMode('internal')">
                    <label for="filterInternal" style="font-size: 11px;">
                        <span>Только внутренние связи</span>
                    </label>
                </div>
                <div class="legend-item">
                    <input type="radio" id="filterContext" name="filterMode" value="context" onchange="changeFilterMode('context')">
                    <label for="filterContext" style="font-size: 11px;">
                        <span>С соседними узлами</span>
                    </label>
                </div>
                <div style="font-size: 10px; color: #7f8c8d; margin-top: 8px; padding: 8px; background: rgba(108, 92, 231, 0.05); border-radius: 5px; line-height: 1.4;">
                    <strong>Режимы:</strong><br>
                    • <em>Только выбранные</em> - узлы и связи между ними<br>
                    • <em>Только внутренние</em> - связи внутри систем<br>
                    • <em>С соседними</em> - включая связанные узлы других философов
                </div>
            </div>
        
            <div class="legend-section">
                <h4>
                    <span>Типы связей:</span>
                </h4>
                <div class="filter-controls">
                    <button onclick="selectAllRelations()">Все</button>
                    <button onclick="deselectAllRelations()">Сбросить</button>
                </div>
                <div id="relationFilters"></div>
                <div class="weight-legend">
                    <div class="weight-item">
                        <div class="weight-line weak"></div>
                        <span>Слабое влияние</span>
                    </div>
                    <div class="weight-item">
                        <div class="weight-line medium"></div>
                        <span>Среднее влияние</span>
                    </div>
                    <div class="weight-item">
                        <div class="weight-line strong"></div>
                        <span>Сильное влияние</span>
                    </div>
                </div>
            </div>
        
            <div class="filter-stats" id="filterStats">
                Показано: все концепции и связи
            </div>
        </div>
        
        <!-- Панель поиска пути -->
        <div id="pathFinder">
            <h3>
                <span class="panel-title">🔍 Путь между концепциями</span>
                <button class="collapse-btn" onclick="togglePanel('pathFinder')" title="Свернуть/Развернуть">
                    <span class="expand-icon">−</span>
                </button>
            </h3>
            <div class="panel-content">
                <div class="path-select-group">
                    <label for="sourceSelect">От концепции:</label>
                    <select id="sourceSelect">
                        <option value="">Выберите концепцию...</option>
                    </select>
                </div>
                <div class="path-select-group">
                    <label for="targetSelect">К концепции:</label>
                    <select id="targetSelect">
                        <option value="">Выберите концепцию...</option>
                    </select>
                </div>
                <button id="findPathBtn" onclick="findAndShowPath()">Найти путь</button>
                
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #dfe6e9;">
                    <div style="font-size: 11px; margin-bottom: 8px;">
                        <label style="display: flex; align-items: center; margin-bottom: 5px; cursor: pointer;">
                            <input type="checkbox" id="respectChronology" checked style="margin-right: 8px;">
                            <span>Учитывать хронологию</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="respectDirection" checked style="margin-right: 8px;">
                            <span>Учитывать направленность связей</span>
                        </label>
                    </div>
                </div>
                
                <div id="pathResult"></div>
            </div>
        </div>
        
        <!-- Панель статистики -->
        <div id="statsPanel">
            <h3>
                <span class="panel-title">📊 Аналитика графа</span>
                <button class="collapse-btn" onclick="togglePanel('statsPanel')" title="Свернуть/Развернуть">
                    <span class="expand-icon">−</span>
                </button>
            </h3>
            <div class="panel-content">
                <div class="stats-section">
                    <h4>Самые влиятельные концепции:</h4>
                    <div id="topConcepts"></div>
                </div>
                <div class="stats-section">
                    <h4>Узлы-мосты (betweenness):</h4>
                    <div id="bridgeNodes"></div>
                </div>
            </div>
        </div>

        <div id="controls">
            <button onclick="resetSimulation()">🔄 Перезапустить</button>
            <button onclick="centerGraph()">🎯 Центрировать</button>
            <button id="groupBtn" onclick="toggleGrouping()">📦 Группировать</button>
            <div id="exportButtons">
                <button onclick="exportToPNG()">💾 PNG</button>
                <button onclick="exportToSVG()">💾 SVG</button>
            </div>
        </div>

        <div id="info">
            💡 Клик - подсветка • Ctrl+клик - множественный выбор • Двойной клик - детали • Перетаскивайте • Колесо - масштаб
        </div>

        <div class="tooltip" id="tooltip"></div>
    </div>

    <script>
        // ============================================
        // 1. ФИЛОСОФЫ (единый источник истины)
        // ============================================
        const philosophers = [
            { id: "socrates", name: "Сократ", nameRu: "Сократ", color: "#e74c3c", birth: -469, death: -399, years: "469-399 до н.э." },
            { id: "plato", name: "Платон", nameRu: "Платон", color: "#c0392b", birth: -428, death: -348, years: "428-348 до н.э." },
            { id: "aristotle", name: "Аристотель", nameRu: "Аристотель", color: "#3498db", birth: -384, death: -322, years: "384-322 до н.э." },
            { id: "plotinus", name: "Плотин", nameRu: "Плотин", color: "#9b59b6", birth: 204, death: 270, years: "204-270" },
            { id: "augustine", name: "Августин", nameRu: "Августин", color: "#8e44ad", birth: 354, death: 430, years: "354-430" },
            { id: "aquinas", name: "Фома Аквинский", nameRu: "Фома Аквинский", color: "#9b59b6", birth: 1225, death: 1274, years: "1225-1274" },
            { id: "descartes", name: "Декарт", nameRu: "Декарт", color: "#2ecc71", birth: 1596, death: 1650, years: "1596-1650" },
            { id: "locke", name: "Локк", nameRu: "Локк", color: "#1abc9c", birth: 1632, death: 1704, years: "1632-1704" },
            { id: "spinoza", name: "Спиноза", nameRu: "Спиноза", color: "#27ae60", birth: 1632, death: 1677, years: "1632-1677" },
            { id: "leibniz", name: "Лейбниц", nameRu: "Лейбниц", color: "#16a085", birth: 1646, death: 1716, years: "1646-1716" },
            { id: "berkeley", name: "Беркли", nameRu: "Беркли", color: "#16a085", birth: 1685, death: 1753, years: "1685-1753" },
            { id: "hume", name: "Юм", nameRu: "Юм", color: "#1abc9c", birth: 1711, death: 1776, years: "1711-1776" },
            { id: "kant", name: "Кант", nameRu: "Кант", color: "#f39c12", birth: 1724, death: 1804, years: "1724-1804" },
            { id: "fichte", name: "Фихте", nameRu: "Фихте", color: "#d35400", birth: 1762, death: 1814, years: "1762-1814" },
            { id: "hegel", name: "Гегель", nameRu: "Гегель", color: "#e67e22", birth: 1770, death: 1831, years: "1770-1831" },
            { id: "schopenhauer", name: "Шопенгауэр", nameRu: "Шопенгауэр", color: "#95a5a6", birth: 1788, death: 1860, years: "1788-1860" },
            { id: "kierkegaard", name: "Кьеркегор", nameRu: "Кьеркегор", color: "#7f8c8d", birth: 1813, death: 1855, years: "1813-1855" },
            { id: "marx", name: "Маркс", nameRu: "Маркс", color: "#c0392b", birth: 1818, death: 1883, years: "1818-1883" },
            { id: "nietzsche", name: "Ницше", nameRu: "Ницше", color: "#2c3e50", birth: 1844, death: 1900, years: "1844-1900" },
            { id: "husserl", name: "Гуссерль", nameRu: "Гуссерль", color: "#34495e", birth: 1859, death: 1938, years: "1859-1938" },
            { id: "heidegger", name: "Хайдеггер", nameRu: "Хайдеггер", color: "#e67e22", birth: 1889, death: 1976, years: "1889-1976" },
            { id: "wittgenstein", name: "Витгенштейн", nameRu: "Витгенштейн", color: "#2980b9", birth: 1889, death: 1951, years: "1889-1951" },
            { id: "sartre", name: "Сартр", nameRu: "Сартр", color: "#8e44ad", birth: 1905, death: 1980, years: "1905-1980" },
            { id: "deleuze", name: "Делёз", nameRu: "Делёз", color: "#27ae60", birth: 1925, death: 1995, years: "1925-1995" },
            { id: "foucault", name: "Фуко", nameRu: "Фуко", color: "#16a085", birth: 1926, death: 1984, years: "1926-1984" }
        ];
        
        // ============================================
        // 2. РУБРИКИ (тематические категории)
        // ============================================
        const rubrics = [
            {
                id: "being",
                name: "Бытие/Существование",
                description: "Фундаментальные вопросы о природе реальности и существования"
            },
            {
                id: "freedom",
                name: "Свобода",
                description: "Природа человеческой свободы и её ограничений"
            },
            {
                id: "knowledge",
                name: "Истина/Познание",
                description: "Вопросы познания, истины и её критериев"
            },
            {
                id: "consciousness",
                name: "Субъект/Сознание/Я",
                description: "Природа сознания, самосознания и субъективности"
            },
            {
                id: "matter",
                name: "Тело/Материя",
                description: "Материальное измерение реальности"
            },
            {
                id: "time",
                name: "Время",
                description: "Природа времени и темпоральности"
            },
            {
                id: "ethics",
                name: "Мораль/Этика",
                description: "Вопросы добра, зла и правильного действия"
            },
            {
                id: "politics",
                name: "Власть/Политика",
                description: "Социальные и политические отношения"
            },
            {
                id: "language",
                name: "Язык",
                description: "Роль языка в познании и коммуникации"
            },
            {
                id: "absolute",
                name: "Бог/Абсолют",
                description: "Божественное, абсолютное и метафизическое"
            },
            {
                id: "dialectics",
                name: "Диалектика/Процесс",
                description: "Динамика развития и преобразования"
            },
            {
                id: "will",
                name: "Воля/Желание",
                description: "Волевое и желающее измерение существования"
            },
            {
                id: "method",
                name: "Метод",
                description: "Философские методы и подходы"
            }
        ];
        
        // ============================================
        // 3. ТИПЫ СВЯЗЕЙ
        // ============================================
        const relationTypes = [
            { id: "oppose", label: "противопоставление", color: "#e74c3c" },
            { id: "ground", label: "обосновывает", color: "#3498db" },
            { id: "develop", label: "развивает", color: "#2ecc71" },
            { id: "critique", label: "критикует", color: "#f39c12" },
            { id: "synthesize", label: "синтезирует", color: "#9b59b6" },
            { id: "influence", label: "влияет", color: "#1abc9c" },
            { id: "dialogue", label: "диалог", color: "#95a5a6" },
            { id: "internal_contradiction", label: "внутреннее противоречие", color: "#e74c3c" }
        ];
        
        // ============================================
        // 4. КОНЦЕПЦИИ
        // ============================================
        const concepts = [
            // СОКРАТ
            { id: "maieutics", label: "Майевтика", philosopher: "socrates", rubrics: ["knowledge", "method"], description: "Метод извлечения знания через вопросы" },
            { id: "know_nothing", label: "Знаю, что ничего не знаю", philosopher: "socrates", rubrics: ["knowledge"], description: "Осознание границ собственного знания" },
            { id: "virtue_knowledge", label: "Добродетель = знание", philosopher: "socrates", rubrics: ["ethics", "knowledge"], description: "Единство морали и познания" },
            { id: "daimonion", label: "Даймоний", philosopher: "socrates", rubrics: ["consciousness"], description: "Внутренний голос совести" },
            { id: "care_soul", label: "Забота о душе", philosopher: "socrates", rubrics: ["ethics"], description: "Приоритет духовного развития" },
            { id: "soul", label: "Душа", philosopher: "socrates", rubrics: ["consciousness"], description: "Бессмертная сущность человека, объект заботы" },
            
            // ПЛАТОН
            { id: "ideas", label: "Мир идей", philosopher: "plato", rubrics: ["knowledge"], description: "Вечный мир совершенных форм" },
            { id: "eidos", label: "Эйдос", philosopher: "plato", rubrics: ["knowledge"], description: "Идеальная сущность вещи" },
            { id: "anamnesis", label: "Анамнесис", philosopher: "plato", rubrics: ["knowledge"], description: "Воспоминание души об идеях" },
            { id: "demiurge", label: "Демиург", philosopher: "plato", rubrics: ["absolute"], description: "Творец материального мира" },
            { id: "cave", label: "Миф о пещере", philosopher: "plato", rubrics: ["knowledge"], description: "Аллегория познания истины" },
            { id: "ideal_state", label: "Идеальное государство", philosopher: "plato", rubrics: ["politics"], description: "Справедливое политическое устройство" },
            { id: "tripartite_soul", label: "Трёхчастная душа", philosopher: "plato", rubrics: ["consciousness"], description: "Разум, воля, чувства" },
            { id: "good", label: "Благо", philosopher: "plato", rubrics: ["absolute"], description: "Высшая идея, источник бытия и познания" },
            { id: "eros", label: "Эрос", philosopher: "plato", rubrics: ["knowledge"], description: "Любовное восхождение к прекрасному и истине" },
            { id: "methexis", label: "Метексис", philosopher: "plato", rubrics: ["being"], description: "Участие вещей в идеях, связь между мирами" },
            { id: "mimesis", label: "Мимесис", philosopher: "plato", rubrics: ["being"], description: "Подражание, копирование идей" },
            { id: "chora", label: "Хора", philosopher: "plato", rubrics: ["being"], description: "Пространство-вместилище, восприемница становления" },
            
            // АРИСТОТЕЛЬ
            { id: "form", label: "Форма", philosopher: "aristotle", rubrics: ["being"], description: "Активное начало, определяющее вещь" },
            { id: "matter_ar", label: "Материя", philosopher: "aristotle", rubrics: ["being", "matter"], description: "Пассивное начало, субстрат" },
            { id: "entelechy", label: "Энтелехия", philosopher: "aristotle", rubrics: ["being"], description: "Внутренняя цель, осуществление" },
            { id: "four_causes", label: "Четыре причины", philosopher: "aristotle", rubrics: ["being"], description: "Материальная, формальная, движущая, целевая" },
            { id: "unmoved_mover", label: "Перводвигатель", philosopher: "aristotle", rubrics: ["absolute"], description: "Неподвижный источник движения" },
            { id: "golden_mean", label: "Золотая середина", philosopher: "aristotle", rubrics: ["ethics"], description: "Этический принцип умеренности" },
            { id: "categories", label: "Категории", philosopher: "aristotle", rubrics: ["being"], description: "Основные роды бытия" },
            { id: "act_potency", label: "Акт и потенция", philosopher: "aristotle", rubrics: ["being"], description: "Энергия и возможность: фундаментальная пара бытия" },
            { id: "phronesis", label: "Phronesis", philosopher: "aristotle", rubrics: ["ethics"], description: "Практическая мудрость, благоразумие" },
            { id: "eudaimonia", label: "Eudaimonia", philosopher: "aristotle", rubrics: ["ethics"], description: "Благоденствие, счастье как цель жизни" },
            { id: "logos", label: "Логос", philosopher: "aristotle", rubrics: ["being"], description: "Разумное начало, слово, принцип" },
            
            // ПЛОТИН
            { id: "the_one", label: "Единое", philosopher: "plotinus", rubrics: ["being", "absolute"], description: "То Эн - запредельное начало всего" },
            { id: "emanation", label: "Эманация", philosopher: "plotinus", rubrics: ["being"], description: "Истечение бытия из Единого" },
            { id: "nous", label: "Ум", philosopher: "plotinus", rubrics: ["being"], description: "Нус - первая ипостась, мир идей" },
            { id: "world_soul", label: "Мировая душа", philosopher: "plotinus", rubrics: ["being"], description: "Вторая ипостась, душа космоса" },
            { id: "henosis", label: "Генозис", philosopher: "plotinus", rubrics: ["absolute"], description: "Мистическое единение с Единым" },
            { id: "matter_plotinus", label: "Материя", philosopher: "plotinus", rubrics: ["being"], description: "Абсолютное не-бытие, зло" },
            { id: "contemplation", label: "Созерцание", philosopher: "plotinus", rubrics: ["knowledge", "method"], description: "Теория - путь восхождения души" },
            
            // АВГУСТИН
            { id: "grace", label: "Благодать", philosopher: "augustine", rubrics: ["absolute", "ethics"], description: "Божественная милость к человеку" },
            { id: "original_sin", label: "Первородный грех", philosopher: "augustine", rubrics: ["ethics"], description: "Наследственная греховность" },
            { id: "two_cities", label: "Два града", philosopher: "augustine", rubrics: ["politics"], description: "Град Божий и град земной" },
            { id: "time_augustine", label: "Время", philosopher: "augustine", rubrics: ["time"], description: "Растяжение души" },
            { id: "confession", label: "Исповедь", philosopher: "augustine", rubrics: ["consciousness"], description: "Путь к Богу через самопознание" },
            { id: "faith_reason", label: "Вера и разум", philosopher: "augustine", rubrics: ["knowledge", "absolute"], description: "Верю, чтобы понимать" },
            
            // ФОМА АКВИНСКИЙ
            { id: "essence_existence", label: "Сущность и существование", philosopher: "aquinas", rubrics: ["being"], description: "Различение эссенции и экзистенции" },
            { id: "five_ways", label: "Пять путей", philosopher: "aquinas", rubrics: ["absolute"], description: "Доказательства бытия Бога" },
            { id: "natural_law", label: "Естественный закон", philosopher: "aquinas", rubrics: ["ethics"], description: "Рациональная основа морали" },
            { id: "analogy", label: "Аналогия бытия", philosopher: "aquinas", rubrics: ["absolute"], description: "Подобие между Богом и творением" },
            { id: "thomistic_synthesis", label: "Синтез Аристотеля", philosopher: "aquinas", rubrics: ["knowledge"], description: "Христианизация философии Аристотеля" },
            { id: "accidents", label: "Акциденции", philosopher: "aquinas", rubrics: ["being"], description: "Несущественные свойства субстанции" },
            { id: "actual_being", label: "Актуальное бытие", philosopher: "aquinas", rubrics: ["being"], description: "Реализованное существование" },
            { id: "participatio", label: "Participatio", philosopher: "aquinas", rubrics: ["being"], description: "Участие творения в божественном бытии" },
            
            // ДЕКАРТ
            { id: "cogito", label: "Cogito ergo sum", philosopher: "descartes", rubrics: ["consciousness"], description: "Я мыслю, следовательно существую" },
            { id: "dualism", label: "Дуализм", philosopher: "descartes", rubrics: ["being"], description: "Разделение мышления и протяжения" },
            { id: "res_cogitans", label: "Res cogitans", philosopher: "descartes", rubrics: ["consciousness"], description: "Мыслящая субстанция" },
            { id: "res_extensa", label: "Res extensa", philosopher: "descartes", rubrics: ["matter"], description: "Протяженная субстанция" },
            { id: "method", label: "Метод сомнения", philosopher: "descartes", rubrics: ["method"], description: "Радикальный скептицизм как путь к истине" },
            { id: "clear_distinct", label: "Ясные и отчётливые идеи", philosopher: "descartes", rubrics: ["knowledge"], description: "Критерий истинности" },
            { id: "innate_ideas", label: "Врождённые идеи", philosopher: "descartes", rubrics: ["knowledge"], description: "Априорное знание" },
            
            // ЛОКК
            { id: "tabula_rasa", label: "Tabula rasa", philosopher: "locke", rubrics: ["knowledge"], description: "Чистая доска - нет врожденных идей" },
            { id: "simple_ideas", label: "Простые идеи", philosopher: "locke", rubrics: ["knowledge"], description: "Элементарные чувственные данные" },
            { id: "complex_ideas", label: "Сложные идеи", philosopher: "locke", rubrics: ["knowledge"], description: "Комбинации простых идей" },
            { id: "primary_qualities", label: "Первичные качества", philosopher: "locke", rubrics: ["knowledge"], description: "Объективные свойства тел" },
            { id: "secondary_qualities", label: "Вторичные качества", philosopher: "locke", rubrics: ["knowledge"], description: "Субъективные ощущения" },
            { id: "substance_locke", label: "Субстанция", philosopher: "locke", rubrics: ["being"], description: "Неизвестный носитель качеств" },
            { id: "personal_identity", label: "Личная идентичность", philosopher: "locke", rubrics: ["consciousness"], description: "Тождество через память" },
            { id: "property_theory", label: "Теория собственности", philosopher: "locke", rubrics: ["politics"], description: "Труд как основание собственности" },
            
            // СПИНОЗА
            { id: "substance_spinoza", label: "Субстанция", philosopher: "spinoza", rubrics: ["being", "absolute"], description: "Бог или природа (Deus sive Natura)" },
            { id: "modes", label: "Модусы", philosopher: "spinoza", rubrics: ["being"], description: "Проявления единой субстанции" },
            { id: "attributes", label: "Атрибуты", philosopher: "spinoza", rubrics: ["matter"], description: "Мышление и протяжение" },
            { id: "conatus", label: "Conatus", philosopher: "spinoza", rubrics: ["will"], description: "Стремление к самосохранению" },
            { id: "intellectual_love", label: "Интеллектуальная любовь", philosopher: "spinoza", rubrics: ["absolute"], description: "Amor Dei intellectualis" },
            { id: "determinism", label: "Детерминизм", philosopher: "spinoza", rubrics: ["freedom"], description: "Необходимость всего существующего" },
            { id: "natura_naturans", label: "Natura naturans", philosopher: "spinoza", rubrics: ["absolute"], description: "Природа творящая, Бог как активная причина" },
            { id: "natura_naturata", label: "Natura naturata", philosopher: "spinoza", rubrics: ["being"], description: "Природа сотворённая, следствия субстанции" },
            { id: "adequate_ideas", label: "Адекватные идеи", philosopher: "spinoza", rubrics: ["knowledge"], description: "Истинное, полное познание" },
            
            // ЛЕЙБНИЦ
            { id: "monads", label: "Монады", philosopher: "leibniz", rubrics: ["being"], description: "Простые неделимые субстанции" },
            { id: "preestablished", label: "Предустановленная гармония", philosopher: "leibniz", rubrics: ["being"], description: "Согласованность монад" },
            { id: "best_worlds", label: "Лучший из миров", philosopher: "leibniz", rubrics: ["absolute"], description: "Теодицея" },
            { id: "petites_perceptions", label: "Малые перцепции", philosopher: "leibniz", rubrics: ["consciousness"], description: "Бессознательные восприятия" },
            { id: "sufficient_reason", label: "Достаточное основание", philosopher: "leibniz", rubrics: ["being"], description: "Принцип рациональности" },
            { id: "apperception", label: "Апперцепция", philosopher: "leibniz", rubrics: ["consciousness"], description: "Осознанное восприятие, рефлексивное сознание" },
            { id: "continuity", label: "Принцип непрерывности", philosopher: "leibniz", rubrics: ["being"], description: "Natura non facit saltus - природа не делает скачков" },
            
            // БЕРКЛИ
            { id: "esse_percipi", label: "Esse est percipi", philosopher: "berkeley", rubrics: ["being"], description: "Быть - значит быть воспринимаемым" },
            { id: "immaterialism", label: "Имматериализм", philosopher: "berkeley", rubrics: ["being"], description: "Отрицание материальной субстанции" },
            { id: "god_perceiver", label: "Бог как воспринимающий", philosopher: "berkeley", rubrics: ["absolute"], description: "Бог гарантирует существование мира" },
            { id: "ideas_berkeley", label: "Идеи", philosopher: "berkeley", rubrics: ["knowledge"], description: "Единственная реальность - идеи в уме" },
            
            // ЮМ
            { id: "impressions", label: "Впечатления", philosopher: "hume", rubrics: ["knowledge"], description: "Первичные чувственные данные" },
            { id: "ideas_hume", label: "Идеи", philosopher: "hume", rubrics: ["knowledge"], description: "Копии впечатлений" },
            { id: "causality_critique", label: "Критика причинности", philosopher: "hume", rubrics: ["knowledge"], description: "Привычка, не необходимость" },
            { id: "bundle_theory", label: "Теория пучка", philosopher: "hume", rubrics: ["consciousness"], description: "Я как связка восприятий" },
            { id: "is_ought", label: "Гильотина Юма", philosopher: "hume", rubrics: ["ethics"], description: "Разрыв между сущим и должным" },
            { id: "custom", label: "Привычка", philosopher: "hume", rubrics: ["knowledge"], description: "Основа веры и ожиданий" },
            
            // КАНТ
            { id: "thing_itself", label: "Вещь в себе", philosopher: "kant", rubrics: ["being"], description: "Непознаваемая сущность" },
            { id: "phenomenon", label: "Феномен", philosopher: "kant", rubrics: ["being"], description: "Явление для нас" },
            { id: "categorical", label: "Категорический императив", philosopher: "kant", rubrics: ["ethics"], description: "Безусловный моральный закон" },
            { id: "apriori", label: "Априорные формы", philosopher: "kant", rubrics: ["knowledge"], description: "Врожденные структуры познания" },
            { id: "synthetic_apriori", label: "Синтетические априори", philosopher: "kant", rubrics: ["knowledge"], description: "Расширяющие априорные суждения" },
            { id: "transcendental", label: "Трансцендентальное", philosopher: "kant", rubrics: ["knowledge"], description: "Условия возможности опыта" },
            { id: "autonomy", label: "Автономия воли", philosopher: "kant", rubrics: ["freedom"], description: "Самозаконодательство разума" },
            { id: "antinomies", label: "Антиномии", philosopher: "kant", rubrics: ["knowledge"], description: "Противоречия чистого разума при выходе за опыт" },
            { id: "sublime", label: "Возвышенное", philosopher: "kant", rubrics: ["ethics"], description: "Эстетическая категория безграничного" },
            { id: "postulates", label: "Постулаты практического разума", philosopher: "kant", rubrics: ["absolute"], description: "Бог, бессмертие души, свобода воли" },
            { id: "aesthetic_judgment", label: "Эстетическое суждение", philosopher: "kant", rubrics: ["knowledge"], description: "Суждение вкуса, незаинтересованное удовольствие" },
            
            // ФИХТЕ
            { id: "absolute_ego", label: "Абсолютное Я", philosopher: "fichte", rubrics: ["consciousness"], description: "Самополагающее сознание" },
            { id: "non_ego", label: "Не-Я", philosopher: "fichte", rubrics: ["being"], description: "Противоположность Я" },
            { id: "tathandlung", label: "Татхандлунг", philosopher: "fichte", rubrics: ["consciousness"], description: "Действие-поступок Я" },
            { id: "striving", label: "Стремление", philosopher: "fichte", rubrics: ["freedom"], description: "Бесконечная активность Я" },
            { id: "practical_primacy", label: "Примат практического", philosopher: "fichte", rubrics: ["ethics"], description: "Приоритет действия над познанием" },
            { id: "imagination", label: "Продуктивное воображение", philosopher: "fichte", rubrics: ["consciousness"], description: "Einbildungskraft - синтезирующая способность Я" },
            { id: "wissenschaftslehre", label: "Наукоучение", philosopher: "fichte", rubrics: ["method"], description: "Система философии как строгая наука" },
            
            // ГЕГЕЛЬ
            { id: "absolute_idea", label: "Абсолютная идея", philosopher: "hegel", rubrics: ["absolute"], description: "Саморазвивающийся мировой дух" },
            { id: "dialectic", label: "Диалектика", philosopher: "hegel", rubrics: ["dialectics"], description: "Тезис-антитезис-синтез" },
            { id: "weltgeist", label: "Weltgeist", philosopher: "hegel", rubrics: ["absolute"], description: "Мировой дух в истории" },
            { id: "aufhebung", label: "Aufhebung", philosopher: "hegel", rubrics: ["dialectics"], description: "Снятие противоречий" },
            { id: "master_slave", label: "Господин и раб", philosopher: "hegel", rubrics: ["dialectics"], description: "Диалектика признания" },
            { id: "objective_spirit", label: "Объективный дух", philosopher: "hegel", rubrics: ["politics"], description: "Дух в социальных институтах" },
            { id: "cunning_reason", label: "Хитрость разума", philosopher: "hegel", rubrics: ["dialectics"], description: "Самореализация духа через историю" },
            { id: "entfremdung", label: "Entfremdung", philosopher: "hegel", rubrics: ["dialectics"], description: "Отчуждение как необходимый момент развития духа" },
            { id: "negative", label: "Негативное", philosopher: "hegel", rubrics: ["dialectics"], description: "Движущая сила диалектики, отрицание" },
            { id: "concrete", label: "Конкретное", philosopher: "hegel", rubrics: ["being"], description: "Единство многообразных определений" },
            { id: "abstract", label: "Абстрактное", philosopher: "hegel", rubrics: ["being"], description: "Одностороннее, неполное определение" },
            
            // ШОПЕНГАУЭР
            { id: "will_schop", label: "Мировая воля", philosopher: "schopenhauer", rubrics: ["will"], description: "Слепая иррациональная сила" },
            { id: "representation", label: "Представление", philosopher: "schopenhauer", rubrics: ["matter"], description: "Мир как иллюзия" },
            { id: "suffering", label: "Страдание", philosopher: "schopenhauer", rubrics: ["ethics"], description: "Сущность жизни" },
            { id: "denial_will", label: "Отрицание воли", philosopher: "schopenhauer", rubrics: ["freedom"], description: "Путь к освобождению" },
            { id: "aesthetics_schop", label: "Эстетическое созерцание", philosopher: "schopenhauer", rubrics: ["ethics"], description: "Временное освобождение от воли" },
            { id: "compassion", label: "Сострадание", philosopher: "schopenhauer", rubrics: ["ethics"], description: "Основа морали" },
            { id: "individuation", label: "Principium individuationis", philosopher: "schopenhauer", rubrics: ["being"], description: "Принцип индивидуации, источник множественности" },
            
            // КЬЕРКЕГОР
            { id: "stages_existence", label: "Стадии существования", philosopher: "kierkegaard", rubrics: ["being"], description: "Эстетическая, этическая, религиозная" },
            { id: "leap_faith", label: "Прыжок веры", philosopher: "kierkegaard", rubrics: ["freedom"], description: "Иррациональное решение" },
            { id: "anxiety", label: "Тревога", philosopher: "kierkegaard", rubrics: ["freedom"], description: "Головокружение свободы" },
            { id: "despair", label: "Отчаяние", philosopher: "kierkegaard", rubrics: ["consciousness"], description: "Болезнь к смерти" },
            { id: "individual", label: "Единичный", philosopher: "kierkegaard", rubrics: ["consciousness"], description: "Противостояние толпе" },
            { id: "subjective_truth", label: "Субъективная истина", philosopher: "kierkegaard", rubrics: ["knowledge"], description: "Истина как страсть" },
            { id: "repetition", label: "Повторение", philosopher: "kierkegaard", rubrics: ["time"], description: "Экзистенциальное возвращение, обретение себя" },
            { id: "moment", label: "Мгновение", philosopher: "kierkegaard", rubrics: ["time"], description: "Atom вечности, встреча времени и вечного" },
            
            // МАРКС
            { id: "praxis", label: "Праксис", philosopher: "marx", rubrics: ["politics"], description: "Революционная практика" },
            { id: "alienation", label: "Отчуждение", philosopher: "marx", rubrics: ["politics"], description: "Отчуждение труда" },
            { id: "base_superstructure", label: "Базис и надстройка", philosopher: "marx", rubrics: ["politics"], description: "Экономика и идеология" },
            { id: "class_struggle", label: "Классовая борьба", philosopher: "marx", rubrics: ["politics"], description: "Двигатель истории" },
            { id: "commodity_fetish", label: "Товарный фетишизм", philosopher: "marx", rubrics: ["politics"], description: "Овеществление социальных отношений" },
            { id: "historical_materialism", label: "Исторический материализм", philosopher: "marx", rubrics: ["politics"], description: "Материалистическое понимание истории" },
            { id: "ideology", label: "Идеология", philosopher: "marx", rubrics: ["politics", "knowledge"], description: "Ложное сознание, маскирующее классовые интересы" },
            
            // НИЦШЕ
            { id: "will_power", label: "Воля к власти", philosopher: "nietzsche", rubrics: ["will"], description: "Фундаментальная жизненная сила" },
            { id: "ubermensch", label: "Сверхчеловек", philosopher: "nietzsche", rubrics: ["ethics"], description: "Преодолевший себя человек" },
            { id: "eternal_return", label: "Вечное возвращение", philosopher: "nietzsche", rubrics: ["time"], description: "Циклическое повторение бытия" },
            { id: "god_dead", label: "Смерть Бога", philosopher: "nietzsche", rubrics: ["absolute"], description: "Конец метафизических абсолютов" },
            { id: "perspectivism", label: "Перспективизм", philosopher: "nietzsche", rubrics: ["knowledge"], description: "Множественность интерпретаций" },
            { id: "master_morality", label: "Мораль господ", philosopher: "nietzsche", rubrics: ["ethics"], description: "Аристократическая этика" },
            { id: "slave_morality", label: "Мораль рабов", philosopher: "nietzsche", rubrics: ["ethics"], description: "Ресентимент слабых" },
            { id: "dionysian", label: "Дионисийское", philosopher: "nietzsche", rubrics: ["will"], description: "Хаос, опьянение, жизненная стихия" },
            { id: "apollonian", label: "Аполлоническое", philosopher: "nietzsche", rubrics: ["will"], description: "Порядок, мера, индивидуация" },
            { id: "ressentiment", label: "Ресентимент", philosopher: "nietzsche", rubrics: ["ethics"], description: "Злоба бессильных, основа морали рабов" },
            
            // ГУССЕРЛЬ
            { id: "intentionality", label: "Интенциональность", philosopher: "husserl", rubrics: ["consciousness"], description: "Направленность сознания" },
            { id: "epoché", label: "Эпохе", philosopher: "husserl", rubrics: ["method"], description: "Феноменологическая редукция" },
            { id: "lifeworld", label: "Жизненный мир", philosopher: "husserl", rubrics: ["being"], description: "Дорефлективный опыт" },
            { id: "transcendental_ego", label: "Трансцендентальное Я", philosopher: "husserl", rubrics: ["consciousness"], description: "Чистое сознание" },
            { id: "eidetic", label: "Эйдетическая интуиция", philosopher: "husserl", rubrics: ["knowledge"], description: "Усмотрение сущностей" },
            { id: "noesis_noema", label: "Ноэзис-ноэма", philosopher: "husserl", rubrics: ["consciousness"], description: "Акт сознания и его предметное содержание" },
            { id: "constitution", label: "Конституирование", philosopher: "husserl", rubrics: ["consciousness"], description: "Созидание смысла сознанием" },
            { id: "intersubjectivity", label: "Интерсубъективность", philosopher: "husserl", rubrics: ["consciousness"], description: "Общность опыта субъектов" },
            
            // ХАЙДЕГГЕР
            { id: "dasein", label: "Dasein", philosopher: "heidegger", rubrics: ["being"], description: "Человеческое бытие-в-мире" },
            { id: "sein", label: "Sein", philosopher: "heidegger", rubrics: ["being"], description: "Бытие как таковое" },
            { id: "geworfenheit", label: "Geworfenheit", philosopher: "heidegger", rubrics: ["being"], description: "Заброшенность в мир" },
            { id: "sorge", label: "Sorge", philosopher: "heidegger", rubrics: ["being"], description: "Забота как основа бытия" },
            { id: "sein_zum_tode", label: "Sein-zum-Tode", philosopher: "heidegger", rubrics: ["time"], description: "Бытие-к-смерти" },
            { id: "aletheia", label: "Aletheia", philosopher: "heidegger", rubrics: ["knowledge"], description: "Истина как несокрытость" },
            { id: "dwelling", label: "Обитание", philosopher: "heidegger", rubrics: ["being"], description: "Аутентичное пребывание" },
            { id: "das_man", label: "Das Man", philosopher: "heidegger", rubrics: ["being", "consciousness"], description: "Безличное 'они', неподлинное существование" },
            { id: "ereignis", label: "Ereignis", philosopher: "heidegger", rubrics: ["being"], description: "Со-бытие, событие присвоения бытия" },
            { id: "geviert", label: "Четверица", philosopher: "heidegger", rubrics: ["being"], description: "Das Geviert: земля, небо, божества, смертные" },
            { id: "kehre", label: "Поворот", philosopher: "heidegger", rubrics: ["being"], description: "Die Kehre - поворот в мышлении бытия" },
            
            // ВИТГЕНШТЕЙН
            { id: "language_game", label: "Языковые игры", philosopher: "wittgenstein", rubrics: ["language"], description: "Контекстуальное использование языка" },
            { id: "picture_theory", label: "Теория изображения", philosopher: "wittgenstein", rubrics: ["knowledge"], description: "Язык как картина мира" },
            { id: "limits_language", label: "Границы языка", philosopher: "wittgenstein", rubrics: ["knowledge", "language"], description: "О чем невозможно говорить" },
            { id: "family_resemblance", label: "Семейное сходство", philosopher: "wittgenstein", rubrics: ["language"], description: "Нечёткие категории" },
            { id: "form_of_life", label: "Форма жизни", philosopher: "wittgenstein", rubrics: ["language"], description: "Практический контекст языка" },
            { id: "showing_saying", label: "Показывание vs говорение", philosopher: "wittgenstein", rubrics: ["language"], description: "То, что может быть показано, не может быть сказано" },
            { id: "private_language", label: "Аргумент против приватного языка", philosopher: "wittgenstein", rubrics: ["language"], description: "Невозможность чисто личного языка" },
            { id: "rule_following", label: "Следование правилу", philosopher: "wittgenstein", rubrics: ["language"], description: "Проблема интерпретации правил" },
            
            // САРТР
            { id: "existence", label: "Существование", philosopher: "sartre", rubrics: ["being"], description: "Первично перед сущностью" },
            { id: "nothingness", label: "Ничто", philosopher: "sartre", rubrics: ["consciousness"], description: "Источник свободы" },
            { id: "bad_faith", label: "Дурная вера", philosopher: "sartre", rubrics: ["freedom"], description: "Самообман и бегство от свободы" },
            { id: "freedom_sartre", label: "Свобода", philosopher: "sartre", rubrics: ["freedom"], description: "Осужденность быть свободным" },
            { id: "for_itself", label: "Для-себя-бытие", philosopher: "sartre", rubrics: ["consciousness"], description: "Сознание" },
            { id: "in_itself", label: "В-себе-бытие", philosopher: "sartre", rubrics: ["being"], description: "Вещи без сознания" },
            { id: "look", label: "Взгляд Другого", philosopher: "sartre", rubrics: ["consciousness"], description: "Объективация через Другого" },
            { id: "project", label: "Проект", philosopher: "sartre", rubrics: ["freedom"], description: "Человек как проектирование себя в будущее" },
            { id: "engagement", label: "Ангажированность", philosopher: "sartre", rubrics: ["ethics", "freedom"], description: "Вовлечённость, обязательство перед миром" },
            
            // ФУКО
            { id: "power_knowledge", label: "Власть-знание", philosopher: "foucault", rubrics: ["politics"], description: "Неразрывность власти и знания" },
            { id: "episteme", label: "Эпистема", philosopher: "foucault", rubrics: ["language"], description: "Исторические структуры знания" },
            { id: "discipline", label: "Дисциплина", philosopher: "foucault", rubrics: ["politics"], description: "Микрофизика власти" },
            { id: "biopower", label: "Биовласть", philosopher: "foucault", rubrics: ["politics"], description: "Власть над жизнью" },
            { id: "care_self", label: "Забота о себе", philosopher: "foucault", rubrics: ["ethics"], description: "Этика самопреобразования" },
            { id: "archaeology", label: "Археология знания", philosopher: "foucault", rubrics: ["method"], description: "Метод анализа дискурсов" },
            { id: "heterotopia", label: "Гетеротопия", philosopher: "foucault", rubrics: ["politics"], description: "Иные пространства, реальные утопии" },
            { id: "panopticon", label: "Паноптикум", philosopher: "foucault", rubrics: ["politics"], description: "Архитектура тотального надзора" },
            { id: "problematization", label: "Проблематизация", philosopher: "foucault", rubrics: ["method"], description: "Превращение данности в вопрос" },
            
            // ДЕЛЁЗ
            { id: "rhizome", label: "Ризома", philosopher: "deleuze", rubrics: ["dialectics"], description: "Нелинейная структура" },
            { id: "difference", label: "Различие", philosopher: "deleuze", rubrics: ["dialectics"], description: "Онтология множественности" },
            { id: "body_without_organs", label: "Тело без органов", philosopher: "deleuze", rubrics: ["matter"], description: "Недифференцированная полнота" },
            { id: "desiring_machines", label: "Машины желания", philosopher: "deleuze", rubrics: ["will"], description: "Производство желания" },
            { id: "assemblage", label: "Ассамбляж", philosopher: "deleuze", rubrics: ["being"], description: "Множественное единство" },
            { id: "deterritorialization", label: "Детерриториализация", philosopher: "deleuze", rubrics: ["dialectics"], description: "Разрушение структур" },
            { id: "virtual_actual", label: "Виртуальное-актуальное", philosopher: "deleuze", rubrics: ["being"], description: "Реальное, но не актуализированное" },
            { id: "event", label: "Событие", philosopher: "deleuze", rubrics: ["being"], description: "Чистое становление, смысл" },
            { id: "fold", label: "Складка", philosopher: "deleuze", rubrics: ["being"], description: "Le pli - складывание, барочная топология" }
        ];
        
        // ============================================
        // 5. СВЯЗИ МЕЖДУ КОНЦЕПЦИЯМИ
        // ============================================
        const relations = [
            // СОКРАТ → ПЛАТОН
            { source: "maieutics", target: "anamnesis", type: "influence", weight: 2 },
            { source: "virtue_knowledge", target: "ideas", type: "influence", weight: 2 },
            { source: "care_soul", target: "tripartite_soul", type: "develop", weight: 2 },
            { source: "daimonion", target: "care_soul", type: "ground", weight: 1 },
            { source: "know_nothing", target: "maieutics", type: "ground", weight: 2 },
            { source: "virtue_knowledge", target: "maieutics", type: "ground", weight: 2 },
            { source: "care_soul", target: "virtue_knowledge", type: "ground", weight: 2 },
            { source: "daimonion", target: "maieutics", type: "influence", weight: 1 },
            { source: "soul", target: "care_soul", type: "ground", weight: 2 },
            { source: "soul", target: "virtue_knowledge", type: "ground", weight: 2 },
            { source: "daimonion", target: "soul", type: "influence", weight: 1 },
            
            // ПЛАТОН → АРИСТОТЕЛЬ
            { source: "eidos", target: "form", type: "develop", weight: 3 },
            { source: "ideas", target: "form", type: "critique", weight: 3 },
            { source: "demiurge", target: "unmoved_mover", type: "develop", weight: 2 },
            { source: "tripartite_soul", target: "golden_mean", type: "influence", weight: 1 },
            
            // ВНУТРИ ПЛАТОНА
            { source: "ideas", target: "eidos", type: "ground", weight: 3 },
            { source: "eidos", target: "anamnesis", type: "ground", weight: 2 },
            { source: "cave", target: "ideas", type: "ground", weight: 2 },
            { source: "demiurge", target: "ideas", type: "influence", weight: 2 },
            { source: "ideal_state", target: "tripartite_soul", type: "ground", weight: 2 },
            { source: "tripartite_soul", target: "care_soul", type: "ground", weight: 2 },
            { source: "ideal_state", target: "ideas", type: "ground", weight: 2 },
            { source: "good", target: "ideas", type: "ground", weight: 3 },
            { source: "good", target: "eidos", type: "ground", weight: 3 },
            { source: "cave", target: "good", type: "influence", weight: 2 },
            { source: "good", target: "demiurge", type: "influence", weight: 2 },
            { source: "eros", target: "anamnesis", type: "influence", weight: 2 },
            { source: "eros", target: "care_soul", type: "influence", weight: 2 },
            { source: "eros", target: "good", type: "ground", weight: 2 },
            { source: "eros", target: "cave", type: "influence", weight: 1 },
            { source: "eros", target: "tripartite_soul", type: "ground", weight: 2 },
            { source: "methexis", target: "eidos", type: "ground", weight: 3, bidirectional: true },
            { source: "methexis", target: "cave", type: "ground", weight: 2 },
            { source: "methexis", target: "ideas", type: "ground", weight: 3 },
            { source: "mimesis", target: "methexis", type: "develop", weight: 2 },
            { source: "mimesis", target: "ideas", type: "ground", weight: 2 },
            { source: "chora", target: "demiurge", type: "ground", weight: 2 },
            { source: "chora", target: "matter_ar", type: "dialogue", weight: 1, bidirectional: true },
            { source: "good", target: "methexis", type: "influence", weight: 2 },
            
            // ВНУТРИ АРИСТОТЕЛЯ
            { source: "form", target: "matter_ar", type: "dialogue", weight: 3, bidirectional: true },
            { source: "form", target: "entelechy", type: "ground", weight: 2 },
            { source: "four_causes", target: "entelechy", type: "ground", weight: 2 },
            { source: "unmoved_mover", target: "entelechy", type: "ground", weight: 2 },
            { source: "categories", target: "form", type: "ground", weight: 2 },
            { source: "golden_mean", target: "virtue_knowledge", type: "develop", weight: 2 },
            { source: "golden_mean", target: "entelechy", type: "ground", weight: 2 },
            { source: "act_potency", target: "form", type: "dialogue", weight: 3, bidirectional: true },
            { source: "act_potency", target: "matter_ar", type: "dialogue", weight: 3, bidirectional: true },
            { source: "act_potency", target: "entelechy", type: "ground", weight: 3 },
            { source: "act_potency", target: "unmoved_mover", type: "ground", weight: 3 },
            { source: "four_causes", target: "act_potency", type: "ground", weight: 2 },
            { source: "phronesis", target: "golden_mean", type: "ground", weight: 3 },
            { source: "phronesis", target: "virtue_knowledge", type: "develop", weight: 3 },
            { source: "phronesis", target: "eudaimonia", type: "ground", weight: 3 },
            { source: "eudaimonia", target: "entelechy", type: "ground", weight: 3 },
            { source: "eudaimonia", target: "golden_mean", type: "ground", weight: 3 },
            { source: "logos", target: "form", type: "ground", weight: 3 },
            { source: "logos", target: "categories", type: "ground", weight: 3 },
            { source: "logos", target: "unmoved_mover", type: "ground", weight: 3 },
            
            // ПЛАТОН → ПЛОТИН
            { source: "good", target: "the_one", type: "develop", weight: 3 },
            { source: "ideas", target: "nous", type: "develop", weight: 3 },
            { source: "eidos", target: "nous", type: "influence", weight: 2 },
            { source: "demiurge", target: "world_soul", type: "influence", weight: 2 },
            { source: "anamnesis", target: "henosis", type: "develop", weight: 2 },
            { source: "eros", target: "henosis", type: "influence", weight: 2 },
            { source: "cave", target: "contemplation", type: "influence", weight: 2 },
            
            // АРИСТОТЕЛЬ → ПЛОТИН
            { source: "unmoved_mover", target: "the_one", type: "influence", weight: 2 },
            { source: "entelechy", target: "emanation", type: "influence", weight: 2 },
            { source: "form", target: "nous", type: "influence", weight: 2 },
            
            // ВНУТРИ ПЛОТИНА
            { source: "the_one", target: "emanation", type: "ground", weight: 3 },
            { source: "emanation", target: "nous", type: "ground", weight: 3 },
            { source: "emanation", target: "world_soul", type: "ground", weight: 3 },
            { source: "nous", target: "world_soul", type: "ground", weight: 2 },
            { source: "world_soul", target: "matter_plotinus", type: "oppose", weight: 2 },
            { source: "henosis", target: "the_one", type: "ground", weight: 3 },
            { source: "contemplation", target: "nous", type: "ground", weight: 2 },
            { source: "contemplation", target: "henosis", type: "ground", weight: 2 },
            
            // ПЛОТИН → АВГУСТИН
            { source: "the_one", target: "grace", type: "influence", weight: 2 },
            { source: "emanation", target: "two_cities", type: "influence", weight: 1 },
            { source: "nous", target: "faith_reason", type: "influence", weight: 2 },
            { source: "henosis", target: "confession", type: "influence", weight: 2 },
            { source: "world_soul", target: "time_augustine", type: "influence", weight: 1 },
            { source: "contemplation", target: "confession", type: "influence", weight: 2 },
            
            // ПЛОТИН → ДРУГИЕ
            { source: "the_one", target: "substance_spinoza", type: "influence", weight: 2 },
            { source: "emanation", target: "absolute_idea", type: "influence", weight: 2 },
            { source: "contemplation", target: "intellectual_love", type: "influence", weight: 2 },
            
            // АРИСТОТЕЛЬ → СРЕДНЕВЕКОВЬЕ
            { source: "form", target: "essence_existence", type: "influence", weight: 3 },
            { source: "four_causes", target: "five_ways", type: "influence", weight: 2 },
            { source: "act_potency", target: "essence_existence", type: "influence", weight: 3 },
            
            // ВНУТРИ АВГУСТИНА
            { source: "grace", target: "original_sin", type: "oppose", weight: 2 },
            { source: "faith_reason", target: "confession", type: "ground", weight: 2 },
            { source: "two_cities", target: "grace", type: "ground", weight: 2 },
            { source: "time_augustine", target: "confession", type: "ground", weight: 2 },
            { source: "two_cities", target: "faith_reason", type: "ground", weight: 2 },
            { source: "original_sin", target: "confession", type: "ground", weight: 2 },
            { source: "grace", target: "confession", type: "influence", weight: 2 },
            
            // АВГУСТИН → ФОМА
            { source: "faith_reason", target: "thomistic_synthesis", type: "influence", weight: 2 },
            { source: "grace", target: "natural_law", type: "influence", weight: 2 },
            
            // ПЛАТОН → АВГУСТИН
            { source: "good", target: "grace", type: "influence", weight: 2 },
            { source: "ideas", target: "faith_reason", type: "influence", weight: 2 },
            { source: "anamnesis", target: "confession", type: "influence", weight: 2 },
            { source: "eidos", target: "grace", type: "influence", weight: 1 },
            { source: "tripartite_soul", target: "two_cities", type: "influence", weight: 1 },
            
            // ВНУТРИ ФОМЫ
            { source: "essence_existence", target: "five_ways", type: "ground", weight: 3 },
            { source: "natural_law", target: "thomistic_synthesis", type: "ground", weight: 2 },
            { source: "analogy", target: "essence_existence", type: "ground", weight: 2 },
            { source: "thomistic_synthesis", target: "form", type: "develop", weight: 2 },
            { source: "thomistic_synthesis", target: "essence_existence", type: "ground", weight: 2 },
            { source: "natural_law", target: "five_ways", type: "ground", weight: 2 },
            { source: "accidents", target: "essence_existence", type: "ground", weight: 2 },
            { source: "actual_being", target: "act_potency", type: "develop", weight: 3 },
            { source: "actual_being", target: "essence_existence", type: "ground", weight: 3 },
            { source: "participatio", target: "methexis", type: "develop", weight: 3 },
            { source: "participatio", target: "essence_existence", type: "ground", weight: 3 },
            { source: "participatio", target: "analogy", type: "ground", weight: 3 },
            
            // ДЕКАРТ
            { source: "cogito", target: "dualism", type: "ground", weight: 3 },
            { source: "res_cogitans", target: "res_extensa", type: "oppose", weight: 3 },
            { source: "dualism", target: "res_cogitans", type: "ground", weight: 2 },
            { source: "method", target: "cogito", type: "ground", weight: 2 },
            { source: "clear_distinct", target: "innate_ideas", type: "ground", weight: 2 },
            { source: "innate_ideas", target: "res_cogitans", type: "ground", weight: 2 },
            { source: "cogito", target: "know_nothing", type: "critique", weight: 2 },
            
            // ДЕКАРТ → ЛОКК
            { source: "innate_ideas", target: "tabula_rasa", type: "oppose", weight: 3 },
            { source: "res_extensa", target: "primary_qualities", type: "influence", weight: 2 },
            { source: "clear_distinct", target: "simple_ideas", type: "dialogue", weight: 1, bidirectional: true },
            
            // ВНУТРИ ЛОККА
            { source: "tabula_rasa", target: "simple_ideas", type: "ground", weight: 3 },
            { source: "simple_ideas", target: "complex_ideas", type: "ground", weight: 3 },
            { source: "primary_qualities", target: "secondary_qualities", type: "oppose", weight: 2 },
            { source: "primary_qualities", target: "substance_locke", type: "ground", weight: 2 },
            { source: "substance_locke", target: "simple_ideas", type: "ground", weight: 2 },
            { source: "personal_identity", target: "complex_ideas", type: "ground", weight: 2 },
            
            // ЛОКК → БЕРКЛИ
            { source: "primary_qualities", target: "esse_percipi", type: "critique", weight: 3 },
            { source: "substance_locke", target: "immaterialism", type: "critique", weight: 3 },
            { source: "simple_ideas", target: "ideas_berkeley", type: "influence", weight: 2 },
            
            // ЛОКК → ЮМ
            { source: "simple_ideas", target: "impressions", type: "develop", weight: 3 },
            { source: "complex_ideas", target: "ideas_hume", type: "influence", weight: 2 },
            { source: "tabula_rasa", target: "bundle_theory", type: "influence", weight: 2 },
            { source: "substance_locke", target: "bundle_theory", type: "influence", weight: 2 },
            
            // ЛОКК → ЛЕЙБНИЦ
            { source: "tabula_rasa", target: "petites_perceptions", type: "oppose", weight: 2 },
            { source: "tabula_rasa", target: "innate_ideas", type: "critique", weight: 2 },
            
            // ЛОКК → КАНТ
            { source: "primary_qualities", target: "thing_itself", type: "influence", weight: 2 },
            { source: "simple_ideas", target: "apriori", type: "oppose", weight: 2 },
            
            // СПИНОЗА
            { source: "substance_spinoza", target: "modes", type: "ground", weight: 3 },
            { source: "attributes", target: "substance_spinoza", type: "ground", weight: 2 },
            { source: "conatus", target: "modes", type: "ground", weight: 2 },
            { source: "intellectual_love", target: "substance_spinoza", type: "ground", weight: 2 },
            { source: "determinism", target: "substance_spinoza", type: "ground", weight: 2 },
            { source: "substance_spinoza", target: "dualism", type: "critique", weight: 2 },
            { source: "determinism", target: "autonomy", type: "oppose", weight: 2 },
            { source: "natura_naturans", target: "substance_spinoza", type: "ground", weight: 3 },
            { source: "natura_naturata", target: "modes", type: "ground", weight: 3 },
            { source: "natura_naturans", target: "natura_naturata", type: "dialogue", weight: 2, bidirectional: true },
            { source: "adequate_ideas", target: "intellectual_love", type: "ground", weight: 2 },
            { source: "adequate_ideas", target: "clear_distinct", type: "dialogue", weight: 1, bidirectional: true },
            
            // АРИСТОТЕЛЬ → СПИНОЗА
            { source: "entelechy", target: "substance_spinoza", type: "influence", weight: 2 },
            
            // СПИНОЗА → ГЕГЕЛЬ
            { source: "substance_spinoza", target: "absolute_idea", type: "influence", weight: 2 },
            { source: "determinism", target: "dialectic", type: "dialogue", weight: 2, bidirectional: true },
            
            // ЛЕЙБНИЦ
            { source: "monads", target: "preestablished", type: "ground", weight: 2 },
            { source: "sufficient_reason", target: "best_worlds", type: "ground", weight: 2 },
            { source: "petites_perceptions", target: "monads", type: "ground", weight: 2 },
            { source: "monads", target: "substance_spinoza", type: "critique", weight: 2 },
            { source: "preestablished", target: "dualism", type: "synthesize", weight: 2 },
            { source: "best_worlds", target: "demiurge", type: "develop", weight: 1 },
            { source: "sufficient_reason", target: "four_causes", type: "develop", weight: 1 },
            { source: "sufficient_reason", target: "preestablished", type: "ground", weight: 2 },
            { source: "best_worlds", target: "monads", type: "ground", weight: 2 },
            { source: "apperception", target: "monads", type: "ground", weight: 3 },
            { source: "apperception", target: "petites_perceptions", type: "oppose", weight: 2 },
            { source: "apperception", target: "transcendental_ego", type: "influence", weight: 2 },
            { source: "apperception", target: "intentionality", type: "influence", weight: 2 },
            { source: "continuity", target: "preestablished", type: "ground", weight: 2 },
            { source: "continuity", target: "monads", type: "ground", weight: 2 },
            
            // ЛЕЙБНИЦ → КАНТ
            { source: "apperception", target: "transcendental_ego", type: "influence", weight: 2 },
            { source: "monads", target: "thing_itself", type: "influence", weight: 2 },
            { source: "preestablished", target: "transcendental", type: "critique", weight: 2 },
            { source: "sufficient_reason", target: "antinomies", type: "influence", weight: 2 },
            { source: "petites_perceptions", target: "apriori", type: "dialogue", weight: 1, bidirectional: true },
            
            // ВНУТРИ БЕРКЛИ
            { source: "esse_percipi", target: "immaterialism", type: "ground", weight: 3 },
            { source: "immaterialism", target: "ideas_berkeley", type: "ground", weight: 2 },
            { source: "god_perceiver", target: "esse_percipi", type: "ground", weight: 2 },
            { source: "ideas_berkeley", target: "esse_percipi", type: "ground", weight: 2 },
            
            // БЕРКЛИ → ЮМ
            { source: "immaterialism", target: "impressions", type: "influence", weight: 2 },
            { source: "esse_percipi", target: "causality_critique", type: "influence", weight: 2 },
            
            // БЕРКЛИ → КАНТ
            { source: "immaterialism", target: "phenomenon", type: "influence", weight: 2 },
            { source: "esse_percipi", target: "transcendental", type: "dialogue", weight: 1, bidirectional: true },
            
            // ЮМ
            { source: "impressions", target: "ideas_hume", type: "ground", weight: 2 },
            { source: "causality_critique", target: "custom", type: "ground", weight: 2 },
            { source: "bundle_theory", target: "impressions", type: "ground", weight: 2 },
            { source: "is_ought", target: "natural_law", type: "critique", weight: 2 },
            { source: "causality_critique", target: "four_causes", type: "critique", weight: 2 },
            { source: "impressions", target: "innate_ideas", type: "critique", weight: 2 },
            { source: "causality_critique", target: "impressions", type: "ground", weight: 2 },
            { source: "custom", target: "ideas_hume", type: "ground", weight: 2 },
            { source: "is_ought", target: "impressions", type: "ground", weight: 2 },
            
            // КАНТ
            { source: "thing_itself", target: "phenomenon", type: "oppose", weight: 3 },
            { source: "apriori", target: "phenomenon", type: "ground", weight: 2 },
            { source: "categorical", target: "autonomy", type: "ground", weight: 3 },
            { source: "synthetic_apriori", target: "transcendental", type: "ground", weight: 2 },
            { source: "transcendental", target: "apriori", type: "ground", weight: 2 },
            { source: "thing_itself", target: "ideas", type: "critique", weight: 2 },
            { source: "apriori", target: "impressions", type: "critique", weight: 2 },
            { source: "synthetic_apriori", target: "innate_ideas", type: "develop", weight: 2 },
            { source: "categorical", target: "natural_law", type: "develop", weight: 2 },
            { source: "categorical", target: "apriori", type: "ground", weight: 3 },
            { source: "autonomy", target: "transcendental", type: "ground", weight: 2 },
            { source: "categorical", target: "phenomenon", type: "influence", weight: 1 },
            { source: "antinomies", target: "thing_itself", type: "ground", weight: 3 },
            { source: "transcendental", target: "antinomies", type: "ground", weight: 3 },
            { source: "synthetic_apriori", target: "antinomies", type: "influence", weight: 2 },
            { source: "sublime", target: "thing_itself", type: "influence", weight: 2 },
            { source: "sublime", target: "aesthetic_judgment", type: "ground", weight: 2 },
            { source: "sublime", target: "dionysian", type: "dialogue", weight: 1, bidirectional: true },
            { source: "postulates", target: "categorical", type: "ground", weight: 3 },
            { source: "postulates", target: "autonomy", type: "ground", weight: 3 },
            { source: "aesthetic_judgment", target: "phenomenon", type: "ground", weight: 2 },
            { source: "aesthetic_judgment", target: "transcendental", type: "ground", weight: 2 },
            
            // КАНТ → ГЕГЕЛЬ
            { source: "antinomies", target: "dialectic", type: "influence", weight: 3 },
            
            // КАНТ → ШОПЕНГАУЭР
            { source: "thing_itself", target: "will_schop", type: "develop", weight: 3 },
            { source: "phenomenon", target: "representation", type: "influence", weight: 2 },
            { source: "transcendental", target: "aesthetics_schop", type: "influence", weight: 2 },
            { source: "categorical", target: "compassion", type: "critique", weight: 2 },
            { source: "sublime", target: "aesthetics_schop", type: "influence", weight: 2 },
            
            // КАНТ → НИЦШЕ
            { source: "autonomy", target: "will_power", type: "critique", weight: 2 },
            { source: "postulates", target: "god_dead", type: "critique", weight: 2 },
            
            // ФИХТЕ
            { source: "absolute_ego", target: "non_ego", type: "oppose", weight: 3 },
            { source: "tathandlung", target: "absolute_ego", type: "ground", weight: 2 },
            { source: "striving", target: "non_ego", type: "ground", weight: 2 },
            { source: "practical_primacy", target: "tathandlung", type: "ground", weight: 2 },
            { source: "absolute_ego", target: "transcendental", type: "develop", weight: 3 },
            { source: "tathandlung", target: "cogito", type: "critique", weight: 2 },
            { source: "imagination", target: "absolute_ego", type: "ground", weight: 3 },
            { source: "imagination", target: "non_ego", type: "ground", weight: 3 },
            { source: "imagination", target: "tathandlung", type: "ground", weight: 3 },
            { source: "wissenschaftslehre", target: "tathandlung", type: "ground", weight: 2 },
            { source: "wissenschaftslehre", target: "absolute_ego", type: "ground", weight: 2 },
            
            // ФИХТЕ → ГЕГЕЛЬ
            { source: "absolute_ego", target: "absolute_idea", type: "influence", weight: 3 },
            { source: "tathandlung", target: "dialectic", type: "influence", weight: 2 },
            
            // ГЕГЕЛЬ
            { source: "dialectic", target: "aufhebung", type: "ground", weight: 3 },
            { source: "absolute_idea", target: "weltgeist", type: "ground", weight: 2 },
            { source: "dialectic", target: "absolute_idea", type: "ground", weight: 3 },
            { source: "master_slave", target: "dialectic", type: "ground", weight: 2 },
            { source: "objective_spirit", target: "weltgeist", type: "ground", weight: 2 },
            { source: "cunning_reason", target: "weltgeist", type: "ground", weight: 2 },
            { source: "aufhebung", target: "non_ego", type: "synthesize", weight: 2 },
            { source: "dialectic", target: "thing_itself", type: "synthesize", weight: 2 },
            { source: "absolute_idea", target: "absolute_ego", type: "develop", weight: 3 },
            { source: "entfremdung", target: "objective_spirit", type: "ground", weight: 2 },
            { source: "dialectic", target: "entfremdung", type: "ground", weight: 2 },
            { source: "entfremdung", target: "aufhebung", type: "synthesize", weight: 2 },
            { source: "master_slave", target: "entfremdung", type: "ground", weight: 2 },
            { source: "negative", target: "dialectic", type: "ground", weight: 3 },
            { source: "negative", target: "aufhebung", type: "ground", weight: 3 },
            { source: "negative", target: "nothingness", type: "develop", weight: 2 },
            { source: "concrete", target: "abstract", type: "dialogue", weight: 3, bidirectional: true },
            { source: "abstract", target: "dialectic", type: "ground", weight: 2 },
            { source: "abstract", target: "aufhebung", type: "synthesize", weight: 2 },
            { source: "concrete", target: "absolute_idea", type: "ground", weight: 2 },
            { source: "concrete", target: "dialectic", type: "ground", weight: 2 },
            
            // ГЕГЕЛЬ → МАРКС
            { source: "entfremdung", target: "alienation", type: "influence", weight: 3 },
            
            // ГЕГЕЛЬ → КЬЕРКЕГОР
            { source: "absolute_idea", target: "individual", type: "critique", weight: 3 },
            { source: "objective_spirit", target: "subjective_truth", type: "oppose", weight: 2 },
            { source: "dialectic", target: "stages_existence", type: "critique", weight: 2 },
            { source: "aufhebung", target: "leap_faith", type: "oppose", weight: 2 },
            
            // ШОПЕНГАУЭР
            { source: "will_schop", target: "representation", type: "oppose", weight: 3 },
            { source: "suffering", target: "will_schop", type: "ground", weight: 2 },
            { source: "denial_will", target: "suffering", type: "oppose", weight: 2 },
            { source: "aesthetics_schop", target: "denial_will", type: "ground", weight: 2 },
            { source: "compassion", target: "denial_will", type: "ground", weight: 2 },
            { source: "will_schop", target: "absolute_idea", type: "critique", weight: 3 },
            { source: "representation", target: "phenomenon", type: "develop", weight: 2 },
            { source: "individuation", target: "representation", type: "ground", weight: 3 },
            { source: "individuation", target: "will_schop", type: "oppose", weight: 2 },
            { source: "individuation", target: "suffering", type: "ground", weight: 2 },
            
            // ШОПЕНГАУЭР → ВИТГЕНШТЕЙН
            { source: "will_schop", target: "showing_saying", type: "influence", weight: 2 },
            { source: "representation", target: "picture_theory", type: "influence", weight: 2 },
            { source: "aesthetics_schop", target: "limits_language", type: "influence", weight: 1 },
            
            // КЬЕРКЕГОР
            { source: "stages_existence", target: "leap_faith", type: "ground", weight: 2 },
            { source: "anxiety", target: "leap_faith", type: "ground", weight: 2 },
            { source: "despair", target: "anxiety", type: "ground", weight: 2 },
            { source: "individual", target: "subjective_truth", type: "ground", weight: 2 },
            { source: "subjective_truth", target: "leap_faith", type: "ground", weight: 2 },
            { source: "individual", target: "absolute_idea", type: "critique", weight: 2 },
            { source: "leap_faith", target: "dialectic", type: "critique", weight: 2 },
            { source: "repetition", target: "eternal_return", type: "dialogue", weight: 2, bidirectional: true },
            { source: "repetition", target: "stages_existence", type: "ground", weight: 2 },
            { source: "moment", target: "leap_faith", type: "ground", weight: 3 },
            { source: "moment", target: "time_augustine", type: "develop", weight: 2 },
            { source: "moment", target: "anxiety", type: "ground", weight: 2 },
            
            // МАРКС
            { source: "praxis", target: "alienation", type: "oppose", weight: 2 },
            { source: "base_superstructure", target: "class_struggle", type: "ground", weight: 2 },
            { source: "commodity_fetish", target: "alienation", type: "ground", weight: 2 },
            { source: "historical_materialism", target: "base_superstructure", type: "ground", weight: 2 },
            { source: "praxis", target: "tathandlung", type: "develop", weight: 2 },
            { source: "dialectic", target: "historical_materialism", type: "influence", weight: 3 },
            { source: "alienation", target: "objective_spirit", type: "critique", weight: 2 },
            { source: "historical_materialism", target: "praxis", type: "ground", weight: 2 },
            { source: "base_superstructure", target: "alienation", type: "ground", weight: 2 },
            { source: "class_struggle", target: "praxis", type: "ground", weight: 2 },
            { source: "commodity_fetish", target: "base_superstructure", type: "ground", weight: 2 },
            { source: "ideology", target: "base_superstructure", type: "ground", weight: 2 },
            { source: "ideology", target: "alienation", type: "ground", weight: 2 },
            
            // МАРКС → ФУКО
            { source: "base_superstructure", target: "episteme", type: "dialogue", weight: 2, bidirectional: true },
            { source: "ideology", target: "power_knowledge", type: "dialogue", weight: 2, bidirectional: true },
            
            // НИЦШЕ
            { source: "will_power", target: "ubermensch", type: "ground", weight: 3 },
            { source: "god_dead", target: "ubermensch", type: "ground", weight: 2 },
            { source: "eternal_return", target: "will_power", type: "ground", weight: 2 },
            { source: "perspectivism", target: "god_dead", type: "ground", weight: 2 },
            { source: "master_morality", target: "slave_morality", type: "oppose", weight: 3 },
            { source: "will_schop", target: "will_power", type: "develop", weight: 3 },
            { source: "god_dead", target: "absolute_idea", type: "critique", weight: 3 },
            { source: "ubermensch", target: "categorical", type: "critique", weight: 2 },
            { source: "perspectivism", target: "thing_itself", type: "critique", weight: 2 },
            { source: "master_morality", target: "natural_law", type: "critique", weight: 2 },
            { source: "master_morality", target: "will_power", type: "ground", weight: 3 },
            { source: "master_morality", target: "ubermensch", type: "ground", weight: 3 },
            { source: "slave_morality", target: "god_dead", type: "influence", weight: 2 },
            { source: "dionysian", target: "apollonian", type: "oppose", weight: 3 },
            { source: "dionysian", target: "apollonian", type: "internal_contradiction", weight: 3 },
            { source: "dionysian", target: "will_power", type: "ground", weight: 2 },
            { source: "apollonian", target: "will_power", type: "ground", weight: 2 },
            { source: "dionysian", target: "eternal_return", type: "influence", weight: 2 },
            { source: "apollonian", target: "representation", type: "dialogue", weight: 1, bidirectional: true },
            { source: "ressentiment", target: "slave_morality", type: "ground", weight: 3 },
            { source: "ressentiment", target: "master_morality", type: "oppose", weight: 2 },
            { source: "ressentiment", target: "will_power", type: "oppose", weight: 2 },
            
            // НИЦШЕ → СОВРЕМЕННЫЕ
            { source: "perspectivism", target: "episteme", type: "influence", weight: 2 },
            { source: "will_power", target: "power_knowledge", type: "influence", weight: 2 },
            { source: "will_power", target: "desiring_machines", type: "influence", weight: 2 },
            { source: "eternal_return", target: "difference", type: "influence", weight: 2 },
            
            // СПИНОЗА → НИЦШЕ
            { source: "intellectual_love", target: "eternal_return", type: "influence", weight: 2 },
            { source: "determinism", target: "eternal_return", type: "dialogue", weight: 2, bidirectional: true },
            
            // ГУССЕРЛЬ
            { source: "intentionality", target: "epoché", type: "ground", weight: 3 },
            { source: "transcendental_ego", target: "eidetic", type: "ground", weight: 2 },
            { source: "lifeworld", target: "epoché", type: "oppose", weight: 2 },
            { source: "eidetic", target: "intentionality", type: "ground", weight: 2 },
            { source: "transcendental_ego", target: "cogito", type: "develop", weight: 3 },
            { source: "epoché", target: "method", type: "develop", weight: 2 },
            { source: "noesis_noema", target: "intentionality", type: "ground", weight: 3 },
            { source: "noesis_noema", target: "eidetic", type: "ground", weight: 3 },
            { source: "constitution", target: "transcendental_ego", type: "ground", weight: 3 },
            { source: "constitution", target: "intentionality", type: "ground", weight: 3 },
            { source: "intersubjectivity", target: "lifeworld", type: "ground", weight: 2 },
            { source: "intersubjectivity", target: "look", type: "influence", weight: 2 },
            { source: "intersubjectivity", target: "transcendental_ego", type: "critique", weight: 2 },
            { source: "intentionality", target: "lifeworld", type: "ground", weight: 2 },
            
            // ДЕКАРТ → ГУССЕРЛЬ
            { source: "cogito", target: "transcendental_ego", type: "influence", weight: 2 },
            { source: "method", target: "epoché", type: "influence", weight: 2 },
            { source: "clear_distinct", target: "eidetic", type: "influence", weight: 2 },
            
            // ХАЙДЕГГЕР
            { source: "dasein", target: "sein", type: "ground", weight: 3 },
            { source: "geworfenheit", target: "sorge", type: "ground", weight: 2 },
            { source: "dasein", target: "geworfenheit", type: "ground", weight: 2 },
            { source: "sein_zum_tode", target: "dasein", type: "ground", weight: 2 },
            { source: "aletheia", target: "sein", type: "ground", weight: 2 },
            { source: "dwelling", target: "dasein", type: "ground", weight: 2 },
            { source: "sein", target: "absolute_idea", type: "critique", weight: 3 },
            { source: "dasein", target: "transcendental_ego", type: "critique", weight: 2 },
            { source: "sorge", target: "intentionality", type: "develop", weight: 2 },
            { source: "das_man", target: "dasein", type: "ground", weight: 2 },
            { source: "das_man", target: "geworfenheit", type: "influence", weight: 2 },
            { source: "das_man", target: "sein_zum_tode", type: "oppose", weight: 2 },
            { source: "dwelling", target: "das_man", type: "oppose", weight: 2 },
            { source: "ereignis", target: "sein", type: "ground", weight: 3 },
            { source: "ereignis", target: "aletheia", type: "ground", weight: 3 },
            { source: "ereignis", target: "event", type: "dialogue", weight: 2, bidirectional: true },
            { source: "geviert", target: "dwelling", type: "ground", weight: 2 },
            { source: "geviert", target: "dasein", type: "ground", weight: 2 },
            { source: "kehre", target: "sein", type: "internal_contradiction", weight: 2 },
            { source: "kehre", target: "ereignis", type: "ground", weight: 2 },
            
            // ХАЙДЕГГЕР → ФУКО
            { source: "aletheia", target: "archaeology", type: "influence", weight: 2 },
            { source: "dwelling", target: "care_self", type: "dialogue", weight: 2, bidirectional: true },
            
            // ВИТГЕНШТЕЙН
            { source: "language_game", target: "form_of_life", type: "ground", weight: 2 },
            { source: "picture_theory", target: "limits_language", type: "ground", weight: 2 },
            { source: "family_resemblance", target: "language_game", type: "ground", weight: 2 },
            { source: "limits_language", target: "categories", type: "critique", weight: 2 },
            { source: "language_game", target: "picture_theory", type: "critique", weight: 2 },
            { source: "picture_theory", target: "language_game", type: "internal_contradiction", weight: 2 },
            { source: "showing_saying", target: "limits_language", type: "ground", weight: 3 },
            { source: "showing_saying", target: "picture_theory", type: "ground", weight: 3 },
            { source: "private_language", target: "form_of_life", type: "ground", weight: 3 },
            { source: "private_language", target: "language_game", type: "ground", weight: 3 },
            { source: "rule_following", target: "language_game", type: "ground", weight: 3 },
            { source: "rule_following", target: "family_resemblance", type: "ground", weight: 3 },
            
            // АВГУСТИН → ВИТГЕНШТЕЙН
            { source: "confession", target: "language_game", type: "critique", weight: 1 },
            
            // САРТР
            { source: "existence", target: "nothingness", type: "ground", weight: 3 },
            { source: "freedom_sartre", target: "bad_faith", type: "oppose", weight: 3 },
            { source: "nothingness", target: "freedom_sartre", type: "ground", weight: 3 },
            { source: "for_itself", target: "in_itself", type: "oppose", weight: 3 },
            { source: "look", target: "for_itself", type: "ground", weight: 2 },
            { source: "existence", target: "dasein", type: "develop", weight: 2 },
            { source: "nothingness", target: "sein", type: "develop", weight: 2 },
            { source: "freedom_sartre", target: "geworfenheit", type: "dialogue", weight: 2, bidirectional: true },
            { source: "bad_faith", target: "dualism", type: "critique", weight: 2 },
            { source: "for_itself", target: "nothingness", type: "ground", weight: 2 },
            { source: "for_itself", target: "freedom_sartre", type: "ground", weight: 2 },
            { source: "look", target: "bad_faith", type: "influence", weight: 2 },
            { source: "in_itself", target: "existence", type: "ground", weight: 2 },
            { source: "project", target: "existence", type: "ground", weight: 3 },
            { source: "project", target: "freedom_sartre", type: "ground", weight: 3 },
            { source: "project", target: "for_itself", type: "ground", weight: 3 },
            { source: "engagement", target: "bad_faith", type: "oppose", weight: 2 },
            { source: "engagement", target: "praxis", type: "dialogue", weight: 2, bidirectional: true },
            { source: "engagement", target: "freedom_sartre", type: "ground", weight: 2 },
            
            // КАНТ → САРТР
            { source: "phenomenon", target: "for_itself", type: "influence", weight: 2 },
            
            // ФУКО
            { source: "power_knowledge", target: "episteme", type: "ground", weight: 3 },
            { source: "discipline", target: "biopower", type: "ground", weight: 2 },
            { source: "archaeology", target: "episteme", type: "ground", weight: 2 },
            { source: "care_self", target: "care_soul", type: "develop", weight: 2 },
            { source: "power_knowledge", target: "transcendental", type: "critique", weight: 2 },
            { source: "episteme", target: "apriori", type: "critique", weight: 2 },
            { source: "biopower", target: "conatus", type: "develop", weight: 2 },
            { source: "discipline", target: "power_knowledge", type: "ground", weight: 3 },
            { source: "biopower", target: "episteme", type: "influence", weight: 2 },
            { source: "care_self", target: "discipline", type: "oppose", weight: 2 },
            { source: "panopticon", target: "discipline", type: "ground", weight: 3 },
            { source: "panopticon", target: "biopower", type: "ground", weight: 3 },
            { source: "heterotopia", target: "episteme", type: "influence", weight: 2 },
            { source: "heterotopia", target: "power_knowledge", type: "ground", weight: 2 },
            { source: "problematization", target: "archaeology", type: "ground", weight: 2 },
            { source: "problematization", target: "care_self", type: "ground", weight: 2 },
            
            // ДЕЛЁЗ
            { source: "rhizome", target: "assemblage", type: "ground", weight: 2 },
            { source: "difference", target: "body_without_organs", type: "ground", weight: 2 },
            { source: "desiring_machines", target: "body_without_organs", type: "ground", weight: 2 },
            { source: "deterritorialization", target: "rhizome", type: "ground", weight: 2 },
            { source: "difference", target: "dialectic", type: "critique", weight: 3 },
            { source: "rhizome", target: "weltgeist", type: "critique", weight: 2 },
            { source: "body_without_organs", target: "res_extensa", type: "critique", weight: 2 },
            { source: "desiring_machines", target: "conatus", type: "develop", weight: 2 },
            { source: "virtual_actual", target: "difference", type: "ground", weight: 3 },
            { source: "virtual_actual", target: "act_potency", type: "develop", weight: 2 },
            { source: "event", target: "ereignis", type: "dialogue", weight: 2, bidirectional: true },
            { source: "event", target: "difference", type: "ground", weight: 2 },
            { source: "fold", target: "body_without_organs", type: "develop", weight: 2 },
            { source: "fold", target: "rhizome", type: "ground", weight: 2 },
            
            // ДОПОЛНИТЕЛЬНЫЕ МЕЖКОНЦЕПТУАЛЬНЫЕ СВЯЗИ
            { source: "conatus", target: "will_power", type: "influence", weight: 2 },
            { source: "eternal_return", target: "dialectic", type: "critique", weight: 2 },
            { source: "compassion", target: "categorical", type: "influence", weight: 2 },
            { source: "alienation", target: "bad_faith", type: "influence", weight: 2 },
            { source: "determinism", target: "freedom_sartre", type: "oppose", weight: 2 },
            { source: "entelechy", target: "conatus", type: "influence", weight: 2 },
            { source: "original_sin", target: "geworfenheit", type: "influence", weight: 1 },
            { source: "look", target: "master_slave", type: "develop", weight: 2 },
            
            // ВНУТРЕННИЕ ПРОТИВОРЕЧИЯ
            { source: "thing_itself", target: "phenomenon", type: "internal_contradiction", weight: 3 },
            { source: "res_cogitans", target: "res_extensa", type: "internal_contradiction", weight: 3 },
            { source: "freedom_sartre", target: "bad_faith", type: "internal_contradiction", weight: 2 },
            { source: "will_schop", target: "denial_will", type: "internal_contradiction", weight: 2 },
            { source: "for_itself", target: "in_itself", type: "internal_contradiction", weight: 2 },
            { source: "absolute_ego", target: "non_ego", type: "internal_contradiction", weight: 2 },
            
            // ДУША В ИСТОРИИ ФИЛОСОФИИ
            { source: "soul", target: "tripartite_soul", type: "develop", weight: 2 },
            { source: "soul", target: "anamnesis", type: "influence", weight: 2 },
            { source: "soul", target: "entelechy", type: "influence", weight: 2 },
            { source: "soul", target: "confession", type: "influence", weight: 2 },
            { source: "soul", target: "res_cogitans", type: "influence", weight: 2 },
            { source: "soul", target: "despair", type: "influence", weight: 2 },
            
            // ИДЕОЛОГИЯ
            { source: "ideology", target: "absolute_idea", type: "critique", weight: 2 },
            { source: "ideology", target: "objective_spirit", type: "critique", weight: 2 },
            { source: "ideology", target: "power_knowledge", type: "dialogue", weight: 2, bidirectional: true },
            { source: "ideology", target: "episteme", type: "dialogue", weight: 2, bidirectional: true },
            { source: "ideology", target: "slave_morality", type: "dialogue", weight: 2, bidirectional: true },
            { source: "ideology", target: "bad_faith", type: "influence", weight: 2 },
            { source: "ideology", target: "perspectivism", type: "dialogue", weight: 2, bidirectional: true },
            { source: "ideology", target: "deterritorialization", type: "influence", weight: 1 },
            
            // АРИСТОТЕЛЬ: ЕЩЕ PHRONESIS
            { source: "phronesis", target: "practical_primacy", type: "influence", weight: 2 },
            { source: "eudaimonia", target: "categorical", type: "dialogue", weight: 2, bidirectional: true },
            
            // Внутри Локка
            { source: "personal_identity", target: "property_theory", type: "ground", weight: 3 },
            { source: "tabula_rasa", target: "property_theory", type: "ground", weight: 2 },
            
            // С предшественниками
            { source: "natural_law", target: "property_theory", type: "influence", weight: 2 },
            
            // С Марксом
            { source: "property_theory", target: "alienation", type: "critique", weight: 3 },
            { source: "property_theory", target: "base_superstructure", type: "influence", weight: 2 },
            { source: "ideology", target: "property_theory", type: "critique", weight: 2 },
            
            // С Гегелем 
            { source: "property_theory", target: "objective_spirit", type: "influence", weight: 2 }
            
        ];

        // Создаём карту философов по id -> имя на русском
        const philosopherIdToName = {};
        philosophers.forEach(p => {
            philosopherIdToName[p.id] = p.nameRu;
        });
        
        // Создаём объект philosopherConcepts для совместимости с существующим кодом
        const philosopherConcepts = {};
        philosophers.forEach(p => {
            philosopherConcepts[p.nameRu] = {
                color: p.color,
                years: p.years
            };
        });
        
        // Создаём объект philosopherOrder (уже есть в старом коде, но можно регенерировать)
        const philosopherOrder = {};
        philosophers.forEach(p => {
            philosopherOrder[p.nameRu] = p.birth;
        });
        
        // Преобразуем relationTypes из массива в объект
        const relationTypesObj = {};
        relationTypes.forEach(rt => {
            relationTypesObj[rt.id] = {
                color: rt.color,
                label: rt.label
            };
        });
        
        // Создаём nodes из concepts
        const nodes = concepts.map(c => ({
            id: c.id,
            label: c.label,
            concept: philosopherIdToName[c.philosopher], // Преобразуем id в имя
            description: c.description
        }));
        
        // Создаём links из relations
        const links = relations.map(r => ({
            source: r.source,
            target: r.target,
            type: r.type,
            weight: r.weight || 2, // Вес по умолчанию, если не указан
            bidirectional: r.bidirectional || false
        }));
        
        // Создаём обратный индекс концепция -> рубрики
        const conceptToRubrics = {};
        concepts.forEach(c => {
            conceptToRubrics[c.id] = c.rubrics || [];
        });
        
        // Создаём объект rubrics для совместимости
        const rubricsObj = {};
        rubrics.forEach(r => {
            rubricsObj[r.name] = {
                concepts: concepts.filter(c => c.rubrics && c.rubrics.includes(r.id)).map(c => c.id),
                description: r.description
            };
        });
        
        // Индивидуальные веса для связей (примеры ключевых связей)
        const specificWeights = {
            // Фундаментальные сильные связи (вес 3)
            "ideas-form": 3,                    // Платон → Аристотель (критика идей)
            "eidos-form": 3,                    // Эйдос → Форма (развитие)
            "cogito-dualism": 3,                // Cogito обосновывает дуализм
            "substance_spinoza-modes": 3,       // Субстанция обосновывает модусы
            "dialectic-absolute_idea": 3,       // Диалектика обосновывает абсолютную идею
            "will_schop-representation": 3,     // Воля противостоит представлению
            "thing_itself-phenomenon": 3,       // Вещь в себе vs феномен
            "existence-nothingness": 3,         // Существование обосновывает Ничто
            "intentionality-epoché": 3,         // Интенциональность обосновывает эпохе
            "dasein-sein": 3,                   // Dasein обосновывает Sein
            
            // Исторически значимые влияния (вес 3)
            "form-essence_existence": 3,        // Аристотель → Фома
            "absolute_ego-absolute_idea": 3,    // Фихте → Гегель
            "dialectic-historical_materialism": 3, // Гегель → Маркс
            "will_schop-will_power": 3,         // Шопенгауэр → Ницше
            "transcendental-absolute_ego": 3,   // Кант → Фихте
            
            // Внутренние противоречия (вес 2-3 в зависимости от центральности)
            "thing_itself-phenomenon_internal": 3, // Центральная антиномия Канта
            "res_cogitans-res_extensa_internal": 3, // Центральная проблема Декарта
            "freedom_sartre-bad_faith_internal": 2, // Важная, но не единственная тема
            
            // Средние связи (вес 2) - существенные, но не критичные
            "maieutics-anamnesis": 2,
            "care_soul-tripartite_soul": 2,
            "four_causes-five_ways": 2,
            "impressions-ideas_hume": 2,
            "apriori-phenomenon": 2,
            "master_slave-dialectic": 2,
            
            // Слабые связи (вес 1) - косвенные влияния
            "daimonion-subjective_truth": 1,    // Дальняя связь Сократ → Кьеркегор
            "demiurge-best_worlds": 1,          // Периферийное влияние
            "tripartite_soul-golden_mean": 1,   // Косвенное влияние
            "geworfenheit-original_sin": 1,     // Тематическая параллель, не прямое влияние
            
            // Аристотель
            "act_potency-form": 3,
            "act_potency-matter_ar": 3,
            "act_potency-entelechy": 3,
            "act_potency-essence_existence": 3,  // Ключевое влияние на томизм
            
            // Платон
            "good-ideas": 3,
            "good-eidos": 3,
            "eros-anamnesis": 2,
            "eros-good": 2,
            
            // Гегель
            "dialectic-entfremdung": 2,
            "entfremdung-objective_spirit": 2,
            "entfremdung-alienation": 3,  // Важная историческая связь
            
            // Кант
            "antinomies-thing_itself": 3,
            "antinomies-dialectic": 3,  // Ключевое влияние
            
            // Ницше
            "dionysian-apollonian": 3,  // Центральная оппозиция
            "dionysian-will_power": 2,
            "apollonian-will_power": 2,
            "ressentiment-slave_morality": 3,
            
            // Хайдеггер
            "das_man-dasein": 2,
            
            // Платон: новые веса
            "methexis-eidos": 3,                    // Центральная связь платонизма
            "methexis-cave": 2,
            "mimesis-methexis": 2,
            "chora-demiurge": 2,
            
            // Аристотель: новые веса
            "phronesis-golden_mean": 3,
            "phronesis-virtue_knowledge": 3,        // Развитие сократовской этики
            "eudaimonia-entelechy": 3,
            "logos-form": 3,
            "eudaimonia-categorical": 2,            // Важная критика Кантом
            
            // Фома: новые веса
            "participatio-methexis": 3,             // Ключевое историческое влияние
            "participatio-essence_existence": 3,
            "actual_being-act_potency": 3,
            
            // Спиноза: новые веса
            "natura_naturans-substance_spinoza": 3,
            "natura_naturata-modes": 3,
            "adequate_ideas-intellectual_love": 2,
            
            // Лейбниц: новые веса
            "apperception-monads": 3,
            "apperception-intentionality": 2,       // Важное влияние на феноменологию
            
            // Кант: новые веса
            "sublime-thing_itself": 2,
            "postulates-categorical": 3,
            "aesthetic_judgment-transcendental": 2,
            
            // Фихте: новые веса
            "imagination-absolute_ego": 3,
            "imagination-non_ego": 3,
            "wissenschaftslehre-tathandlung": 2,
            
            // Гегель: новые веса
            "negative-dialectic": 3,                // Центральная концепция
            "negative-aufhebung": 3,
            "concrete-absolute_idea": 2,
            "concrete-abstract": 3,                 // Центральная оппозиция Гегеля
            "abstract-dialectic": 2,
            "abstract-aufhebung": 2,
            
            // Шопенгауэр: новые веса
            "individuation-representation": 3,
            "individuation-will_schop": 2,
            
            // Кьеркегор: новые веса
            "repetition-eternal_return": 2,
            "moment-leap_faith": 3,
            "moment-time_augustine": 2,
            
            // Гуссерль: новые веса
            "noesis_noema-intentionality": 3,       // Центральная структура
            "constitution-transcendental_ego": 3,
            "intersubjectivity-lifeworld": 2,
            
            // Хайдеггер: новые веса
            "ereignis-sein": 3,                     // Поздний Хайдеггер
            "geviert-dwelling": 2,
            "kehre-sein": 2,
            
            // Витгенштейн: новые веса
            "showing_saying-limits_language": 3,    // Tractatus
            "private_language-form_of_life": 3,    // Философские исследования
            "rule_following-language_game": 3,
            
            // Сартр: новые веса
            "project-existence": 3,
            "project-freedom_sartre": 3,
            "engagement-bad_faith": 2,
            
            // Фуко: новые веса
            "panopticon-discipline": 3,             // Знаменитый анализ
            "problematization-archaeology": 2,
            
            // Делёз: новые веса
            "virtual_actual-difference": 3,
            "event-ereignis": 2,
            "fold-body_without_organs": 2
            
        };
        
        // Назначаем веса из relations, если они уже есть
        links.forEach(link => {
            const key = getLinkKey(link);
            const reverseKey = `${typeof link.target === 'string' ? link.target : link.target.id}-${typeof link.source === 'string' ? link.source : link.source.id}`;
            
            // Если вес уже задан в relations, используем его
            if (link.weight) {
                // Ничего не делаем, вес уже установлен
            }
            // Проверяем специфический вес
            else if (specificWeights[key]) {
                link.weight = specificWeights[key];
            } else if (specificWeights[reverseKey] && link.bidirectional) {
                link.weight = specificWeights[reverseKey];
            } else {
                // Вес по умолчанию в зависимости от типа связи
                switch(link.type) {
                    case "ground":
                    case "develop":
                    case "synthesize":
                        link.weight = 2;
                        break;
                    case "internal_contradiction":
                        link.weight = 2;
                        break;
                    case "influence":
                    case "dialogue":
                        link.weight = 1;
                        break;
                    case "oppose":
                    case "critique":
                        link.weight = 2;
                        break;
                    default:
                        link.weight = 2;
                }
            }
        });
        
        // Функция для генерации ключа связи
        function getLinkKey(link) {
            const source = typeof link.source === 'string' ? link.source : link.source.id;
            const target = typeof link.target === 'string' ? link.target : link.target.id;
            return `${source}-${target}`;
        }
        
        // Назначаем веса
        links.forEach(link => {
            const key = getLinkKey(link);
            const reverseKey = `${typeof link.target === 'string' ? link.target : link.target.id}-${typeof link.source === 'string' ? link.source : link.source.id}`;
            
            // Проверяем специфический вес
            if (specificWeights[key]) {
                link.weight = specificWeights[key];
            } else if (specificWeights[reverseKey] && link.bidirectional) {
                link.weight = specificWeights[reverseKey];
            } else {
                // Вес по умолчанию в зависимости от типа связи
                switch(link.type) {
                    case "ground":
                    case "develop":
                    case "synthesize":
                        link.weight = 2; // По умолчанию среднее для этих типов
                        break;
                    case "internal_contradiction":
                        link.weight = 2; // Противоречия обычно важны
                        break;
                    case "influence":
                    case "dialogue":
                        link.weight = 1; // По умолчанию слабое для косвенных влияний
                        break;
                    case "oppose":
                    case "critique":
                        link.weight = 2; // Критика обычно существенна
                        break;
                    default:
                        link.weight = 2;
                }
            }
        });
        
        // Дополнительная логика: усиливаем веса для связей внутри одного философа
        links.forEach(link => {
            const sourceNode = nodes.find(n => n.id === (typeof link.source === 'string' ? link.source : link.source.id));
            const targetNode = nodes.find(n => n.id === (typeof link.target === 'string' ? link.target : link.target.id));
            
            // Если связь внутри системы одного философа и это ground/synthesize
            if (sourceNode && targetNode && 
                sourceNode.concept === targetNode.concept && 
                (link.type === "ground" || link.type === "synthesize")) {
                // Увеличиваем вес на 1, но не больше 3
                link.weight = Math.min(link.weight + 1, 3);
            }
        });
        
        // Состояние фильтров
        let selectedPhilosophers = new Set(Object.keys(philosopherConcepts));
        let selectedRelations = new Set(Object.keys(relationTypesObj));
        
        // Режимы фильтрации: 'all' - только выбранные, 'internal' - только внутренние, 'context' - с соседними
        let filterMode = 'all';
        
        // Инициализация селектов для поиска пути
        function initPathFinder() {
            const sourceSelect = document.getElementById('sourceSelect');
            const targetSelect = document.getElementById('targetSelect');
            
            nodes.forEach(node => {
                const option1 = document.createElement('option');
                option1.value = node.id;
                option1.textContent = `${node.label} (${node.concept})`;
                sourceSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = node.id;
                option2.textContent = `${node.label} (${node.concept})`;
                targetSelect.appendChild(option2);
            });
        }
        
        // Поиск кратчайшего пути между двумя концепциями (BFS)
        function findShortestPath(sourceId, targetId, respectChronology = true, respectDirection = true) {
            if (sourceId === targetId) return [sourceId];
            
            const queue = [[sourceId]];
            const visited = new Set([sourceId]);
            
            // Создаем граф смежности
            const adjacency = {};
            nodes.forEach(n => adjacency[n.id] = []);
            
            links.forEach(l => {
                const src = l.source.id || l.source;
                const tgt = l.target.id || l.target;
                
                if (respectDirection) {
                    // Учитываем направленность связей
                    adjacency[src].push(tgt);
                    if (l.bidirectional) {
                        adjacency[tgt].push(src);
                    }
                } else {
                    // Игнорируем направленность - граф становится неориентированным
                    adjacency[src].push(tgt);
                    adjacency[tgt].push(src);
                }
            });
            
            while (queue.length > 0) {
                const path = queue.shift();
                const currentNodeId = path[path.length - 1];
                
                if (currentNodeId === targetId) {
                    return path;
                }
                
                const neighbors = adjacency[currentNodeId] || [];
                for (const neighborId of neighbors) {
                    if (!visited.has(neighborId)) {
                        // Проверка хронологии
                        if (respectChronology) {
                            const currentNode = nodes.find(n => n.id === currentNodeId);
                            const nextNode = nodes.find(n => n.id === neighborId);
                            
                            const currentYear = philosopherOrder[currentNode.concept];
                            const nextYear = philosopherOrder[nextNode.concept];
                            
                            // Разрешаем переход только вперёд во времени или к современникам (±50 лет)
                            if (nextYear < currentYear - 50) {
                                continue; // Пропускаем переход "в прошлое"
                            }
                        }
                        
                        visited.add(neighborId);
                        queue.push([...path, neighborId]);
                    }
                }
            }
            
            return null; // Путь не найден
        }
        
        // Функция для отображения найденного пути
        function findAndShowPath() {
            const sourceId = document.getElementById('sourceSelect').value;
            const targetId = document.getElementById('targetSelect').value;
            const resultDiv = document.getElementById('pathResult');
            
            const respectChronology = document.getElementById('respectChronology').checked;
            const respectDirection = document.getElementById('respectDirection').checked;
            
            if (!sourceId || !targetId) {
                alert('Выберите обе концепции');
                return;
            }
            
            if (sourceId === targetId) {
                alert('Выберите разные концепции');
                return;
            }
            
            const path = findShortestPath(sourceId, targetId, respectChronology, respectDirection);
            
            if (!path) {
                const sourceNode = nodes.find(n => n.id === sourceId);
                const targetNode = nodes.find(n => n.id === targetId);
                
                let message = 'Эти концепции не связаны';
                if (respectChronology && respectDirection) {
                    message += ' хронологически корректным путём с учётом направленности связей.';
                } else if (respectChronology) {
                    message += ' хронологически корректным путём.';
                } else if (respectDirection) {
                    message += ' с учётом направленности связей.';
                } else {
                    message += ' в графе.';
                }
                
                resultDiv.innerHTML = `
                    <div class="path-length">❌ Путь не найден</div>
                    <div class="path-chain">${message}<br><br>
                    <small style="color: #95a5a6;">Попробуйте снять ограничения ниже.</small></div>
                    <button onclick="clearPathHighlight()" style="width: 100%; margin-top: 10px; background: #95a5a6; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        Очистить
                    </button>
                `;
                resultDiv.classList.add('show');
                resetHighlight();
                return;
            }
            
            // Формируем визуальное представление пути
            const pathNodes = path.map(id => nodes.find(n => n.id === id));
            
            // Создаём HTML с узлами и стрелками
            let pathHTML = '';
            
            for (let i = 0; i < pathNodes.length; i++) {
                const node = pathNodes[i];
                const philosopherColor = philosopherConcepts[node.concept].color;
                
                // Добавляем узел с философом
                pathHTML += `
                    <span class="path-node-container">
                        <span class="path-philosopher">${node.concept}</span>
                        <span class="path-node" style="border-color: ${philosopherColor};" title="${node.concept}: ${node.description}">
                            ${node.label}
                        </span>
                    </span>
                `;
                
                // Добавляем стрелку, если это не последний узел
                if (i < pathNodes.length - 1) {
                    const currentNode = pathNodes[i];
                    const nextNode = pathNodes[i + 1];
                    
                    // Находим связь между текущим и следующим узлом
                    const link = links.find(l => {
                        const src = l.source.id || l.source;
                        const tgt = l.target.id || l.target;
                        
                        if (respectDirection) {
                            return (src === currentNode.id && tgt === nextNode.id) ||
                                   (l.bidirectional && src === nextNode.id && tgt === currentNode.id);
                        } else {
                            return (src === currentNode.id && tgt === nextNode.id) ||
                                   (src === nextNode.id && tgt === currentNode.id);
                        }
                    });
                    
                    if (link) {
                        const linkColor = relationTypesObj[link.type].color;
                        const linkLabel = relationTypesObj[link.type].label;
                        const src = link.source.id || link.source;
                        const tgt = link.target.id || link.target;
                        
                        // Определяем направление стрелки
                        let arrow;
                        if (link.bidirectional) {
                            arrow = '↔';
                        } else if (src === currentNode.id && tgt === nextNode.id) {
                            arrow = '→';
                        } else {
                            arrow = '←';
                        }
                        
                        pathHTML += `
                            <span class="path-arrow ${link.bidirectional ? 'bidirectional' : ''}" 
                                  style="color: ${linkColor};" 
                                  title="${linkLabel}">
                                ${arrow}
                            </span>
                        `;
                    } else {
                        // Если связь не найдена (не должно происходить)
                        pathHTML += `<span class="path-arrow" style="color: #95a5a6;">→</span>`;
                    }
                }
            }
            
            // Добавляем информацию о хронологии
            const years = pathNodes.map(n => philosopherConcepts[n.concept].years);
            const chronologyInfo = respectChronology ? 
                `<div style="margin-top: 8px; font-size: 10px; color: #7f8c8d;">
                    Хронология: ${years[0]} → ${years[years.length - 1]}
                </div>` : '';
            
            resultDiv.innerHTML = `
                <div class="path-length">✅ Длина пути: ${path.length} концепций</div>
                <div class="path-chain" style="line-height: 2;">${pathHTML}</div>
                ${chronologyInfo}
                <button onclick="clearPathHighlight()" style="width: 100%; margin-top: 10px; background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: background 0.3s;" onmouseover="this.style.background='#c0392b'" onmouseout="this.style.background='#e74c3c'">
                    🔄 Сбросить подсветку
                </button>
            `;
            resultDiv.classList.add('show');
            
            // Подсвечиваем путь на графе
            highlightPath(path, respectDirection);
        }
        
        // Подсветка пути на графе
        function highlightPath(path, respectDirection = true) {
            resetHighlight();
            
            const pathSet = new Set(path);
            const pathLinks = new Set();
            
            // Находим связи, которые входят в путь
            for (let i = 0; i < path.length - 1; i++) {
                const currentNode = path[i];
                const nextNode = path[i + 1];
                
                const link = links.find(l => {
                    const src = l.source.id || l.source;
                    const tgt = l.target.id || l.target;
                    
                    if (respectDirection) {
                        // Учитываем направленность: ищем связь в прямом направлении или bidirectional
                        return (src === currentNode && tgt === nextNode) ||
                               (l.bidirectional && src === nextNode && tgt === currentNode);
                    } else {
                        // Не учитываем направленность: любая связь между этими узлами подходит
                        return (src === currentNode && tgt === nextNode) ||
                               (src === nextNode && tgt === currentNode);
                    }
                });
                
                if (link) pathLinks.add(link);
            }
            
            // Применяем стили
            node.classed("dimmed", d => !pathSet.has(d.id))
                .classed("highlighted", d => pathSet.has(d.id));
            
            link.classed("dimmed", l => !pathLinks.has(l))
                .classed("path-highlight", l => pathLinks.has(l));
        }
        
        // Очистка подсветки пути
        function clearPathHighlight() {
            resetHighlight();
            const resultDiv = document.getElementById('pathResult');
            resultDiv.classList.remove('show');
            resultDiv.innerHTML = '';
        }
        
        // Инициализация фильтров
        function initFilters() {
            // Создаем фильтры философов
            const philContainer = document.getElementById('philosopherFilters');
            Object.entries(philosopherConcepts).forEach(([name, data]) => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <input type="checkbox" id="phil-${name}" checked onchange="togglePhilosopher('${name}')">
                    <label for="phil-${name}">
                        <div class="legend-color" style="background: ${data.color}"></div>
                        <span>${name}<small style="color: #95a5a6; font-size: 9px;"> (${data.years})</small></span>
                    </label>
                `;
                philContainer.appendChild(item);
            });
        
            // Создаем фильтры связей (без изменений)
            const relContainer = document.getElementById('relationFilters');
            Object.entries(relationTypesObj).forEach(([type, typeData]) => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <input type="checkbox" id="rel-${type}" checked onchange="toggleRelation('${type}')">
                    <label for="rel-${type}">
                        <div class="legend-line" style="background: ${typeData.color}"></div>
                        <span>${typeData.label}</span>
                    </label>
                `;
                relContainer.appendChild(item);
            });
        }
        
        // Переключение философа
        function togglePhilosopher(philosopher) {
            if (selectedPhilosophers.has(philosopher)) {
                selectedPhilosophers.delete(philosopher);
            } else {
                selectedPhilosophers.add(philosopher);
            }
            applyFilters();
        }
        
        // Переключение типа связи
        function toggleRelation(relationType) {
            if (selectedRelations.has(relationType)) {
                selectedRelations.delete(relationType);
            } else {
                selectedRelations.add(relationType);
            }
            applyFilters();
        }
        
        // Выбрать всех философов
        function selectAllPhilosophers() {
            selectedPhilosophers = new Set(Object.keys(philosopherConcepts));
            Object.keys(philosopherConcepts).forEach(name => {
                document.getElementById(`phil-${name}`).checked = true;
            });
            applyFilters();
        }
        
        // Снять всех философов
        function deselectAllPhilosophers() {
            selectedPhilosophers.clear();
            Object.keys(philosopherConcepts).forEach(name => {
                document.getElementById(`phil-${name}`).checked = false;
            });
            applyFilters();
        }
        
        // Выбрать все связи
        function selectAllRelations() {
            selectedRelations = new Set(Object.keys(relationTypesObj));
            Object.keys(relationTypesObj).forEach(type => {
                document.getElementById(`rel-${type}`).checked = true;
            });
            applyFilters();
        }
        
        // Снять все связи
        function deselectAllRelations() {
            selectedRelations.clear();
            Object.keys(relationTypesObj).forEach(type => {
                document.getElementById(`rel-${type}`).checked = false;
            });
            applyFilters();
        }
        
        // Переключение режима фильтрации
        function changeFilterMode(mode) {
            filterMode = mode;
            applyFilters();
        }
        
        // Применение фильтров с взаимосвязанной логикой
        function applyFilters() {
            const allRelationsSelected = selectedRelations.size === Object.keys(relationTypesObj).length;
            
            if (filterMode === 'all') {
                // Режим 1: Только выбранные философы
                // Связи, где ОБА узла принадлежат выбранным философам
                const validLinks = links.filter(l => {
                    const typeSelected = selectedRelations.has(l.type);
                    const sourcePhilosopherSelected = selectedPhilosophers.has(l.source.concept);
                    const targetPhilosopherSelected = selectedPhilosophers.has(l.target.concept);
                    return typeSelected && sourcePhilosopherSelected && targetPhilosopherSelected;
                });
                
                const nodesInValidLinks = new Set();
                validLinks.forEach(l => {
                    nodesInValidLinks.add(l.source.id || l.source);
                    nodesInValidLinks.add(l.target.id || l.target);
                });
                
                node.style("display", d => {
                    const philosopherSelected = selectedPhilosophers.has(d.concept);
                    const inValidLinks = allRelationsSelected || nodesInValidLinks.has(d.id);
                    return (philosopherSelected && inValidLinks) ? null : "none";
                });
                
                link.style("display", l => {
                    const typeSelected = selectedRelations.has(l.type);
                    const sourcePhilosopherSelected = selectedPhilosophers.has(l.source.concept);
                    const targetPhilosopherSelected = selectedPhilosophers.has(l.target.concept);
                    const sourceInValidLinks = allRelationsSelected || nodesInValidLinks.has(l.source.id);
                    const targetInValidLinks = allRelationsSelected || nodesInValidLinks.has(l.target.id);
                    
                    return (typeSelected && sourcePhilosopherSelected && targetPhilosopherSelected && 
                            sourceInValidLinks && targetInValidLinks) ? null : "none";
                });
                
            } else if (filterMode === 'internal') {
                // Режим 2: Только внутренние связи
                // Связи, где оба узла от ОДНОГО философа из выбранных
                const validLinks = links.filter(l => {
                    const typeSelected = selectedRelations.has(l.type);
                    const sourcePhilosopherSelected = selectedPhilosophers.has(l.source.concept);
                    const targetPhilosopherSelected = selectedPhilosophers.has(l.target.concept);
                    const samePhilosopher = l.source.concept === l.target.concept;
                    return typeSelected && sourcePhilosopherSelected && targetPhilosopherSelected && samePhilosopher;
                });
                
                const nodesInValidLinks = new Set();
                validLinks.forEach(l => {
                    nodesInValidLinks.add(l.source.id || l.source);
                    nodesInValidLinks.add(l.target.id || l.target);
                });
                
                node.style("display", d => {
                    const philosopherSelected = selectedPhilosophers.has(d.concept);
                    const inValidLinks = allRelationsSelected || nodesInValidLinks.has(d.id);
                    return (philosopherSelected && inValidLinks) ? null : "none";
                });
                
                link.style("display", l => {
                    const typeSelected = selectedRelations.has(l.type);
                    const sourcePhilosopherSelected = selectedPhilosophers.has(l.source.concept);
                    const targetPhilosopherSelected = selectedPhilosophers.has(l.target.concept);
                    const samePhilosopher = l.source.concept === l.target.concept;
                    const sourceInValidLinks = allRelationsSelected || nodesInValidLinks.has(l.source.id);
                    const targetInValidLinks = allRelationsSelected || nodesInValidLinks.has(l.target.id);
                    
                    return (typeSelected && sourcePhilosopherSelected && targetPhilosopherSelected && 
                            samePhilosopher && sourceInValidLinks && targetInValidLinks) ? null : "none";
                });
                
            } else if (filterMode === 'context') {
                // Режим 3: С соседними узлами
                // Показываем выбранных философов + все узлы, с которыми они связаны
                
                // Сначала находим все связи, где хотя бы ОДИН конец - выбранный философ
                const validLinks = links.filter(l => {
                    const typeSelected = selectedRelations.has(l.type);
                    const sourcePhilosopherSelected = selectedPhilosophers.has(l.source.concept);
                    const targetPhilosopherSelected = selectedPhilosophers.has(l.target.concept);
                    // Связь валидна, если хотя бы один конец принадлежит выбранному философу
                    return typeSelected && (sourcePhilosopherSelected || targetPhilosopherSelected);
                });
                
                // Собираем все узлы, участвующие в этих связях (включая "соседей")
                const visibleNodes = new Set();
                validLinks.forEach(l => {
                    visibleNodes.add(l.source.id || l.source);
                    visibleNodes.add(l.target.id || l.target);
                });
                
                // Показываем все узлы, которые участвуют в валидных связях
                node.style("display", d => {
                    return visibleNodes.has(d.id) ? null : "none";
                });
                
                // Показываем все валидные связи
                link.style("display", l => {
                    const typeSelected = selectedRelations.has(l.type);
                    const sourcePhilosopherSelected = selectedPhilosophers.has(l.source.concept);
                    const targetPhilosopherSelected = selectedPhilosophers.has(l.target.concept);
                    const sourceVisible = visibleNodes.has(l.source.id);
                    const targetVisible = visibleNodes.has(l.target.id);
                    
                    return (typeSelected && (sourcePhilosopherSelected || targetPhilosopherSelected) && 
                            sourceVisible && targetVisible) ? null : "none";
                });
            }
            
            // Обновляем статистику
            updateFilterStats();
            
            // Сбрасываем подсветку для скрытых узлов
            const visibleNodeIds = new Set();
            node.each(function(d) {
                if (this.style.display !== "none") {
                    visibleNodeIds.add(d.id);
                }
            });
            
            selectedNodes.forEach(node => {
                if (!visibleNodeIds.has(node.id)) {
                    selectedNodes.delete(node);
                }
            });
        
            if (selectedNodes.size === 0) {
                resetHighlight();
            } else {
                highlightConnected(Array.from(selectedNodes));
            }
        }
        // Обновление статистики фильтров
        function updateFilterStats() {
            let visibleNodesCount = 0;
            let visibleLinksCount = 0;
            
            node.each(function() {
                if (this.style.display !== "none") visibleNodesCount++;
            });
            
            link.each(function() {
                if (this.style.display !== "none") visibleLinksCount++;
            });
            
            const totalNodes = nodes.length;
            const totalLinks = links.length;
            
            document.getElementById('filterStats').textContent = 
                `Показано: ${visibleNodesCount}/${totalNodes} концепций, ${visibleLinksCount}/${totalLinks} связей`;
        }
        
        // Расчет влиятельности концепций (degree centrality)
        function calculateInfluence() {
            const influence = {};
            
            nodes.forEach(n => {
                influence[n.id] = { in: 0, out: 0, total: 0, node: n };
            });
            
            links.forEach(l => {
                const src = l.source.id || l.source;
                const tgt = l.target.id || l.target;
                influence[src].out++;
                influence[tgt].in++;
                if (l.bidirectional) {
                    influence[src].in++;
                    influence[tgt].out++;
                }
            });
            
            Object.values(influence).forEach(i => {
                i.total = i.in + i.out;
            });
            
            return Object.values(influence).sort((a, b) => b.total - a.total);
        }
        
        // Расчет узлов-мостов (betweenness centrality - упрощенная версия)
        function calculateBetweenness() {
            const betweenness = {};
            nodes.forEach(n => betweenness[n.id] = { count: 0, node: n });
            
            // Для каждой пары узлов находим кратчайшие пути
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    const path = findShortestPath(nodes[i].id, nodes[j].id);
                    if (path && path.length > 2) {
                        // Увеличиваем счетчик для промежуточных узлов
                        for (let k = 1; k < path.length - 1; k++) {
                            betweenness[path[k]].count++;
                        }
                    }
                }
            }
            
            return Object.values(betweenness)
                .filter(b => b.count > 0)
                .sort((a, b) => b.count - a.count);
        }
        
        // Отображение статистики
        function displayStatistics() {
            const influence = calculateInfluence();
            const betweenness = calculateBetweenness();
            
            // Топ-10 влиятельных концепций
            const topConceptsDiv = document.getElementById('topConcepts');
            topConceptsDiv.innerHTML = influence.slice(0, 10).map((item, index) => `
                <div class="stat-item" onclick="highlightNodeById('${item.node.id}')">
                    <span class="stat-rank">${index + 1}.</span>
                    <span class="stat-name">${item.node.label}</span>
                    <span class="stat-value">${item.total}</span>
                    <span class="stat-philosopher">${item.node.concept}</span>
                </div>
            `).join('');
            
            // Топ-10 узлов-мостов
            const bridgeNodesDiv = document.getElementById('bridgeNodes');
            if (betweenness.length > 0) {
                bridgeNodesDiv.innerHTML = betweenness.slice(0, 10).map((item, index) => `
                    <div class="stat-item" onclick="highlightNodeById('${item.node.id}')">
                        <span class="stat-rank">${index + 1}.</span>
                        <span class="stat-name">${item.node.label}</span>
                        <span class="stat-value">${item.count}</span>
                        <span class="stat-philosopher">${item.node.concept}</span>
                    </div>
                `).join('');
            } else {
                bridgeNodesDiv.innerHTML = '<div style="font-size: 11px; color: #95a5a6; font-style: italic;">Вычисление...</div>';
            }
        }
        
        // Подсветка узла по ID
        function highlightNodeById(nodeId) {
            const nodeData = nodes.find(n => n.id === nodeId);
            if (nodeData) {
                selectedNodes.clear();
                selectedNodes.add(nodeData);
                highlightConnected([nodeData]);
                
                // Центрируем на узле
                const nodeElement = node.filter(d => d.id === nodeId);
                if (nodeElement.size() > 0) {
                    const d = nodeElement.datum();
                    const transform = d3.zoomIdentity
                        .translate(width / 2 - d.x, height / 2 - d.y)
                        .scale(1.5);
                    svg.transition().duration(750).call(zoom.transform, transform);
                }
            }
        }
        
        // Экспорт в PNG
        function exportToPNG() {
            const svgElement = document.getElementById('graph');
            const svgClone = svgElement.cloneNode(true);
            
            // Получаем текущий transform от zoom
            const gElement = svgClone.querySelector('g');
            const transform = g.attr('transform');
            if (transform) {
                gElement.setAttribute('transform', transform);
            }
            
            // Применяем инлайн-стили к тексту
            const textElements = svgClone.querySelectorAll('text');
            textElements.forEach(text => {
                text.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                text.style.fontSize = '10px';
                text.style.fontWeight = '600';
                text.style.fill = '#fff';
                text.style.textShadow = '0 0 4px black';
            });
            
            // Применяем инлайн-стили к узлам
            const circles = svgClone.querySelectorAll('circle');
            circles.forEach(circle => {
                const computedStyle = window.getComputedStyle(circle);
                circle.style.strokeWidth = '3px';
                circle.style.filter = 'drop-shadow(0 0 10px rgba(255,255,255,0.4))';
            });
            
            // Применяем инлайн-стили к связям
            const paths = svgClone.querySelectorAll('path.link');
            paths.forEach(path => {
                path.style.fill = 'none';
                const computedStyle = window.getComputedStyle(path);
                path.style.stroke = computedStyle.stroke;
                path.style.strokeWidth = computedStyle.strokeWidth;
                path.style.opacity = computedStyle.opacity;
            });
            
            // Увеличиваем разрешение для лучшего качества
            const scale = 2;
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = width * scale;
            canvas.height = height * scale;
            ctx.scale(scale, scale);
            
            const svgData = new XMLSerializer().serializeToString(svgClone);
            const img = new Image();
            
            img.onload = function() {
                // Рисуем фон
                ctx.fillStyle = '#0f0c29';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Рисуем SVG
                ctx.drawImage(img, 0, 0, width, height);
                
                // Конвертируем в PNG
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = 'philosophy-graph.png';
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                }, 'image/png');
            };
            
            img.onerror = function(e) {
                console.error('Ошибка загрузки изображения:', e);
                alert('Ошибка при экспорте. Попробуйте использовать экспорт в SVG.');
            };
            
            // Кодируем SVG данные
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            img.src = url;
        }
        
        // Экспорт в SVG
        function exportToSVG() {
            const svgElement = document.getElementById('graph');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            
            const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.download = 'philosophy-graph.svg';
            link.href = url;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        const width = window.innerWidth;
        const height = window.innerHeight;
        
        const svg = d3.select("#graph")
            .attr("width", width)
            .attr("height", height);

        // Контейнер для масштабирования и прокрутки
        const g = svg.append("g");

        // Настройка zoom
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // Клик на фон для сброса подсветки
        svg.on("click", function(event) {
            if (event.target === this) {
                resetHighlight();
            }
        });

        const defs = svg.append("defs");
        
        Object.keys(relationTypesObj).forEach(type => {
            defs.append("marker")
                .attr("id", `arrow-${type}`)
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 26)
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("fill", relationTypesObj[type].color);
            // Специальный маркер для внутренних противоречий
            defs.append("marker")
                .attr("id", "arrow-internal_contradiction")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 26)
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("fill", relationTypesObj["internal_contradiction"].color);
            
        });

        let simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(160))
            .force("charge", d3.forceManyBody().strength(-350))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(45));

        // Позиции для группировки по философам
        const philosopherNames = Object.keys(philosopherConcepts);
        const groupPositions = {};
        const cols = 6;
        const rows = Math.ceil(philosopherNames.length / cols);
        const spacingX = width / (cols + 1);
        const spacingY = height / (rows + 1);

        philosopherNames.forEach((phil, i) => {
            const col = i % cols;
            const row = Math.floor(i / cols);
            groupPositions[phil] = {
                x: spacingX * (col + 1),
                y: spacingY * (row + 1)
            };
        });

        let isGrouped = false;
        let selectedNodes = new Set(); // Множество выбранных узлов

        const link = g.append("g")
            .selectAll("path")
            .data(links)
            .enter()
            .append("path")
            .attr("class", d => {
                let classes = "link";
                if (d.bidirectional) classes += " bidirectional";
                if (d.type === "internal_contradiction") classes += " internal-contradiction";
                
                // Добавляем класс веса
                if (d.weight === 1) classes += " weight-weak";
                else if (d.weight === 2) classes += " weight-medium";
                else if (d.weight === 3) classes += " weight-strong";
                
                return classes;
            })
            .attr("stroke", d => relationTypesObj[d.type].color)
            .attr("marker-end", d => `url(#arrow-${d.type})`);

        const node = g.append("g")
            .selectAll("g")
            .data(nodes)
            .enter()
            .append("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        node.append("circle")
            .attr("r", 18)
            .attr("fill", d => philosopherConcepts[d.concept].color)
            .attr("stroke", "#fff");

        node.append("text")
            .attr("dy", -25)
            .attr("text-anchor", "middle")
            .text(d => d.label);

        // Обработка клика на узле
        let clickTimer = null;
        let clickCount = 0;
        
        node.on("click", function(event, d) {
            event.stopPropagation();
            
            clickCount++;
            
            if (clickCount === 1) {
                // Первый клик - ждём, будет ли второй
                clickTimer = setTimeout(() => {
                    // Одинарный клик - подсветка связей
                    if (event.ctrlKey || event.metaKey) {
                        // Ctrl зажат - множественный выбор
                        if (selectedNodes.has(d)) {
                            selectedNodes.delete(d);
                        } else {
                            selectedNodes.add(d);
                        }
                    } else {
                        // Ctrl не зажат - одиночный выбор
                        if (selectedNodes.size === 1 && selectedNodes.has(d)) {
                            selectedNodes.clear();
                        } else {
                            selectedNodes.clear();
                            selectedNodes.add(d);
                        }
                    }
                    
                    if (selectedNodes.size > 0) {
                        highlightConnected(Array.from(selectedNodes));
                    } else {
                        resetHighlight();
                    }
                    clickCount = 0;
                }, 300);
            } else if (clickCount === 2) {
                // Двойной клик - показываем детальную информацию
                clearTimeout(clickTimer);
                showDetailModal(d);
                clickCount = 0;
            }
        });

        // Подсветка связанных узлов и связей
        function highlightConnected(selectedDataArray) {
            const connectedNodes = new Set();
            const connectedLinks = new Set();
            
            // Обрабатываем каждый выбранный узел
            selectedDataArray.forEach(selectedData => {
                connectedNodes.add(selectedData.id);
                
                // Находим все связанные узлы и связи
                links.forEach(l => {
                    if (l.source.id === selectedData.id) {
                        connectedNodes.add(l.target.id);
                        connectedLinks.add(l);
                    } else if (l.target.id === selectedData.id) {
                        connectedNodes.add(l.source.id);
                        connectedLinks.add(l);
                    }
                });
            });
            
            // Применяем стили только к видимым элементам
            node.each(function(d) {
                const element = d3.select(this);
                if (element.style("display") !== "none") {
                    const isSelected = selectedDataArray.some(sd => sd.id === d.id);
                    element.classed("dimmed", !connectedNodes.has(d.id))
                           .classed("highlighted", connectedNodes.has(d.id))
                           .classed("selected", isSelected);
                }
            });
            
            link.each(function(l) {
                const element = d3.select(this);
                if (element.style("display") !== "none") {
                    element.classed("dimmed", !connectedLinks.has(l))
                           .classed("highlighted", connectedLinks.has(l))
                           .classed("path-highlight", false);
                }
            });
        }

        // Сброс подсветки
        function resetHighlight() {
            selectedNodes.clear();
            node.classed("dimmed", false)
                .classed("highlighted", false)
                .classed("selected", false);
            link.classed("dimmed", false)
                .classed("highlighted", false)
                .classed("path-highlight", false);
        }

        // Управление сворачиванием панелей
        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            const isCollapsed = panel.classList.contains('collapsed');
            
            if (isCollapsed) {
                panel.classList.remove('collapsed');
                // Меняем иконку на минус
                const btn = panel.querySelector('.collapse-btn .expand-icon');
                btn.textContent = '−';
                // Сохраняем состояние
                localStorage.setItem(`${panelId}_collapsed`, 'false');
            } else {
                panel.classList.add('collapsed');
                // Меняем иконку на плюс
                const btn = panel.querySelector('.collapse-btn .expand-icon');
                btn.textContent = '+';
                // Сохраняем состояние
                localStorage.setItem(`${panelId}_collapsed`, 'true');
            }
        }
        
        // Восстановление состояния панелей при загрузке
        function restorePanelStates() {
            const panels = ['pathFinder', 'statsPanel'];
            
            panels.forEach(panelId => {
                const collapsed = localStorage.getItem(`${panelId}_collapsed`) === 'true';
                if (collapsed) {
                    const panel = document.getElementById(panelId);
                    panel.classList.add('collapsed');
                    const btn = panel.querySelector('.collapse-btn .expand-icon');
                    if (btn) btn.textContent = '+';
                }
            });
        }

        // Tooltip
        // Tooltip
        const tooltip = d3.select("#tooltip");

        node.on("mouseover", function(event, d) {
            tooltip
                .style("opacity", 1)
                .html(`<strong>${d.label}</strong><br/>${d.description}<br/><em>${d.concept}</em>`)
                .style("left", (event.pageX + 15) + "px")
                .style("top", (event.pageY - 15) + "px");
        })
        .on("mouseout", function() {
            tooltip.style("opacity", 0);
        });

        link.on("mouseover", function(event, d) {
            const sourceNode = nodes.find(n => n.id === d.source.id);
            const targetNode = nodes.find(n => n.id === d.target.id);
            const direction = d.bidirectional ? "↔" : "→";
            tooltip
                .style("opacity", 1)
                .html(`<strong>${relationTypesObj[d.type].label}</strong><br/>${sourceNode.label} ${direction} ${targetNode.label}`)
                .style("left", (event.pageX + 15) + "px")
                .style("top", (event.pageY - 15) + "px");
        })
        .on("mouseout", function() {
            tooltip.style("opacity", 0);
        });

        simulation.on("tick", () => {
            link.attr("d", d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                const dr = Math.sqrt(dx * dx + dy * dy) * 1.5;
                return `M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`;
            });

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function resetSimulation() {
            nodes.forEach(n => {
                n.fx = null;
                n.fy = null;
            });
            resetHighlight();
            simulation.alpha(1).restart();
        }

        function centerGraph() {
            const transform = d3.zoomIdentity
                .translate(window.innerWidth / 2, window.innerHeight / 2)
                .scale(1);
            svg.transition().duration(750).call(zoom.transform, transform);
            simulation.force("center", d3.forceCenter(window.innerWidth / 2, window.innerHeight / 2));
            simulation.alpha(0.3).restart();
        }

        function toggleGrouping() {
            isGrouped = !isGrouped;
            const btn = document.getElementById('groupBtn');
            
            resetHighlight();
            
            if (isGrouped) {
                btn.classList.add('active');
                btn.textContent = '📦 Разгруппировать';
                
                // Добавляем силы группировки
                simulation
                    .force("x", d3.forceX(d => groupPositions[d.concept].x).strength(0.3))
                    .force("y", d3.forceY(d => groupPositions[d.concept].y).strength(0.3))
                    .force("charge", d3.forceManyBody().strength(-200))
                    .force("collision", d3.forceCollide().radius(40));
            } else {
                btn.classList.remove('active');
                btn.textContent = '📦 Группировать';
                
                // Убираем силы группировки
                simulation
                    .force("x", null)
                    .force("y", null)
                    .force("charge", d3.forceManyBody().strength(-350))
                    .force("collision", d3.forceCollide().radius(45))
                    .force("center", d3.forceCenter(window.innerWidth / 2, window.innerHeight / 2));
            }
            
            simulation.alpha(0.5).restart();
        }

        window.addEventListener('resize', () => {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight;
            svg.attr("width", newWidth).attr("height", newHeight);
            
            // Пересчитываем позиции групп
            const newSpacingX = newWidth / (cols + 1);
            const newSpacingY = newHeight / (rows + 1);
            philosopherNames.forEach((phil, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);
                groupPositions[phil] = {
                    x: newSpacingX * (col + 1),
                    y: newSpacingY * (row + 1)
                };
            });
            
            if (isGrouped) {
                simulation
                    .force("x", d3.forceX(d => groupPositions[d.concept].x).strength(0.3))
                    .force("y", d3.forceY(d => groupPositions[d.concept].y).strength(0.3));
            } else {
                simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
            }
            
            simulation.alpha(0.3).restart();
        });
        
        function showDetailModal(conceptData) {
            const modal = document.getElementById('detailModal');
            const overlay = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            // Получаем рубрики этой концепции
            const conceptRubrics = conceptToRubrics[conceptData.id] || [];
            
            let html = `
                <h2>${conceptData.label}</h2>
                <div class="philosopher-tag" style="background: ${philosopherConcepts[conceptData.concept].color}">
                    ${conceptData.concept}
                </div>
                <div class="description">${conceptData.description}</div>
            `;
            
            if (conceptRubrics.length > 0) {
                // Находим данные рубрик
                const rubricDataArray = conceptRubrics.map(rubricId => 
                    rubrics.find(r => r.id === rubricId)
                ).filter(r => r !== undefined);
                
                rubricDataArray.forEach(rubricData => {
                    // Находим другие концепции из той же рубрики
                    const relatedConcepts = nodes.filter(n => {
                        const nRubrics = conceptToRubrics[n.id] || [];
                        return nRubrics.includes(rubricData.id) && n.id !== conceptData.id;
                    });
                    
                    html += `
                        <div class="rubric-section">
                            <div class="rubric-title">📚 Рубрика: ${rubricData.name}</div>
                            <div class="rubric-description">${rubricData.description}</div>
                            
                            ${relatedConcepts.length > 0 ? `
                                <div class="related-concepts">
                                    <div class="related-title">Также в этой рубрике (${relatedConcepts.length}):</div>
                                    ${relatedConcepts.slice(0, 10).map(c => `
                                        <div class="concept-item" onclick="closeDetailModal(); setTimeout(() => showDetailModal(nodes.find(n => n.id === '${c.id}')), 100);">
                                            <div class="concept-color" style="background: ${philosopherConcepts[c.concept].color}"></div>
                                            <div class="concept-name">${c.label}</div>
                                            <div class="concept-philosopher">${c.concept}</div>
                                        </div>
                                    `).join('')}
                                    ${relatedConcepts.length > 10 ? `<div style="font-size: 10px; color: #95a5a6; margin-top: 8px;">и ещё ${relatedConcepts.length - 10}...</div>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
            } else {
                html += `<div class="rubric-section">
                    <div class="rubric-description" style="color: #95a5a6;">
                        Эта концепция пока не отнесена к какой-либо рубрике.
                    </div>
                </div>`;
            }
            
            content.innerHTML = html;
            modal.classList.add('show');
            overlay.classList.add('show');
        }
        
        function closeDetailModal() {
            const modal = document.getElementById('detailModal');
            const overlay = document.getElementById('modalOverlay');
            modal.classList.remove('show');
            overlay.classList.remove('show');
        }
        
        // Закрытие по клику на overlay
        document.getElementById('modalOverlay').addEventListener('click', closeDetailModal);
        
        // Закрытие по Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeDetailModal();
            }
        });
        
        // Инициализируем фильтры при загрузке
        initFilters();
        updateFilterStats();
        
        // Инициализируем новые функции
        initPathFinder();
        displayStatistics();
        
        // Восстанавливаем состояние панелей
        restorePanelStates();
        
        // Обновляем статистику после завершения симуляции
        simulation.on("end", () => {
            setTimeout(() => {
                displayStatistics();
            }, 500);
        });
        
    </script>
</body>
</html>
