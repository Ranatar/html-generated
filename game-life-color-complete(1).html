<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¶–≤–µ—Ç–Ω–∞—è –ò–≥—Ä–∞ "–ñ–∏–∑–Ω—å"</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: #fff;
            overflow-x: hidden;
        }

        h1 {
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-align: center;
        }

        .description {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            max-width: 1400px;
            backdrop-filter: blur(10px);
        }

        .container {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 1400px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        /* –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è canvas */
        .game-canvas-wrapper {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        canvas {
            border: 3px solid #333;
            border-radius: 5px;
            cursor: crosshair;
            display: block;
            background: #000;
            width: 100%;
            height: auto;
            max-width: 100%;
        }

        /* –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls-wrapper {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            align-items: center;
        }

        button {
            padding: 8px 16px;
            font-size: 13px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        button.danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        button.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        button.active {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            box-shadow: 0 0 20px rgba(0,176,155,0.5);
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(102, 126, 234, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            color: #333;
            font-size: 12px;
            white-space: nowrap;
            flex: 1 1 auto;
            min-width: 180px;
        }

        .slider-group label {
            font-weight: 600;
            min-width: 60px;
            font-size: 11px;
        }

        input[type="range"] {
            flex: 1;
            min-width: 80px;
        }

        .stats {
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 5px;
            text-align: center;
            color: #333;
            font-weight: bold;
        }

        .patterns {
            margin-top: 0;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 5px;
            color: #333;
        }

        .patterns h3 {
            margin-bottom: 10px;
            text-align: center;
        }

        .pattern-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .pattern-buttons button {
            font-size: 12px;
            padding: 8px 15px;
        }

        .legend {
            margin-top: 0;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 5px;
            color: #333;
            font-size: 13px;
        }

        .legend h3 {
            margin-bottom: 8px;
        }

        .legend ul {
            list-style-position: inside;
            line-height: 1.6;
        }

        .state-indicator {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .state-indicator.running {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            animation: pulse 2s infinite;
        }

        .state-indicator.paused {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .control-panel {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .panel-section {
            margin-top: 0;
            padding: 15px 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 5px;
        }

        .panel-section h4 {
            margin-bottom: 10px;
            color: #333;
            font-weight: bold;
            text-align: center;
        }

        .color-mode-buttons,
        .tool-buttons,
        .rule-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .color-mode-buttons button,
        .tool-buttons button,
        .rule-buttons button {
            font-size: 12px;
            padding: 8px 15px;
        }

        .advanced-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            color: #333;
        }

        .advanced-stats div {
            font-size: 14px;
        }

        .save-section {
            margin-top: 0;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 5px;
            color: #333;
        }

        .save-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 10px;
        }

        .save-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            padding: 10px;
        }

        .save-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 3px;
            font-size: 12px;
        }

        .save-item button {
            padding: 5px 10px;
            font-size: 11px;
        }

        .save-name {
            font-weight: bold;
            flex: 1;
        }

        .save-time {
            color: #666;
            font-size: 11px;
            margin: 0 10px;
        }

        .color-pick-btn {
            padding: 6px 12px;
            font-size: 11px;
        }

        .color-pick-btn.active {
            box-shadow: 0 0 10px rgba(0,176,155,0.5);
            border: 2px solid #00b09b;
        }

        /* ========================================
           –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –í–ï–†–°–¢–ö–ê
           ======================================== */

        /* –î–µ—Å–∫—Ç–æ–ø: –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π layout */
        @media (min-width: 900px) {
            .container {
                grid-template-columns: minmax(400px, 2fr) minmax(320px, 1fr);
                grid-template-rows: auto;
            }
            
            .game-canvas-wrapper {
                grid-column: 1;
                grid-row: 1 / -1;
            }
            
            .controls-wrapper {
                grid-column: 2;
                grid-row: 1 / -1;
                max-height: calc(100vh - 150px);
                overflow-y: auto;
                overflow-x: hidden;
                padding-right: 5px;
            }
            
            /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
            .controls-wrapper::-webkit-scrollbar {
                width: 8px;
            }
            
            .controls-wrapper::-webkit-scrollbar-track {
                background: rgba(102, 126, 234, 0.1);
                border-radius: 4px;
            }
            
            .controls-wrapper::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 4px;
            }
        }

        /* –ü–ª–∞–Ω—à–µ—Ç: –æ–¥–Ω–æ–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π layout —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π */
        @media (max-width: 899px) and (min-width: 601px) {
            .description {
                font-size: 14px;
            }
        }

        /* –ü–ª–∞–Ω—à–µ—Ç/–º–æ–±–∏–ª—å–Ω—ã–µ: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π layout –¥–ª—è –ø–∞–Ω–µ–ª–µ–π */
        @media (max-width: 768px) {
            .panel-section > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }

        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ */
        @media (max-width: 600px) {
            body {
                padding: 5px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .description {
                font-size: 12px;
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .container {
                padding: 10px;
                gap: 10px;
            }
            
            .controls-wrapper {
                gap: 10px;
            }
            
            .controls {
                gap: 4px;
            }
            
            .controls button {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            button {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            .slider-group {
                font-size: 11px;
                padding: 4px 8px;
                min-width: 150px;
            }
            
            .slider-group label {
                min-width: 50px;
                font-size: 10px;
            }
            
            .stats {
                font-size: 11px;
                padding: 8px;
            }
            
            .patterns h3 {
                font-size: 14px;
            }
            
            .pattern-buttons button {
                font-size: 10px;
                padding: 6px 10px;
            }
            
            .panel-section {
                padding: 10px 8px;
            }
            
            .panel-section h4 {
                font-size: 13px;
            }
            
            .legend {
                font-size: 11px;
            }
            
            .legend h3 {
                font-size: 14px;
            }
            
            .save-section h4 {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <h1>Ôåà –¶–≤–µ—Ç–Ω–∞—è –ò–≥—Ä–∞ "–ñ–∏–∑–Ω—å" Ôåà</h1>
    
    <div class="description">
        <p><strong>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</strong> –ö–∞–∂–¥–∞—è –∂–∏–≤–∞—è —è—á–µ–π–∫–∞ –∏–º–µ–µ—Ç —Ü–≤–µ—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ—Ç—Ç–µ–Ω–æ–∫). –ü—Ä–∏ —Ä–æ–∂–¥–µ–Ω–∏–∏ –Ω–æ–≤–∞—è —è—á–µ–π–∫–∞ –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Å–º–µ—à–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç –æ—Ç —Å–≤–æ–∏—Ö "—Ä–æ–¥–∏—Ç–µ–ª–µ–π". –¶–≤–µ—Ç —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ —è—á–µ–π–∫–∏ –∏ —Ü–≤–µ—Ç–æ–≤ —Å–æ—Å–µ–¥–µ–π, —Å–æ–∑–¥–∞–≤–∞—è –∫—Ä–∞—Å–∏–≤—ã–µ —Ü–≤–µ—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã!</p>
    </div>

    <div class="container">
        <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: Canvas –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="game-canvas-wrapper">
            <canvas id="gameCanvas"></canvas>
            <div class="stats">
                <span>–ü–æ–∫–æ–ª–µ–Ω–∏–µ: <span id="generation">0</span></span> | 
                <span>–ñ–∏–≤—ã—Ö –∫–ª–µ—Ç–æ–∫: <span id="alive">0</span></span> |
                <span>–ü–æ–ø—É–ª—è—Ü–∏—è: <span id="population">0%</span></span>
            </div>
        </div>
        
        <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls-wrapper">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="controls">
                <button id="startBtn" class="success">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
                <button id="stopBtn">‚è∏ –ü–∞—É–∑–∞</button>
                <button id="stepBtn">‚è≠ –®–∞–≥</button>
                <button id="clearBtn" class="danger">Ôóë –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button id="randomBtn">Ôé≤ –°–ª—É—á–∞–π–Ω–æ</button>
                <button id="toggleTrailsBtn" onclick="toggleTrails()">Ôåü –®–ª–µ–π—Ñ</button>
                
                <div class="slider-group">
                    <label for="speedSlider">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
                    <input type="range" id="speedSlider" min="1" max="60" value="10">
                    <span id="speedValue">10</span> FPS
                </div>
                
                <div class="slider-group">
                    <label for="cellSizeSlider">–†–∞–∑–º–µ—Ä:</label>
                    <input type="range" id="cellSizeSlider" min="4" max="20" value="8">
                    <span id="cellSizeValue">8</span> px
                </div>

                <div class="slider-group">
                    <label for="mutationRateSlider">–ú—É—Ç–∞—Ü–∏—è:</label>
                    <input type="range" id="mutationRateSlider" min="0" max="100" value="10">
                    <span id="mutationRateValue">10%</span>
                </div>

                <div class="slider-group">
                    <label for="brushSizeSlider">–ö–∏—Å—Ç—å:</label>
                    <input type="range" id="brushSizeSlider" min="1" max="5" value="1">
                    <span id="brushSizeValue">1</span>
                </div>

                <span id="stateIndicator" class="state-indicator paused">‚è∏ –ü–∞—É–∑–∞</span>
            </div>

            <!-- –ì–æ—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã -->
            <div class="patterns">
                <h3>Ôé® –ì–æ—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:</h3>
                <div class="pattern-buttons">
                    <button onclick="placePattern('glider')">–ü–ª–∞–Ω–µ—Ä</button>
                    <button onclick="placePattern('blinker')">–ú–∏–≥–∞–ª–∫–∞</button>
                    <button onclick="placePattern('toad')">–ñ–∞–±–∞</button>
                    <button onclick="placePattern('beacon')">–ú–∞—è–∫</button>
                    <button onclick="placePattern('pulsar')">–ü—É–ª—å—Å–∞—Ä</button>
                    <button onclick="placePattern('gliderGun')">–ü—É—à–∫–∞</button>
                    <button onclick="placePattern('rainbow')">–†–∞–¥—É–≥–∞</button>
                    <button onclick="placePattern('explosion')">–í–∑—Ä—ã–≤</button>
                </div>
            </div>
            
            <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ü–≤–µ—Ç–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã -->
            <div class="panel-section">
                <h4>Ôé® –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ü–≤–µ—Ç–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <div style="text-align: center; margin-bottom: 8px; font-size: 11px; color: #666; font-weight: 600;">
                            –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
                        </div>
                        <div class="tool-buttons">
                            <button onclick="setTool('brush', this)" class="tool-btn active" style="font-size: 11px; padding: 6px 10px;">Ôñå –ö–∏—Å—Ç—å</button>
                            <button onclick="setTool('eraser', this)" class="tool-btn" style="font-size: 11px; padding: 6px 10px;">Ôßπ –õ–∞—Å—Ç–∏–∫</button>
                            <button onclick="setTool('line', this)" class="tool-btn" style="font-size: 11px; padding: 6px 10px;">Ôìè –õ–∏–Ω–∏—è</button>
                            <button onclick="setTool('fill', this)" class="tool-btn" style="font-size: 11px; padding: 6px 10px;">Ôé® –ó–∞–ª–∏–≤–∫–∞</button>
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 6px; justify-content: center; align-items: center; flex-wrap: wrap;">
                            <span style="font-size: 11px; color: #666; font-weight: 600;">–¶–≤–µ—Ç:</span>
                            <button onclick="setDrawColor(null, this)" class="color-pick-btn active" style="background: linear-gradient(to right, red, yellow, green, cyan, blue, magenta); font-size: 10px; padding: 4px 8px;">Ôé≤ –°–ª—É—á–∞–π–Ω—ã–π</button>
                            <input type="color" id="colorPicker" value="#ff0000" onchange="setDrawColor(this.value)" style="width: 40px; height: 26px; border: none; border-radius: 3px; cursor: pointer;">
                        </div>
                    </div>
                    <div>
                        <div style="text-align: center; margin-bottom: 8px; font-size: 11px; color: #666; font-weight: 600;">
                            –¶–≤–µ—Ç–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã:
                        </div>
                        <div class="color-mode-buttons">
                            <button onclick="setColorMode('inheritance', this)" class="color-btn active" style="font-size: 11px; padding: 6px 10px;">–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</button>
                            <button onclick="setColorMode('rainbow', this)" class="color-btn" style="font-size: 11px; padding: 6px 10px;">–†–∞–¥—É–≥–∞</button>
                            <button onclick="setColorMode('thermal', this)" class="color-btn" style="font-size: 11px; padding: 6px 10px;">–¢–µ–ø–ª–æ–≤–∞—è</button>
                            <button onclick="setColorMode('age', this)" class="color-btn" style="font-size: 11px; padding: 6px 10px;">–í–æ–∑—Ä–∞—Å—Ç</button>
                            <button onclick="setColorMode('random', this)" class="color-btn" style="font-size: 11px; padding: 6px 10px;">–°–ª—É—á–∞–π–Ω—ã–π</button>
                        </div>
                        <div style="text-align: center; margin-top: 8px; font-size: 10px; color: #555; font-style: italic;">
                            <span id="currentColorDescription">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ —Å–æ—Å–µ–¥–µ–π</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∏–ª–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="panel-section">
                <h4>‚öôÔ∏è –ü—Ä–∞–≤–∏–ª–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <div style="text-align: center; margin-bottom: 8px; font-size: 11px; color: #666; font-weight: 600;">
                            –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:
                        </div>
                        <div class="rule-buttons">
                            <button onclick="setRuleSet('classic', this)" class="rule-btn active" style="font-size: 11px; padding: 6px 10px;">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ</button>
                            <button onclick="setRuleSet('highLife', this)" class="rule-btn" style="font-size: 11px; padding: 6px 10px;">HighLife</button>
                            <button onclick="setRuleSet('maze', this)" class="rule-btn" style="font-size: 11px; padding: 6px 10px;">–õ–∞–±–∏—Ä–∏–Ω—Ç</button>
                            <button onclick="setRuleSet('coral', this)" class="rule-btn" style="font-size: 11px; padding: 6px 10px;">–ö–æ—Ä–∞–ª–ª</button>
                        </div>
                        <div style="text-align: center; margin-top: 8px; font-size: 10px; color: #555; font-style: italic;">
                            <span id="currentRuleDescription">B3/S23 - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ö–æ–Ω–≤–µ—è</span>
                        </div>
                    </div>
                    <div>
                        <div style="text-align: center; margin-bottom: 8px; font-size: 11px; color: #666; font-weight: 600;">
                            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
                        </div>
                        <div class="advanced-stats" style="gap: 8px; font-size: 12px;">
                            <div>–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ: <span id="diversityValue">0%</span></div>
                            <div>–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: <span id="stabilityValue">0%</span></div>
                            <div>–¢—Ä–µ–Ω–¥: <span id="trendValue">‚û°Ô∏è</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π -->
            <div class="save-section">
                <h4>Ôíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π</h4>
                <div class="save-controls">
                    <button onclick="saveCurrentState()">Ôíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button onclick="clearSaves()">Ôóë –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
                </div>
                <div class="save-list" id="saveList"></div>
            </div>

            <!-- –õ–µ–≥–µ–Ω–¥–∞ –ø—Ä–∞–≤–∏–ª -->
            <div class="legend" id="rulesLegend">
                <h3>Ôìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:</h3>
                <ul id="rulesDescription">
                    <li><strong>–†–æ–∂–¥–µ–Ω–∏–µ:</strong> –ú—ë—Ä—Ç–≤–∞—è —è—á–µ–π–∫–∞ —Å 3 —Å–æ—Å–µ–¥—è–º–∏ –æ–∂–∏–≤–∞–µ—Ç, –ø–æ–ª—É—á–∞—è —Å–º–µ—à–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π</li>
                    <li><strong>–í—ã–∂–∏–≤–∞–Ω–∏–µ:</strong> –ñ–∏–≤–∞—è —è—á–µ–π–∫–∞ —Å 2-3 —Å–æ—Å–µ–¥—è–º–∏ –≤—ã–∂–∏–≤–∞–µ—Ç</li>
                    <li><strong>–°–º–µ—Ä—Ç—å:</strong> –Ø—á–µ–π–∫–∞ —É–º–∏—Ä–∞–µ—Ç –æ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞ (&lt;2 —Å–æ—Å–µ–¥–µ–π) –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞—Å–µ–ª–µ–Ω–∏—è (&gt;3 —Å–æ—Å–µ–¥–µ–π)</li>
                    <li><strong>–¶–≤–µ—Ç–æ–≤–∞—è –º—É—Ç–∞—Ü–∏—è:</strong> –¶–≤–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –¥—Ä–µ–π—Ñ—É–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å–µ–¥–µ–π</li>
                    <li><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> –°—Ç–∞—Ä—ã–µ —è—á–µ–π–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —è—Ä—á–µ</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // 1. –ù–ê–°–¢–†–û–ô–ö–ò –ò –ö–û–ù–°–¢–ê–ù–¢–´
        // ============================================
        
        const settings = {
            showTrails: false,
            showGrid: false,
            rules: {
                survival: [2, 3],
                birth: [3]
            }
        };

        const ruleSets = {
            classic: {
                name: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ",
                survival: [2, 3],
                birth: [3],
                description: "B3/S23 - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ö–æ–Ω–≤–µ—è"
            },
            highLife: {
                name: "HighLife", 
                survival: [2, 3],
                birth: [3, 6],
                description: "B36/S23 - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞"
            },
            maze: {
                name: "–õ–∞–±–∏—Ä–∏–Ω—Ç",
                survival: [1, 2, 3, 4, 5],
                birth: [3],
                description: "B3/S12345 - –°–æ–∑–¥–∞–µ—Ç –ª–∞–±–∏—Ä–∏–Ω—Ç–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"
            },
            coral: {
                name: "–ö–æ—Ä–∞–ª–ª",
                survival: [4, 5, 6, 7, 8],
                birth: [3],
                description: "B3/S45678 - –û–±—Ä–∞–∑—É–µ—Ç –∫–æ—Ä–∞–ª–ª–æ–ø–æ–¥–æ–±–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"
            }
        };
        
        let currentRules = ruleSets.classic;

        const drawingTools = {
            brush: {
                name: "–ö–∏—Å—Ç—å",
                cursor: "crosshair"
            },
            eraser: {
                name: "–õ–∞—Å—Ç–∏–∫", 
                cursor: "not-allowed"
            },
            fill: {
                name: "–ó–∞–ª–∏–≤–∫–∞",
                cursor: "cell"
            },
            line: {
                name: "–õ–∏–Ω–∏—è",
                cursor: "crosshair"
            }
        };
        
        let currentTool = 'brush';
        let brushSize = 1;
        let selectedDrawColor = null;

        const colorModes = {
            inheritance: {
                name: "–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ —Å–æ—Å–µ–¥–µ–π"
            },
            rainbow: {
                name: "–†–∞–¥—É–≥–∞", 
                description: "–¶–≤–µ—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –ø–æ–ª–µ"
            },
            thermal: {
                name: "–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞",
                description: "–¶–≤–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–µ–≥–∏–æ–Ω–∞"
            },
            age: {
                name: "–ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É",
                description: "–¶–≤–µ—Ç –º–µ–Ω—è–µ—Ç—Å—è —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º –∫–ª–µ—Ç–∫–∏"
            },
            random: {
                name: "–°–ª—É—á–∞–π–Ω—ã–π",
                description: "–°–ª—É—á–∞–π–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ —Ä–æ–∂–¥–µ–Ω–∏–∏"
            }
        };
        
        let currentColorMode = 'inheritance';
        let mutationRate = 0.1;
        
        // ============================================
        // 2. CANVAS –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´
        // ============================================
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let cellSize = 8;
        let cols, rows;
        let grid = [];
        let running = false;  // –í–ê–ñ–ù–û: –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –î–û —Ñ—É–Ω–∫—Ü–∏–∏ resizeCanvas
        let generation = 0;
        let intervalId = null;
        let speed = 10;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let statistics = {
            populationHistory: [],
            birthRate: 0,
            deathRate: 0,
            diversity: 0,
            stability: 0
        };

        // –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
        let savedStates = JSON.parse(localStorage.getItem('gameOfLifeSaves')) || [];
        
        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        let isDrawing = false;
        let lastPos = null;
        let lineStart = null;
        
        // ============================================
        // 3. –§–£–ù–ö–¶–ò–Ø –ê–î–ê–ü–¢–ò–í–ù–û–ì–û –†–ê–ó–ú–ï–†–ê (–ü–û–°–õ–ï –ü–ï–†–ï–ú–ï–ù–ù–´–•!)
        // ============================================
        
        function resizeCanvas() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const isMobile = window.innerWidth < 600;
            
            // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - –∫–≤–∞–¥—Ä–∞—Ç, –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ - 4:3
            const aspectRatio = isMobile ? 1 : 4/3;
            const canvasWidth = Math.min(containerWidth, isMobile ? 600 : 800);
            const canvasHeight = canvasWidth / aspectRatio;
            
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Å–µ—Ç–∫–∏
            const wasRunning = running; // –¢–µ–ø–µ—Ä—å running —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω–∞!
            running = false;
            clearInterval(intervalId);
            
            initGrid();
            drawGrid();
            
            if (wasRunning) {
                running = true;
                intervalId = setInterval(gameLoop, 1000 / speed);
            }
        }
        
        // ============================================
        // 4. –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ó –í–ê–®–ï–ì–û –ö–û–î–ê
        // ============================================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏
        function initGrid() {
            cols = Math.floor(canvas.width / cellSize);
            rows = Math.floor(canvas.height / cellSize);
            grid = [];
            
            for (let i = 0; i < rows; i++) {
                grid[i] = [];
                for (let j = 0; j < cols; j++) {
                    grid[i][j] = {
                        alive: false,
                        hue: 0,
                        saturation: 100,
                        lightness: 50,
                        age: 0,
                        energy: 0,
                        lastActive: 0
                    };
                }
            }
            generation = 0;
            updateStats();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
        function drawGrid() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const cell = grid[i][j];
                    
                    if (cell.alive) {
                        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∂–∏–≤—ã—Ö —è—á–µ–µ–∫ - —Å–ø–ª–æ—à–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞
                        const color = getCellColor(cell, i, j);
                        ctx.fillStyle = color;
                        ctx.fillRect(j * cellSize, i * cellSize, cellSize - 1, cellSize - 1);
                        
                        // –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–ª–µ—Ç–æ–∫
                        if (cell.age > 10) {
                            ctx.fillStyle = color.replace(')', ', 0.3)').replace('hsl', 'hsla');
                            ctx.fillRect(j * cellSize, i * cellSize, cellSize - 1, cellSize - 1);
                        }
                    } else if (settings.showTrails && cell.lastActive > 0) {
                        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —à–ª–µ–π—Ñ–∞ - —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—É—Ä –±–µ–∑ –∑–∞–ª–∏–≤–∫–∏
                        const color = getCellColor(cell, i, j);
                        const alpha = cell.lastActive / 5; // 0.2 - 1.0
                        const lineWidth = Math.max(1, cell.lastActive / 2.5); // 0.4 - 2
                        
                        ctx.strokeStyle = color.replace(')', `, ${alpha})`).replace('hsl', 'hsla');
                        ctx.lineWidth = lineWidth;
                        ctx.strokeRect(j * cellSize + 0.5, i * cellSize + 0.5, cellSize - 2, cellSize - 2);
                        
                        // –£–º–µ–Ω—å—à–∞–µ–º lastActive —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ
                        cell.lastActive--;
                    }
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞
            if (settings.showGrid) {
                drawGridLines();
            }
        }
        
        function drawGridLines() {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 0.5;
            
            for (let i = 0; i <= rows; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * cellSize);
                ctx.lineTo(canvas.width, i * cellSize);
                ctx.stroke();
            }
            
            for (let j = 0; j <= cols; j++) {
                ctx.beginPath();
                ctx.moveTo(j * cellSize, 0);
                ctx.lineTo(j * cellSize, canvas.height);
                ctx.stroke();
            }
        }
        
        function getCellColor(cell, x, y) {
            switch (currentColorMode) {
                case 'rainbow':
                    const hue = ((x / rows + y / cols) * 180 + generation * 2) % 360;
                    return `hsl(${hue}, ${cell.saturation}%, ${cell.lightness}%)`;
                    
                case 'thermal':
                    const thermalHue = 240 - (cell.energy * 2.4);
                    return `hsl(${thermalHue}, 100%, 50%)`;
                    
                case 'age':
                    const ageHue = (cell.age * 10) % 360;
                    return `hsl(${ageHue}, 100%, ${50 + Math.min(cell.age, 10)}%)`;
                    
                case 'random':
                    return `hsl(${cell.hue}, ${cell.saturation}%, ${cell.lightness}%)`;
                    
                case 'inheritance':
                default:
                    const lightness = Math.min(50 + cell.age * 2, 70);
                    return `hsl(${cell.hue}, ${cell.saturation}%, ${lightness}%)`;
            }
        }

        function getTrailColor(color, lastActive) {
            const match = color.match(/hsl\((\d+\.?\d*),\s*(\d+\.?\d*)%,\s*(\d+\.?\d*)%\)/);
            if (match) {
                const hue = match[1];
                const saturation = match[2];
                // –ß–µ–º –º–µ–Ω—å—à–µ lastActive, —Ç–µ–º —Ç–µ–º–Ω–µ–µ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ
                const lightness = 1 + (lastActive * 2); // 5-15%
                const alpha = lastActive * 0.02; // 0.08-0.4
                return `hsla(${hue}, ${saturation}%, ${lightness}%, ${alpha})`;
            }
            return 'hsla(0, 0%, 5%, 0.1)';
        }

        // –ü–æ–¥—Å—á—ë—Ç —Å–æ—Å–µ–¥–µ–π –∏ –∏—Ö —Å—Ä–µ–¥–Ω–∏–π —Ü–≤–µ—Ç
        function countNeighbors(x, y) {
            let count = 0;
            let hues = [];
            
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue;
                    
                    const newX = (x + i + rows) % rows;
                    const newY = (y + j + cols) % cols;
                    
                    if (grid[newX][newY].alive) {
                        count++;
                        hues.push(grid[newX][newY].hue);
                    }
                }
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π –æ—Ç—Ç–µ–Ω–æ–∫
            if (hues.length > 0) {
                const avgHue = averageHue(hues);
                return { count, avgHue };
            }
            
            return { count, avgHue: 0 };
        }

        // –°—Ä–µ–¥–Ω–∏–π –æ—Ç—Ç–µ–Ω–æ–∫ —Å —É—á—ë—Ç–æ–º —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏
        function averageHue(hues) {
            let x = 0, y = 0;
            
            for (let hue of hues) {
                const rad = (hue * Math.PI) / 180;
                x += Math.cos(rad);
                y += Math.sin(rad);
            }
            
            x /= hues.length;
            y /= hues.length;
            
            let avgHue = (Math.atan2(y, x) * 180) / Math.PI;
            if (avgHue < 0) avgHue += 360;
            
            return avgHue;
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–π —ç–≤–æ–ª—é—Ü–∏–∏
        function applyColorEvolution(cell, avgHue, neighborCount) {
            if (neighborCount > 0) {
                const hueDiff = avgHue - cell.hue;
                let shortestDiff = hueDiff;
                
                if (Math.abs(hueDiff) > 180) {
                    shortestDiff = hueDiff > 0 ? hueDiff - 360 : hueDiff + 360;
                }
                
                cell.hue = (cell.hue + shortestDiff * mutationRate + 360) % 360;
                cell.energy = Math.min(cell.energy + neighborCount, 100);
            } else {
                cell.energy = Math.max(cell.energy - 1, 0);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ (—Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ)
        function updateGrid() {
            const newGrid = JSON.parse(JSON.stringify(grid));
            
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const cell = grid[i][j];
                    const { count, avgHue } = countNeighbors(i, j);
                    
                    if (cell.alive) {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–∂–∏–≤–∞–Ω–∏—è
                        if (!currentRules.survival.includes(count)) {
                            newGrid[i][j].alive = false;
                            newGrid[i][j].age = 0;
                            newGrid[i][j].lastActive = 5;
                        } else {
                            // –Ø—á–µ–π–∫–∞ –≤—ã–∂–∏–≤–∞–µ—Ç
                            newGrid[i][j].age++;
                            applyColorEvolution(newGrid[i][j], avgHue, count);
                        }
                    } else {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
                        if (currentRules.birth.includes(count)) {
                            newGrid[i][j].alive = true;
                            
                            // –¶–≤–µ—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
                            switch (currentColorMode) {
                                case 'random':
                                    newGrid[i][j].hue = Math.random() * 360;
                                    break;
                                case 'rainbow':
                                    newGrid[i][j].hue = ((i / rows + j / cols) * 180) % 360;
                                    break;
                                case 'thermal':
                                    newGrid[i][j].hue = 240; // –ù–∞—á–∏–Ω–∞–µ–º —Å —Å–∏–Ω–µ–≥–æ
                                    break;
                                case 'age':
                                    newGrid[i][j].hue = 0; // –ù–∞—á–∏–Ω–∞–µ–º —Å –∫—Ä–∞—Å–Ω–æ–≥–æ
                                    break;
                                case 'inheritance':
                                default:
                                    newGrid[i][j].hue = avgHue; // –ù–∞—Å–ª–µ–¥—É–µ–º —Ü–≤–µ—Ç –æ—Ç —Å–æ—Å–µ–¥–µ–π
                                    break;
                            }
                            
                            newGrid[i][j].saturation = 100;
                            newGrid[i][j].lightness = 50;
                            newGrid[i][j].age = 0;
                        }
                    }
                }
            }
            
            grid = newGrid;
            generation++;
            updateStats();
            updateAdvancedStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            let aliveCount = 0;
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (grid[i][j].alive) aliveCount++;
                }
            }
            
            document.getElementById('generation').textContent = generation;
            document.getElementById('alive').textContent = aliveCount;
            document.getElementById('population').textContent = 
                ((aliveCount / (rows * cols)) * 100).toFixed(2) + '%';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateAdvancedStats() {
            let aliveCount = 0;
            const hues = new Set();
            
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (grid[i][j].alive) {
                        aliveCount++;
                        hues.add(Math.floor(grid[i][j].hue / 10) * 10);
                    }
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ø—É–ª—è—Ü–∏–∏
            statistics.populationHistory.push(aliveCount);
            if (statistics.populationHistory.length > 100) {
                statistics.populationHistory.shift();
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
            statistics.diversity = (hues.size / 36) * 100;
            document.getElementById('diversityValue').textContent = statistics.diversity.toFixed(1) + '%';
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
            if (statistics.populationHistory.length >= 2) {
                const lastPop = statistics.populationHistory[statistics.populationHistory.length - 1];
                const prevPop = statistics.populationHistory[statistics.populationHistory.length - 2];
                statistics.stability = 100 - Math.abs(lastPop - prevPop) / (rows * cols) * 100;
                document.getElementById('stabilityValue').textContent = statistics.stability.toFixed(1) + '%';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—Ä–µ–Ω–¥
                if (lastPop > prevPop) {
                    document.getElementById('trendValue').textContent = 'üìà';
                } else if (lastPop < prevPop) {
                    document.getElementById('trendValue').textContent = 'üìâ';
                } else {
                    document.getElementById('trendValue').textContent = '‚û°Ô∏è';
                }
            }
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            updateGrid();
            drawGrid();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateStateIndicator() {
            const indicator = document.getElementById('stateIndicator');
            if (running) {
                indicator.textContent = '‚ñ∂ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è';
                indicator.className = 'state-indicator running';
            } else {
                indicator.textContent = '‚è∏ –ü–∞—É–∑–∞';
                indicator.className = 'state-indicator paused';
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
        function setColorMode(mode, buttonElement) {
            currentColorMode = mode;
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞
            const descElement = document.getElementById('currentColorDescription');
            if (descElement && colorModes[mode]) {
                descElement.textContent = colorModes[mode].description;
            }
            
            drawGrid();
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª
        function setRuleSet(ruleSetName, buttonElement) {
            currentRules = ruleSets[ruleSetName];
            document.querySelectorAll('.rule-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
            const descElement = document.getElementById('currentRuleDescription');
            if (descElement) {
                descElement.textContent = currentRules.description;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–≥–µ–Ω–¥—É —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
            updateRulesLegend();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª –≤ –ª–µ–≥–µ–Ω–¥–µ
        function updateRulesLegend() {
            const rulesDesc = document.getElementById('rulesDescription');
            if (!rulesDesc) return;
            
            const birthStr = currentRules.birth.join(', ');
            const survivalStr = currentRules.survival.join(', ');
            
            let birthDesc = `–ú—ë—Ä—Ç–≤–∞—è —è—á–µ–π–∫–∞ —Å ${birthStr} —Å–æ—Å–µ–¥—è${currentRules.birth.length > 1 ? '–º–∏' : ''} –æ–∂–∏–≤–∞–µ—Ç`;
            let survivalDesc = `–ñ–∏–≤–∞—è —è—á–µ–π–∫–∞ —Å ${survivalStr} —Å–æ—Å–µ–¥—è${currentRules.survival.length > 1 ? '–º–∏' : ''} –≤—ã–∂–∏–≤–∞–µ—Ç`;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å–ª–æ–≤–∏—è —Å–º–µ—Ä—Ç–∏
            const allNeighbors = [0, 1, 2, 3, 4, 5, 6, 7, 8];
            const deathCounts = allNeighbors.filter(n => !currentRules.survival.includes(n) && n !== 0);
            const deathStr = deathCounts.length > 0 ? deathCounts.join(', ') : '–Ω–∏–∫–æ–≥–¥–∞';
            
            rulesDesc.innerHTML = `
                <li><strong>–†–æ–∂–¥–µ–Ω–∏–µ (B${currentRules.birth.join('')}):</strong> ${birthDesc}, –ø–æ–ª—É—á–∞—è —Å–º–µ—à–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π</li>
                <li><strong>–í—ã–∂–∏–≤–∞–Ω–∏–µ (S${currentRules.survival.join('')}):</strong> ${survivalDesc}</li>
                <li><strong>–°–º–µ—Ä—Ç—å:</strong> –Ø—á–µ–π–∫–∞ —É–º–∏—Ä–∞–µ—Ç –ø—Ä–∏ ${deathStr} —Å–æ—Å–µ–¥—è—Ö</li>
                <li><strong>–¶–≤–µ—Ç–æ–≤–∞—è –º—É—Ç–∞—Ü–∏—è:</strong> –¶–≤–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –¥—Ä–µ–π—Ñ—É–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å–µ–¥–µ–π</li>
                <li><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> –°—Ç–∞—Ä—ã–µ —è—á–µ–π–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —è—Ä—á–µ</li>
            `;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function setTool(tool, buttonElement) {
            currentTool = tool;
            canvas.style.cursor = drawingTools[tool].cursor;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function setDrawColor(color, buttonElement) {
            if (color === null) {
                selectedDrawColor = null;
                document.querySelectorAll('.color-pick-btn').forEach(btn => btn.classList.remove('active'));
                if (buttonElement) {
                    buttonElement.classList.add('active');
                }
            } else {
                selectedDrawColor = color;
                document.querySelectorAll('.color-pick-btn').forEach(btn => btn.classList.remove('active'));
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        //let isDrawing = false;
        //let lastPos = null;

        function getCellPos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: Math.floor((e.clientX - rect.left) / cellSize),
                y: Math.floor((e.clientY - rect.top) / cellSize)
            };
        }
        
        function handleDrawing(e) {
            const pos = getCellPos(e);
            
            switch (currentTool) {
                case 'brush':
                    drawBrush(pos.x, pos.y, true);
                    break;
                case 'eraser':
                    drawBrush(pos.x, pos.y, false);
                    break;
                case 'line':
                    if (lastPos && (pos.x !== lastPos.x || pos.y !== lastPos.y)) {
                        drawLine(lastPos.x, lastPos.y, pos.x, pos.y, true);
                        lastPos = pos;
                    }
                    break;
                case 'fill':
                    if (isDrawing) {
                        floodFill(pos.x, pos.y, true);
                        isDrawing = false;
                    }
                    break;
            }
            
            drawGrid();
            updateStats();
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è hex –≤ RGB
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : {r: 255, g: 0, b: 0};
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RGB –≤ HSL
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            
            return {
                h: h * 360,
                s: s * 100,
                l: l * 100
            };
        }
        
        function drawBrush(x, y, alive) {
            for (let dy = -brushSize + 1; dy < brushSize; dy++) {
                for (let dx = -brushSize + 1; dx < brushSize; dx++) {
                    const nx = x + dx;
                    const ny = y + dy;
                    
                    if (nx >= 0 && nx < cols && ny >= 0 && ny < rows) {
                        grid[ny][nx].alive = alive;
                        if (alive) {
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–π
                            if (selectedDrawColor) {
                                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º hex –≤ HSL
                                const rgb = hexToRgb(selectedDrawColor);
                                const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
                                grid[ny][nx].hue = hsl.h;
                                grid[ny][nx].saturation = hsl.s;
                                grid[ny][nx].lightness = hsl.l;
                            } else {
                                grid[ny][nx].hue = Math.random() * 360;
                                grid[ny][nx].saturation = 100;
                                grid[ny][nx].lightness = 50;
                            }
                            grid[ny][nx].age = 0;
                        }
                    }
                }
            }
            drawGrid();
            updateStats();
        }
        
        function drawLine(x1, y1, x2, y2, state) {
            const dx = Math.abs(x2 - x1);
            const dy = Math.abs(y2 - y1);
            const sx = (x1 < x2) ? 1 : -1;
            const sy = (y1 < y2) ? 1 : -1;
            let err = dx - dy;
            
            while(true) {
                if (x1 >= 0 && x1 < cols && y1 >= 0 && y1 < rows) {
                    grid[y1][x1].alive = state;
                    if (state) {
                        switch (currentColorMode) {
                            case 'random':
                                grid[y1][x1].hue = Math.random() * 360;
                                break;
                            case 'rainbow':
                                grid[y1][x1].hue = ((y1 / rows + x1 / cols) * 180) % 360;
                                break;
                            case 'thermal':
                                grid[y1][x1].hue = 240;
                                break;
                            case 'age':
                                grid[y1][x1].hue = 0;
                                break;
                            case 'inheritance':
                            default:
                                grid[y1][x1].hue = Math.random() * 360;
                                break;
                        }
                        grid[y1][x1].age = 0;
                    }
                }
                
                if (x1 === x2 && y1 === y2) break;
                const e2 = 2 * err;
                if (e2 > -dy) { err -= dy; x1 += sx; }
                if (e2 < dx) { err += dx; y1 += sy; }
            }
        }
        
        function floodFill(x, y, state) {
            if (x < 0 || x >= cols || y < 0 || y >= rows) return;
            
            const targetState = grid[y][x].alive;
            if (targetState === state) return;
            
            const queue = [[x, y]];
            const filled = new Set();
            
            while (queue.length > 0) {
                const [cx, cy] = queue.shift();
                const key = `${cx},${cy}`;
                
                if (filled.has(key)) continue;
                if (cx < 0 || cx >= cols || cy < 0 || cy >= rows) continue;
                if (grid[cy][cx].alive !== targetState) continue;
                
                grid[cy][cx].alive = state;
                if (state) {
                    switch (currentColorMode) {
                        case 'random':
                            grid[cy][cx].hue = Math.random() * 360;
                            break;
                        case 'rainbow':
                            grid[cy][cx].hue = ((cy / rows + cx / cols) * 180) % 360;
                            break;
                        case 'thermal':
                            grid[cy][cx].hue = 240;
                            break;
                        case 'age':
                            grid[cy][cx].hue = 0;
                            break;
                        case 'inheritance':
                        default:
                            grid[cy][cx].hue = Math.random() * 360;
                            break;
                    }
                    grid[cy][cx].age = 0;
                }
                filled.add(key);
                
                queue.push([cx + 1, cy], [cx - 1, cy], [cx, cy + 1], [cx, cy - 1]);
            }
        }

        // –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
        function saveCurrentState() {
            const state = {
                name: `–°–æ—Å—Ç–æ—è–Ω–∏–µ ${new Date().toLocaleTimeString()}`,
                timestamp: new Date().toISOString(),
                grid: JSON.parse(JSON.stringify(grid)),
                generation: generation,
                settings: {
                    cellSize: cellSize,
                    colorMode: currentColorMode,
                    rules: currentRules
                }
            };
            
            savedStates.unshift(state);
            if (savedStates.length > 20) savedStates.pop();
            
            localStorage.setItem('gameOfLifeSaves', JSON.stringify(savedStates));
            updateSaveList();
        }
        
        function loadState(index) {
            const state = savedStates[index];
            if (!state) return;
            
            running = false;
            clearInterval(intervalId);
            
            grid = JSON.parse(JSON.stringify(state.grid));
            generation = state.generation;
            
            if (state.settings) {
                cellSize = state.settings.cellSize;
                currentColorMode = state.settings.colorMode || 'inheritance';
                if (state.settings.rules) {
                    currentRules = state.settings.rules;
                }
            }
            
            drawGrid();
            updateStats();
            updateStateIndicator();
        }
        
        function deleteSave(index) {
            savedStates.splice(index, 1);
            localStorage.setItem('gameOfLifeSaves', JSON.stringify(savedStates));
            updateSaveList();
        }
        
        function clearSaves() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è?')) {
                savedStates = [];
                localStorage.setItem('gameOfLifeSaves', JSON.stringify(savedStates));
                updateSaveList();
            }
        }
        
        function updateSaveList() {
            const saveList = document.getElementById('saveList');
            if (!saveList) return;
            
            if (savedStates.length === 0) {
                saveList.innerHTML = '<p style="text-align:center; color:#666; padding:10px;">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π</p>';
                return;
            }
            
            saveList.innerHTML = savedStates.map((state, index) => `
                <div class="save-item">
                    <span class="save-name">${state.name}</span>
                    <span class="save-time">${new Date(state.timestamp).toLocaleString()}</span>
                    <button onclick="loadState(${index})">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <button onclick="deleteSave(${index})" class="danger">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!running) {
                running = true;
                intervalId = setInterval(gameLoop, 1000 / speed);
                updateStateIndicator();
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            running = false;
            clearInterval(intervalId);
            updateStateIndicator();
        });

        document.getElementById('stepBtn').addEventListener('click', () => {
            if (!running) {
                updateGrid();
                drawGrid();
            }
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            running = false;
            clearInterval(intervalId);
            initGrid();
            drawGrid();
            updateStateIndicator();
        });

        document.getElementById('randomBtn').addEventListener('click', () => {
            initGrid();
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (Math.random() < 0.3) {
                        grid[i][j].alive = true;
                        grid[i][j].hue = Math.random() * 360;
                    }
                }
            }
            drawGrid();
            updateStats();
        });

        // –°–ª–∞–π–¥–µ—Ä—ã
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = speed;
            
            if (running) {
                clearInterval(intervalId);
                intervalId = setInterval(gameLoop, 1000 / speed);
            }
        });

        document.getElementById('cellSizeSlider').addEventListener('input', (e) => {
            cellSize = parseInt(e.target.value);
            document.getElementById('cellSizeValue').textContent = cellSize;
            
            const wasRunning = running;
            running = false;
            clearInterval(intervalId);
            
            initGrid();
            drawGrid();
            
            if (wasRunning) {
                running = true;
                intervalId = setInterval(gameLoop, 1000 / speed);
            }
        });

        document.getElementById('mutationRateSlider').addEventListener('input', (e) => {
            mutationRate = parseInt(e.target.value) / 100;
            document.getElementById('mutationRateValue').textContent = e.target.value + '%';
        });

        document.getElementById('brushSizeSlider').addEventListener('input', (e) => {
            brushSize = parseInt(e.target.value);
            document.getElementById('brushSizeValue').textContent = brushSize;
        });

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –º—ã—à—å—é
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            lastPos = getCellPos(e);
            handleDrawing(e);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) handleDrawing(e);
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
            lastPos = null;
        });

        canvas.addEventListener('mouseleave', () => {
            isDrawing = false;
            lastPos = null;
        });

        // –ì–æ—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
        function placePattern(patternName) {
            initGrid();
            const centerX = Math.floor(cols / 2);
            const centerY = Math.floor(rows / 2);
            
            const patterns = {
                glider: [
                    [0, 1, 0],
                    [0, 0, 1],
                    [1, 1, 1]
                ],
                blinker: [
                    [1, 1, 1]
                ],
                toad: [
                    [0, 1, 1, 1],
                    [1, 1, 1, 0]
                ],
                beacon: [
                    [1, 1, 0, 0],
                    [1, 1, 0, 0],
                    [0, 0, 1, 1],
                    [0, 0, 1, 1]
                ],
                pulsar: [
                    [0,0,1,1,1,0,0,0,1,1,1,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [1,0,0,0,0,1,0,1,0,0,0,0,1],
                    [1,0,0,0,0,1,0,1,0,0,0,0,1],
                    [1,0,0,0,0,1,0,1,0,0,0,0,1],
                    [0,0,1,1,1,0,0,0,1,1,1,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,1,1,1,0,0,0,1,1,1,0,0],
                    [1,0,0,0,0,1,0,1,0,0,0,0,1],
                    [1,0,0,0,0,1,0,1,0,0,0,0,1],
                    [1,0,0,0,0,1,0,1,0,0,0,0,1],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,1,1,1,0,0,0,1,1,1,0,0]
                ],
                gliderGun: [
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1],
                    [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1],
                    [1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [1,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                ]
            };
            
            if (patternName === 'rainbow') {
                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        const dx = j - centerX;
                        const dy = i - centerY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance > 10 && distance < 20) {
                            grid[i][j].alive = true;
                            grid[i][j].hue = (Math.atan2(dy, dx) * 180 / Math.PI + 360) % 360;
                        }
                    }
                }
            } else if (patternName === 'explosion') {
                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        const dx = j - centerX;
                        const dy = i - centerY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 25 && Math.random() < 0.4) {
                            grid[i][j].alive = true;
                            grid[i][j].hue = (distance * 15) % 360;
                        }
                    }
                }
            } else {
                const pattern = patterns[patternName];
                if (pattern) {
                    const offsetY = Math.floor(pattern.length / 2);
                    const offsetX = Math.floor(pattern[0].length / 2);
                    
                    for (let i = 0; i < pattern.length; i++) {
                        for (let j = 0; j < pattern[i].length; j++) {
                            if (pattern[i][j] === 1) {
                                const y = centerY - offsetY + i;
                                const x = centerX - offsetX + j;
                                
                                if (y >= 0 && y < rows && x >= 0 && x < cols) {
                                    grid[y][x].alive = true;
                                    grid[y][x].hue = (i * 30 + j * 30) % 360;
                                }
                            }
                        }
                    }
                }
            }
            
            drawGrid();
            updateStats();
        }

        function toggleTrails() {
            settings.showTrails = !settings.showTrails;
            const btn = document.getElementById('toggleTrailsBtn');
            btn.textContent = settings.showTrails ? 'Ôåü –®–ª–µ–π—Ñ: –í–ö–õ' : 'Ôí´ –®–ª–µ–π—Ñ: –í–´–ö–õ';
            drawGrid();
        }

        // ============================================
        // 5. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï (–í –°–ê–ú–û–ú –ö–û–ù–¶–ï!)
        // ============================================
        
        window.addEventListener('load', () => {
            resizeCanvas();  // –í—ã–∑—ã–≤–∞–µ–º –ü–û–°–õ–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
            updateStateIndicator();
            updateSaveList();
            updateRulesLegend();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(resizeCanvas, 200);
        });
    </script>
</body>
</html>